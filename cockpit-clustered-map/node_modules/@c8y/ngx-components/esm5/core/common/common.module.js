import * as tslib_1 from "tslib";
import { NgModule, APP_INITIALIZER, InjectionToken } from '@angular/core';
import { CommonModule as NgCommonModule } from '@angular/common';
import { DataModule } from '@c8y/ngx-components/api';
import { I18nModule } from '../i18n/i18n.module';
import { IconDirective, ICONS } from './icon.directive';
import { OutletDirective } from './outlet.directive';
import { HOOK_OPTIONS, OptionsService } from './options.service';
import { UserPreferencesService } from './user-preferences/user-preferences.service';
import { HumanizeAppNamePipe } from './humanize-app-name.pipe';
import { HumanizePipe } from './humanize.pipe';
import { AppStateService } from './ui-state.service';
import { TranslateService } from '../i18n/public-api';
import { filter, switchMap, startWith, map, distinctUntilChanged } from 'rxjs/operators';
import { ShortenUserNamePipe } from './shorten-user-name.pipe';
import { ForOfDirective } from './forOf.directive';
import { LoadMoreComponent } from './load-more.component';
import { MapFunctionPipe } from './map-function.pipe';
import { ProgressBarComponent } from './progress-bar.component';
export function initializeServices(translateService, state, userPreferences) {
    var initialize = function () {
        var queryStringLanguage = translateService.queryStringLang();
        var firstLanguage = translateService.firstSupportedLanguage();
        /*
          The ?lang parameter will prevent the user preference language from being activated
        */
        if (queryStringLanguage && translateService.isSupported(queryStringLanguage)) {
            translateService.switchToLanguage(queryStringLanguage);
        }
        else {
            state.currentUser
                .pipe(map(function (user) { return user && user.userName; }), filter(function (u) { return !!u; }), distinctUntilChanged(), switchMap(function () { return userPreferences.get('language'); }), startWith(firstLanguage), filter(function (lang) { return !!lang; }), distinctUntilChanged())
                .subscribe(function (lang) {
                translateService.switchToLanguage(lang);
            });
        }
    };
    return initialize;
}
export var ICON_LIST = new InjectionToken('iconList');
/**
 * Commonly used directives, data access and translation. This module is the shared
 * module across all core components. It should be imported by default.
 *
 * @exports IconDirective A directive to set a c8y icon with [c8yIcon]="'rocket'".
 * @exports OutletDirective A directive which allows to set DOM or Angular templates (used for upgrade).
 * @exports I18nModule Translation module.
 * @exports NgCommonModule Angular common module.
 * @exports DataModule The data layer to allow DI with @c8y/client
 * @exports HumanizeAppNamePipe Humanize an application name (e.g. in the app switcher)
 * @exports HumanizePipe Humanize a word. E.g. `device management` gets `Device management`
 * @exports ShortenUserNamePipe Allows a short name. E.g. `Foo Bar` gets `F. Bar`
 * @exports ForOfDirective A forOf directive like ngFor but with load-more function
 * @exports LoadMoreComponent A component to load more data from a certain data-source
 * @exports ProgressBarComponent Displays either defined or undefined progress.
 */
var CommonModule = /** @class */ (function () {
    function CommonModule() {
    }
    CommonModule_1 = CommonModule;
    CommonModule.providers = function () {
        return tslib_1.__spread(DataModule.providers(), [
            // TODO: maybe we can think of a way to remove this C8Y_APP global
            { provide: HOOK_OPTIONS, useValue: window.C8Y_APP || {}, multi: true },
            {
                provide: APP_INITIALIZER,
                useFactory: initializeServices,
                deps: [TranslateService, AppStateService, UserPreferencesService],
                multi: true
            },
            { provide: ICON_LIST, useValue: ICONS, multi: false }
        ], I18nModule.providers(), [
            UserPreferencesService,
            OptionsService,
            AppStateService
        ]);
    };
    CommonModule.forRoot = function () {
        return {
            ngModule: CommonModule_1,
            providers: CommonModule_1.providers()
        };
    };
    var CommonModule_1;
    CommonModule = CommonModule_1 = tslib_1.__decorate([
        NgModule({
            imports: [NgCommonModule, I18nModule],
            exports: [
                IconDirective,
                OutletDirective,
                I18nModule,
                NgCommonModule,
                HumanizeAppNamePipe,
                HumanizePipe,
                ShortenUserNamePipe,
                ForOfDirective,
                LoadMoreComponent,
                MapFunctionPipe,
                ProgressBarComponent
            ],
            declarations: [
                IconDirective,
                OutletDirective,
                HumanizePipe,
                HumanizeAppNamePipe,
                ShortenUserNamePipe,
                ForOfDirective,
                LoadMoreComponent,
                MapFunctionPipe,
                ProgressBarComponent
            ],
            entryComponents: [LoadMoreComponent]
        })
    ], CommonModule);
    return CommonModule;
}());
export { CommonModule };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLm1vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2NvbW1vbi9jb21tb24ubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLFlBQVksSUFBSSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDckQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDakUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDckYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8s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QWlCO2dCQUNqQixlQUFlO2dCQUNmLG9CQUFvQjthQUNyQjtZQUNELFlBQVksRUFBRTtnQkFDWixhQUFhO2dCQUNiLGVBQWU7Z0JBQ2YsWUFBWTtnQkFDWixtQkFBbUI7Z0JBQ25CLG1CQUFtQjtnQkFDbkIsY0FBYztnQkFDZCxpQkFBaUI7Z0JBQ2pCLGVBQWU7Z0JBQ2Ysb0JBQW9CO2FBQ3JCO1lBQ0QsZUFBZSxFQUFFLENBQUMsaUJBQWlCLENBQUM7U0FDckMsQ0FBQztPQUNXLFlBQVksQ0EwQnhCO0lBQUQsbUJBQUM7Q0FBQSxBQTFCRCxJQTBCQztTQTFCWSxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmdNb2R1bGUsIEFQUF9JTklUSUFMSVpFUiwgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSBhcyBOZ0NvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBEYXRhTW9kdWxlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9hcGknO1xuaW1wb3J0IHsgSTE4bk1vZHVsZSB9IGZyb20gJy4uL2kxOG4vaTE4bi5tb2R1bGUnO1xuaW1wb3J0IHsgSWNvbkRpcmVjdGl2ZSwgSUNPTlMgfSBmcm9tICcuL2ljb24uZGlyZWN0aXZlJztcbmltcG9ydCB7IE91dGxldERpcmVjdGl2ZSB9IGZyb20gJy4vb3V0bGV0LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBIT09LX09QVElPTlMsIE9wdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi9vcHRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSB9IGZyb20gJy4vdXNlci1wcmVmZXJlbmNlcy91c2VyLXByZWZlcmVuY2VzLnNlcnZpY2UnO1xuaW1wb3J0IHsgSHVtYW5pemVBcHBOYW1lUGlwZSB9IGZyb20gJy4vaHVtYW5pemUtYXBwLW5hbWUucGlwZSc7XG5pbXBvcnQgeyBIdW1hbml6ZVBpcGUgfSBmcm9tICcuL2h1bWFuaXplLnBpcGUnO1xuaW1wb3J0IHsgQXBwU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi91aS1zdGF0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9pMThuL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgZmlsdGVyLCBzd2l0Y2hNYXAsIHN0YXJ0V2l0aCwgbWFwLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFNob3J0ZW5Vc2VyTmFtZVBpcGUgfSBmcm9tICcuL3Nob3J0ZW4tdXNlci1uYW1lLnBpcGUnO1xuaW1wb3J0IHsgRm9yT2ZEaXJlY3RpdmUgfSBmcm9tICcuL2Zvck9mLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBMb2FkTW9yZUNvbXBvbmVudCB9IGZyb20gJy4vbG9hZC1tb3JlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBNYXBGdW5jdGlvblBpcGUgfSBmcm9tICcuL21hcC1mdW5jdGlvbi5waXBlJztcbmltcG9ydCB7IFByb2dyZXNzQmFyQ29tcG9uZW50IH0gZnJvbSAnLi9wcm9ncmVzcy1iYXIuY29tcG9uZW50JztcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVTZXJ2aWNlcyhcbiAgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSxcbiAgc3RhdGU6IEFwcFN0YXRlU2VydmljZSxcbiAgdXNlclByZWZlcmVuY2VzOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4pIHtcbiAgY29uc3QgaW5pdGlhbGl6ZSA9ICgpID0+IHtcbiAgICBjb25zdCBxdWVyeVN0cmluZ0xhbmd1YWdlID0gdHJhbnNsYXRlU2VydmljZS5xdWVyeVN0cmluZ0xhbmcoKTtcbiAgICBjb25zdCBmaXJzdExhbmd1YWdlID0gdHJhbnNsYXRlU2VydmljZS5maXJzdFN1cHBvcnRlZExhbmd1YWdlKCk7XG5cbiAgICAvKlxuICAgICAgVGhlID9sYW5nIHBhcmFtZXRlciB3aWxsIHByZXZlbnQgdGhlIHVzZXIgcHJlZmVyZW5jZSBsYW5ndWFnZSBmcm9tIGJlaW5nIGFjdGl2YXRlZFxuICAgICovXG4gICAgaWYgKHF1ZXJ5U3RyaW5nTGFuZ3VhZ2UgJiYgdHJhbnNsYXRlU2VydmljZS5pc1N1cHBvcnRlZChxdWVyeVN0cmluZ0xhbmd1YWdlKSkge1xuICAgICAgdHJhbnNsYXRlU2VydmljZS5zd2l0Y2hUb0xhbmd1YWdlKHF1ZXJ5U3RyaW5nTGFuZ3VhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0ZS5jdXJyZW50VXNlclxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAodXNlciA9PiB1c2VyICYmIHVzZXIudXNlck5hbWUpLFxuICAgICAgICAgIGZpbHRlcih1ID0+ICEhdSksXG4gICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gdXNlclByZWZlcmVuY2VzLmdldCgnbGFuZ3VhZ2UnKSksXG4gICAgICAgICAgc3RhcnRXaXRoKGZpcnN0TGFuZ3VhZ2UpLFxuICAgICAgICAgIGZpbHRlcihsYW5nID0+ICEhbGFuZyksXG4gICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUobGFuZyA9PiB7XG4gICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5zd2l0Y2hUb0xhbmd1YWdlKGxhbmcpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBpbml0aWFsaXplO1xufVxuXG5leHBvcnQgY29uc3QgSUNPTl9MSVNUID0gbmV3IEluamVjdGlvblRva2VuKCdpY29uTGlzdCcpO1xuXG4vKipcbiAqIENvbW1vbmx5IHVzZWQgZGlyZWN0aXZlcywgZGF0YSBhY2Nlc3MgYW5kIHRyYW5zbGF0aW9uLiBUaGlzIG1vZHVsZSBpcyB0aGUgc2hhcmVkXG4gKiBtb2R1bGUgYWNyb3NzIGFsbCBjb3JlIGNvbXBvbmVudHMuIEl0IHNob3VsZCBiZSBpbXBvcnRlZCBieSBkZWZhdWx0LlxuICpcbiAqIEBleHBvcnRzIEljb25EaXJlY3RpdmUgQSBkaXJlY3RpdmUgdG8gc2V0IGEgYzh5IGljb24gd2l0aCBbYzh5SWNvbl09XCIncm9ja2V0J1wiLlxuICogQGV4cG9ydHMgT3V0bGV0RGlyZWN0aXZlIEEgZGlyZWN0aXZlIHdoaWNoIGFsbG93cyB0byBzZXQgRE9NIG9yIEFuZ3VsYXIgdGVtcGxhdGVzICh1c2VkIGZvciB1cGdyYWRlKS5cbiAqIEBleHBvcnRzIEkxOG5Nb2R1bGUgVHJhbnNsYXRpb24gbW9kdWxlLlxuICogQGV4cG9ydHMgTmdDb21tb25Nb2R1bGUgQW5ndWxhciBjb21tb24gbW9kdWxlLlxuICogQGV4cG9ydHMgRGF0YU1vZHVsZSBUaGUgZGF0YSBsYXllciB0byBhbGxvdyBESSB3aXRoIEBjOHkvY2xpZW50XG4gKiBAZXhwb3J0cyBIdW1hbml6ZUFwcE5hbWVQaXBlIEh1bWFuaXplIGFuIGFwcGxpY2F0aW9uIG5hbWUgKGUuZy4gaW4gdGhlIGFwcCBzd2l0Y2hlcilcbiAqIEBleHBvcnRzIEh1bWFuaXplUGlwZSBIdW1hbml6ZSBhIHdvcmQuIEUuZy4gYGRldmljZSBtYW5hZ2VtZW50YCBnZXRzIGBEZXZpY2UgbWFuYWdlbWVudGBcbiAqIEBleHBvcnRzIFNob3J0ZW5Vc2VyTmFtZVBpcGUgQWxsb3dzIGEgc2hvcnQgbmFtZS4gRS5nLiBgRm9vIEJhcmAgZ2V0cyBgRi4gQmFyYFxuICogQGV4cG9ydHMgRm9yT2ZEaXJlY3RpdmUgQSBmb3JPZiBkaXJlY3RpdmUgbGlrZSBuZ0ZvciBidXQgd2l0aCBsb2FkLW1vcmUgZnVuY3Rpb25cbiAqIEBleHBvcnRzIExvYWRNb3JlQ29tcG9uZW50IEEgY29tcG9uZW50IHRvIGxvYWQgbW9yZSBkYXRhIGZyb20gYSBjZXJ0YWluIGRhdGEtc291cmNlXG4gKiBAZXhwb3J0cyBQcm9ncmVzc0JhckNvbXBvbmVudCBEaXNwbGF5cyBlaXRoZXIgZGVmaW5lZCBvciB1bmRlZmluZWQgcHJvZ3Jlc3MuXG4gKi9cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtOZ0NvbW1vbk1vZHVsZSwgSTE4bk1vZHVsZV0sXG4gIGV4cG9ydHM6IFtcbiAgICBJY29uRGlyZWN0aXZlLFxuICAgIE91dGxldERpcmVjdGl2ZSxcbiAgICBJMThuTW9kdWxlLFxuICAgIE5nQ29tbW9uTW9kdWxlLFxuICAgIEh1bWFuaXplQXBwTmFtZVBpcGUsXG4gICAgSHVtYW5pemVQaXBlLFxuICAgIFNob3J0ZW5Vc2VyTmFtZVBpcGUsXG4gICAgRm9yT2ZEaXJlY3RpdmUsXG4gICAgTG9hZE1vcmVDb21wb25lbnQsXG4gICAgTWFwRnVuY3Rpb25QaXBlLFxuICAgIFByb2dyZXNzQmFyQ29tcG9uZW50XG4gIF0sXG4gIGRlY2xhcmF0aW9uczogW1xuICAgIEljb25EaXJlY3RpdmUsXG4gICAgT3V0bGV0RGlyZWN0aXZlLFxuICAgIEh1bWFuaXplUGlwZSxcbiAgICBIdW1hbml6ZUFwcE5hbWVQaXBlLFxuICAgIFNob3J0ZW5Vc2VyTmFtZVBpcGUsXG4gICAgRm9yT2ZEaXJlY3RpdmUsXG4gICAgTG9hZE1vcmVDb21wb25lbnQsXG4gICAgTWFwRnVuY3Rpb25QaXBlLFxuICAgIFByb2dyZXNzQmFyQ29tcG9uZW50XG4gIF0sXG4gIGVudHJ5Q29tcG9uZW50czogW0xvYWRNb3JlQ29tcG9uZW50XVxufSlcbmV4cG9ydCBjbGFzcyBDb21tb25Nb2R1bGUge1xuICBzdGF0aWMgcHJvdmlkZXJzKCkge1xuICAgIHJldHVybiBbXG4gICAgICAuLi5EYXRhTW9kdWxlLnByb3ZpZGVycygpLFxuICAgICAgLy8gVE9ETzogbWF5YmUgd2UgY2FuIHRoaW5rIG9mIGEgd2F5IHRvIHJlbW92ZSB0aGlzIEM4WV9BUFAgZ2xvYmFsXG4gICAgICB7IHByb3ZpZGU6IEhPT0tfT1BUSU9OUywgdXNlVmFsdWU6ICh3aW5kb3cgYXMgYW55KS5DOFlfQVBQIHx8IHt9LCBtdWx0aTogdHJ1ZSB9LFxuICAgICAge1xuICAgICAgICBwcm92aWRlOiBBUFBfSU5JVElBTElaRVIsXG4gICAgICAgIHVzZUZhY3Rvcnk6IGluaXRpYWxpemVTZXJ2aWNlcyxcbiAgICAgICAgZGVwczogW1RyYW5zbGF0ZVNlcnZpY2UsIEFwcFN0YXRlU2VydmljZSwgVXNlclByZWZlcmVuY2VzU2VydmljZV0sXG4gICAgICAgIG11bHRpOiB0cnVlXG4gICAgICB9LFxuICAgICAgeyBwcm92aWRlOiBJQ09OX0xJU1QsIHVzZVZhbHVlOiBJQ09OUywgbXVsdGk6IGZhbHNlIH0sXG4gICAgICAuLi5JMThuTW9kdWxlLnByb3ZpZGVycygpLFxuICAgICAgVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICAgIE9wdGlvbnNTZXJ2aWNlLFxuICAgICAgQXBwU3RhdGVTZXJ2aWNlXG4gICAgXTtcbiAgfVxuXG4gIHN0YXRpYyBmb3JSb290KCkge1xuICAgIHJldHVybiB7XG4gICAgICBuZ01vZHVsZTogQ29tbW9uTW9kdWxlLFxuICAgICAgcHJvdmlkZXJzOiBDb21tb25Nb2R1bGUucHJvdmlkZXJzKClcbiAgICB9O1xuICB9XG59XG4iXX0=