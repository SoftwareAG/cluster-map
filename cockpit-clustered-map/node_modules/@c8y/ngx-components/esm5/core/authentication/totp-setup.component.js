import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { ITotp, UserService } from '@c8y/client';
import { AlertService } from '../alert/alert.service';
var TotpSetupComponent = /** @class */ (function () {
    function TotpSetupComponent(user, alert) {
        this.user = user;
        this.alert = alert;
    }
    Object.defineProperty(TotpSetupComponent.prototype, "qrCodeImage", {
        get: function () {
            return this.totpSecret ? this.totpSecret.secretQrUrl : '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TotpSetupComponent.prototype, "secret", {
        get: function () {
            return this.totpSecret ? this.totpSecret.rawSecret : '';
        },
        enumerable: true,
        configurable: true
    });
    TotpSetupComponent.prototype.ngOnInit = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var data, ex_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.user.generateTotpSecret()];
                    case 1:
                        data = (_a.sent()).data;
                        this.totpSecret = data;
                        return [3 /*break*/, 3];
                    case 2:
                        ex_1 = _a.sent();
                        this.alert.addServerFailure(ex_1);
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    TotpSetupComponent.ctorParameters = function () { return [
        { type: UserService },
        { type: AlertService }
    ]; };
    TotpSetupComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-totp-setup',
            template: "<div class=\"text-center\">\n  <p\n    class=\"lead bottom-m-md\"\n    translate\n  >\n    Scan this QR code with your smartphone using the Google Authenticator app.\n  </p>\n\n  <img\n    style=\"width: 100%; max-width: 300px;\"\n    class=\"bottom-m-md\"\n    [src]=\"qrCodeImage\"\n    alt=\"{{'QR code loading' | translate}}\u2026\"\n  >\n  <p class=\"text-center text-muted\">\n    {{secret}}\n  </p>\n</div>\n"
        })
    ], TotpSetupComponent);
    return TotpSetupComponent;
}());
export { TotpSetupComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG90cC1zZXR1cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29yZS9hdXRoZW50aWNhdGlvbi90b3RwLXNldHVwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNqRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFPdEQ7SUFXRSw0QkFBb0IsSUFBaUIsRUFBVSxLQUFtQjtRQUE5QyxTQUFJLEdBQUosSUFBSSxDQUFhO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBYztJQUFJLENBQUM7SUFSdkUsc0JBQUksMkNBQVc7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM1RCxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHNDQUFNO2FBQVY7WUFDRSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDMUQsQ0FBQzs7O09BQUE7SUFJSyxxQ0FBUSxHQUFkOzs7Ozs7O3dCQUVxQixxQkFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUE7O3dCQUE3QyxJQUFJLEdBQUssQ0FBQSxTQUFvQyxDQUFBLEtBQXpDO3dCQUNaLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDOzs7O3dCQUV2QixJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUUsQ0FBQyxDQUFDOzs7Ozs7S0FFbkM7O2dCQVR5QixXQUFXO2dCQUFpQixZQUFZOztJQVh2RCxrQkFBa0I7UUFMOUIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGdCQUFnQjtZQUMxQiwyYUFBMEM7U0FDM0MsQ0FBQztPQUVXLGtCQUFrQixDQXFCOUI7SUFBRCx5QkFBQztDQUFBLEFBckJELElBcUJDO1NBckJZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJVG90cCwgVXNlclNlcnZpY2UgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UgfSBmcm9tICcuLi9hbGVydC9hbGVydC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXRvdHAtc2V0dXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vdG90cC1zZXR1cC5jb21wb25lbnQuaHRtbCdcbn0pXG5cbmV4cG9ydCBjbGFzcyBUb3RwU2V0dXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICB0b3RwU2VjcmV0OiBJVG90cDtcblxuICBnZXQgcXJDb2RlSW1hZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMudG90cFNlY3JldCA/IHRoaXMudG90cFNlY3JldC5zZWNyZXRRclVybCA6ICcnO1xuICB9XG5cbiAgZ2V0IHNlY3JldCgpIHtcbiAgICByZXR1cm4gdGhpcy50b3RwU2VjcmV0ID8gdGhpcy50b3RwU2VjcmV0LnJhd1NlY3JldCA6ICcnO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB1c2VyOiBVc2VyU2VydmljZSwgcHJpdmF0ZSBhbGVydDogQWxlcnRTZXJ2aWNlKSB7IH1cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCB0aGlzLnVzZXIuZ2VuZXJhdGVUb3RwU2VjcmV0KCk7XG4gICAgICB0aGlzLnRvdHBTZWNyZXQgPSBkYXRhO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB0aGlzLmFsZXJ0LmFkZFNlcnZlckZhaWx1cmUoZXgpO1xuICAgIH1cbiAgfVxufVxuIl19