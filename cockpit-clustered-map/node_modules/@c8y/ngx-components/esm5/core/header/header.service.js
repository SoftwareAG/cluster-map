import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { distinctUntilChanged, map, combineLatest, debounceTime } from 'rxjs/operators';
import { OptionsService } from '../common/options.service';
import { StateService } from '../common/state-service.abstract';
import { NavigatorService } from '../navigator/navigator.service';
import * as i0 from "@angular/core";
import * as i1 from "../navigator/navigator.service";
import * as i2 from "../common/options.service";
/**
 * A service which defines header functions.
 */
var HeaderService = /** @class */ (function (_super) {
    tslib_1.__extends(HeaderService, _super);
    function HeaderService(navigatorService, options) {
        var _this = _super.call(this) || this;
        _this.navigatorService = navigatorService;
        _this.options = options;
        _this.hasItemsInNavigator$ = _this.navigatorService.items$.pipe(map(function (_a) {
            var length = _a.length;
            return !!length;
        }), distinctUntilChanged());
        _this.state$ = new BehaviorSubject({
            title: undefined,
            nav: {
                open: false
            }
        });
        _this.title = undefined;
        _this.header$ = _this.map(function (header) { return header; });
        _this.navigatorOpen$ = _this.map(function (_a) {
            var nav = _a.nav;
            return nav.open;
        }).pipe(combineLatest(_this.hasItemsInNavigator$), map(function (_a) {
            var _b = tslib_1.__read(_a, 2), open = _b[0], hasItems = _b[1];
            return open && hasItems;
        }));
        var titleReference = document.querySelector('title');
        _this.title = {
            elementRef: titleReference,
            originalValue: titleReference && titleReference.innerText
        };
        return _this;
    }
    Object.defineProperty(HeaderService.prototype, "state", {
        get: function () {
            return this.state$.value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HeaderService.prototype, "navigatorHiddenOnStartup", {
        get: function () {
            return this.options.hideNavigator;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HeaderService.prototype, "largeWidth", {
        get: function () {
            return document.documentElement.clientWidth > 1200;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HeaderService.prototype, "shouldToggle", {
        get: function () {
            return this.largeWidth && !this.navigatorHiddenOnStartup && !this.state.nav.open;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Toggles the navigator open status.
     */
    HeaderService.prototype.toggleNavigator = function () {
        this.state.nav.open = !this.state.nav.open;
        this.emitNewState();
    };
    /**
     * Force to close the navigator.
     */
    HeaderService.prototype.closeNavigator = function () {
        this.state.nav.open = false;
        this.emitNewState();
    };
    /**
     * Configures navigation options.
     * @param config Object with the properties:
     * - open: Boolean
     */
    HeaderService.prototype.configNavigator = function (config) {
        if (config === void 0) { config = {}; }
        this.state.nav = Object.assign(this.state.nav, config);
        this.emitNewState();
    };
    /**
     * Change the application title.
     * @param newTitle The new title of the application.
     */
    HeaderService.prototype.changeTitle = function (newTitle) {
        this.state.title = newTitle;
        this.emitNewState();
    };
    /**
     * Change the page title.
     * @param newTitle The new title of the page.
     */
    HeaderService.prototype.changePageTitle = function (newTitle) {
        this.title.elementRef.innerText = newTitle
            ? newTitle + " / " + this.title.originalValue
            : "" + this.title.originalValue;
    };
    /**
     * This methods checks if the navigator toggles on startup
     * or if an item is added to the navigator node.
     * Delay of 300ms is intended for animation purpose.
     */
    HeaderService.prototype.verifyIfNavOpen = function () {
        var _this = this;
        this.hasItemsInNavigator$
            .pipe(debounceTime(300))
            .subscribe(function (hasItems) { return hasItems && _this.shouldToggle && _this.toggleNavigator(); });
    };
    HeaderService.prototype.shouldShowBreadcrumbs = function () {
        return this.options.breadcrumbs;
    };
    HeaderService.ctorParameters = function () { return [
        { type: NavigatorService },
        { type: OptionsService }
    ]; };
    HeaderService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function HeaderService_Factory() { return new HeaderService(i0.ɵɵinject(i1.NavigatorService), i0.ɵɵinject(i2.OptionsService)); }, token: HeaderService, providedIn: "root" });
    HeaderService = tslib_1.__decorate([
        Injectable({
            providedIn: 'root'
        })
    ], HeaderService);
    return HeaderService;
}(StateService));
export { HeaderService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29yZS9oZWFkZXIvaGVhZGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBa0IsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7OztBQUdsRTs7R0FFRztBQUlIO0lBQW1DLHlDQUFZO0lBa0I3Qyx1QkFBb0IsZ0JBQWtDLEVBQVUsT0FBdUI7UUFBdkYsWUFDRSxpQkFBTyxTQVdSO1FBWm1CLHNCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFBVSxhQUFPLEdBQVAsT0FBTyxDQUFnQjtRQWR2RiwwQkFBb0IsR0FBRyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDdEQsR0FBRyxDQUFDLFVBQUMsRUFBVTtnQkFBUixrQkFBTTtZQUFPLE9BQUEsQ0FBQyxDQUFDLE1BQU07UUFBUixDQUFRLENBQUMsRUFDN0Isb0JBQW9CLEVBQUUsQ0FDdkIsQ0FBQztRQUVGLFlBQU0sR0FBNEIsSUFBSSxlQUFlLENBQVM7WUFDNUQsS0FBSyxFQUFFLFNBQVM7WUFDaEIsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRSxLQUFLO2FBQ1o7U0FDRixDQUFDLENBQUM7UUFFSCxXQUFLLEdBQUcsU0FBUyxDQUFDO1FBSWhCLEtBQUksQ0FBQyxPQUFPLEdB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Q0FBQyxHQUFHLENBQUMsQ0FBQzthQUN2QixTQUFTLENBQUMsVUFBQSxRQUFRLElBQUksT0FBQSxRQUFRLElBQUksS0FBSSxDQUFDLFlBQVksSUFBSSxLQUFJLENBQUMsZUFBZSxFQUFFLEVBQXZELENBQXVELENBQUMsQ0FBQztJQUNwRixDQUFDO0lBRUQsNkNBQXFCLEdBQXJCO1FBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQztJQUNsQyxDQUFDOztnQkF4RnFDLGdCQUFnQjtnQkFBbUIsY0FBYzs7O0lBbEI1RSxhQUFhO1FBSHpCLFVBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7T0FDVyxhQUFhLENBMkd6Qjt3QkF6SEQ7Q0F5SEMsQUEzR0QsQ0FBbUMsWUFBWSxHQTJHOUM7U0EzR1ksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAsIGNvbWJpbmVMYXRlc3QsIGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9wdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL29wdGlvbnMuc2VydmljZSc7XG5pbXBvcnQgeyBTdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9jb21tb24vc3RhdGUtc2VydmljZS5hYnN0cmFjdCc7XG5pbXBvcnQgeyBOYXZpZ2F0b3JTZXJ2aWNlIH0gZnJvbSAnLi4vbmF2aWdhdG9yL25hdmlnYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IEhlYWRlciB9IGZyb20gJy4vaGVhZGVyLm1vZGVsJztcblxuLyoqXG4gKiBBIHNlcnZpY2Ugd2hpY2ggZGVmaW5lcyBoZWFkZXIgZnVuY3Rpb25zLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBIZWFkZXJTZXJ2aWNlIGV4dGVuZHMgU3RhdGVTZXJ2aWNlIHtcbiAgaGVhZGVyJDogT2JzZXJ2YWJsZTxIZWFkZXI+O1xuICBuYXZpZ2F0b3JPcGVuJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICBoYXNJdGVtc0luTmF2aWdhdG9yJCA9IHRoaXMubmF2aWdhdG9yU2VydmljZS5pdGVtcyQucGlwZShcbiAgICBtYXAoKHsgbGVuZ3RoIH0pID0+ICEhbGVuZ3RoKSxcbiAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXG4gICk7XG5cbiAgc3RhdGUkOiBCZWhhdmlvclN1YmplY3Q8SGVhZGVyPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8SGVhZGVyPih7XG4gICAgdGl0bGU6IHVuZGVmaW5lZCxcbiAgICBuYXY6IHtcbiAgICAgIG9wZW46IGZhbHNlXG4gICAgfVxuICB9KTtcblxuICB0aXRsZSA9IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5hdmlnYXRvclNlcnZpY2U6IE5hdmlnYXRvclNlcnZpY2UsIHByaXZhdGUgb3B0aW9uczogT3B0aW9uc1NlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuaGVhZGVyJCA9IHRoaXMubWFwKChoZWFkZXI6IEhlYWRlcikgPT4gaGVhZGVyKTtcbiAgICB0aGlzLm5hdmlnYXRvck9wZW4kID0gdGhpcy5tYXAoKHsgbmF2IH0pID0+IG5hdi5vcGVuKS5waXBlKFxuICAgICAgY29tYmluZUxhdGVzdCh0aGlzLmhhc0l0ZW1zSW5OYXZpZ2F0b3IkKSxcbiAgICAgIG1hcCgoW29wZW4sIGhhc0l0ZW1zXSkgPT4gb3BlbiAmJiBoYXNJdGVtcylcbiAgICApO1xuICAgIGNvbnN0IHRpdGxlUmVmZXJlbmNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGl0bGUnKTtcbiAgICB0aGlzLnRpdGxlID0ge1xuICAgICAgZWxlbWVudFJlZjogdGl0bGVSZWZlcmVuY2UsXG4gICAgICBvcmlnaW5hbFZhbHVlOiB0aXRsZVJlZmVyZW5jZSAmJiB0aXRsZVJlZmVyZW5jZS5pbm5lclRleHRcbiAgICB9O1xuICB9XG5cbiAgZ2V0IHN0YXRlKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlJC52YWx1ZTtcbiAgfVxuXG4gIGdldCBuYXZpZ2F0b3JIaWRkZW5PblN0YXJ0dXAoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5oaWRlTmF2aWdhdG9yO1xuICB9XG5cbiAgZ2V0IGxhcmdlV2lkdGgoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA+IDEyMDA7XG4gIH1cblxuICBnZXQgc2hvdWxkVG9nZ2xlKCkge1xuICAgIHJldHVybiB0aGlzLmxhcmdlV2lkdGggJiYgIXRoaXMubmF2aWdhdG9ySGlkZGVuT25TdGFydHVwICYmICF0aGlzLnN0YXRlLm5hdi5vcGVuO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgdGhlIG5hdmlnYXRvciBvcGVuIHN0YXR1cy5cbiAgICovXG4gIHRvZ2dsZU5hdmlnYXRvcigpIHtcbiAgICB0aGlzLnN0YXRlLm5hdi5vcGVuID0gIXRoaXMuc3RhdGUubmF2Lm9wZW47XG4gICAgdGhpcy5lbWl0TmV3U3RhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JjZSB0byBjbG9zZSB0aGUgbmF2aWdhdG9yLlxuICAgKi9cbiAgY2xvc2VOYXZpZ2F0b3IoKSB7XG4gICAgdGhpcy5zdGF0ZS5uYXYub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuZW1pdE5ld1N0YXRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJlcyBuYXZpZ2F0aW9uIG9wdGlvbnMuXG4gICAqIEBwYXJhbSBjb25maWcgT2JqZWN0IHdpdGggdGhlIHByb3BlcnRpZXM6XG4gICAqIC0gb3BlbjogQm9vbGVhblxuICAgKi9cbiAgY29uZmlnTmF2aWdhdG9yKGNvbmZpZzogYW55ID0ge30pIHtcbiAgICB0aGlzLnN0YXRlLm5hdiA9IE9iamVjdC5hc3NpZ24odGhpcy5zdGF0ZS5uYXYsIGNvbmZpZyk7XG4gICAgdGhpcy5lbWl0TmV3U3RhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIGFwcGxpY2F0aW9uIHRpdGxlLlxuICAgKiBAcGFyYW0gbmV3VGl0bGUgVGhlIG5ldyB0aXRsZSBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqL1xuICBjaGFuZ2VUaXRsZShuZXdUaXRsZT86IGFueSkge1xuICAgIHRoaXMuc3RhdGUudGl0bGUgPSBuZXdUaXRsZTtcbiAgICB0aGlzLmVtaXROZXdTdGF0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgcGFnZSB0aXRsZS5cbiAgICogQHBhcmFtIG5ld1RpdGxlIFRoZSBuZXcgdGl0bGUgb2YgdGhlIHBhZ2UuXG4gICAqL1xuICBjaGFuZ2VQYWdlVGl0bGUobmV3VGl0bGU/OiBzdHJpbmcpIHtcbiAgICB0aGlzLnRpdGxlLmVsZW1lbnRSZWYuaW5uZXJUZXh0ID0gbmV3VGl0bGVcbiAgICAgID8gYCR7bmV3VGl0bGV9IC8gJHt0aGlzLnRpdGxlLm9yaWdpbmFsVmFsdWV9YFxuICAgICAgOiBgJHt0aGlzLnRpdGxlLm9yaWdpbmFsVmFsdWV9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZHMgY2hlY2tzIGlmIHRoZSBuYXZpZ2F0b3IgdG9nZ2xlcyBvbiBzdGFydHVwXG4gICAqIG9yIGlmIGFuIGl0ZW0gaXMgYWRkZWQgdG8gdGhlIG5hdmlnYXRvciBub2RlLlxuICAgKiBEZWxheSBvZiAzMDBtcyBpcyBpbnRlbmRlZCBmb3IgYW5pbWF0aW9uIHB1cnBvc2UuXG4gICAqL1xuICB2ZXJpZnlJZk5hdk9wZW4oKSB7XG4gICAgdGhpcy5oYXNJdGVtc0luTmF2aWdhdG9yJFxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpXG4gICAgICAuc3Vic2NyaWJlKGhhc0l0ZW1zID0+IGhhc0l0ZW1zICYmIHRoaXMuc2hvdWxkVG9nZ2xlICYmIHRoaXMudG9nZ2xlTmF2aWdhdG9yKCkpO1xuICB9XG5cbiAgc2hvdWxkU2hvd0JyZWFkY3J1bWJzKCkge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYnJlYWRjcnVtYnM7XG4gIH1cbn1cbiJdfQ==