import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Base } from './export-schedules.interface';
import { TranslateService } from '@ngx-translate/core';
import { formatDate } from '@angular/common';
import { gettext } from '@c8y/ngx-components';
var CronService = /** @class */ (function () {
    function CronService(translateService) {
        this.translateService = translateService;
        this.daysOfWeekPosix = [];
        this.daysOfMonth = [
            { value: '1', label: '1.' },
            { value: '2', label: '2.' },
            { value: '3', label: '3.' },
            { value: '4', label: '4.' },
            { value: '5', label: '5.' },
            { value: '6', label: '6.' },
            { value: '7', label: '7.' },
            { value: '8', label: '8.' },
            { value: '9', label: '9.' },
            { value: '10', label: '10.' },
            { value: '11', label: '11.' },
            { value: '12', label: '12.' },
            { value: '13', label: '13.' },
            { value: '14', label: '14.' },
            { value: '15', label: '15.' },
            { value: '16', label: '16.' },
            { value: '17', label: '17.' },
            { value: '18', label: '18.' },
            { value: '19', label: '19.' },
            { value: '20', label: '20.' },
            { value: '21', label: '21.' },
            { value: '22', label: '22.' },
            { value: '23', label: '23.' },
            { value: '24', label: '24.' },
            { value: '25', label: '25.' },
            { value: '26', label: '26.' },
            { value: '27', label: '27.' },
            { value: '28', label: '28.' },
            { value: '29', label: '29.' },
            { value: '30', label: '30.' },
            { value: '31', label: '31.' }
        ];
        this.months = [];
        this.hours = [];
        this.minutes = [];
        this.intervals = [
            { value: 2, label: gettext('Hour') },
            { value: 3, label: gettext('Day') },
            { value: 4, label: gettext('Week') },
            { value: 5, label: gettext('Month') },
            { value: 6, label: gettext('Year') }
        ];
        for (var x = 0; x < 24; x++) {
            this.hours.push({ value: x.toString(), label: "" + x });
        }
        for (var x = 0; x < 60; x = x + 5) {
            this.minutes.push({ value: x.toString(), label: "" + x });
        }
        for (var x = 0; x < 7; x++) {
            this.daysOfWeekPosix.push({
                value: x.toString(),
                label: this.getWeekDayName({ weekday: x })
            });
        }
        for (var x = 1; x < 13; x++) {
            this.months.push({
                value: x.toString(),
                label: this.getMonthName({ month: x })
            });
        }
    }
    CronService.prototype.generateCron = function (cronConfig) {
        var cron = '';
        cron = cronConfig.minute ? "" + cronConfig.minute : '*';
        cron += cronConfig.hour ? " " + cronConfig.hour : ' *';
        cron += cronConfig.day ? " " + cronConfig.day : ' *';
        cron += cronConfig.month ? " " + cronConfig.month : ' *';
        cron += cronConfig.weekday ? " " + cronConfig.weekday : ' *';
        return cron;
    };
    CronService.prototype.generateCronConfig = function (cron) {
        var parts = cron.split(/\s+/);
        var cronConfig = {
            minute: parts[0],
            hour: parts[1],
            day: parts[2],
            month: parts[3],
            weekday: parts[4]
        };
        return cronConfig;
    };
    CronService.prototype.getBase = function (cronConfig) {
        var base = Base.Initial;
        if (cronConfig.minute !== '*' &&
            cronConfig.hour === '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Hour;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Day;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday !== '*') {
            base = Base.Week;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Month;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month !== '*' &&
            cronConfig.weekday === '*') {
            base = Base.Year;
        }
        else {
            // cronConfig invalid
        }
        return base;
    };
    CronService.prototype.validateModels = function (base, cronConfig) {
        var valid;
        switch (base) {
            case Base.Initial: // Please select
                valid = false;
                break;
            case Base.Hour:
                if (cronConfig.minute !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Day:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Week:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.weekday !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Month:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.day !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Year:
                if (cronConfig.minute !== '*' &&
                    cronConfig.hour !== '*' &&
                    cronConfig.day !== '*' &&
                    cronConfig.month !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            default:
                valid = false;
        }
        return valid;
    };
    CronService.prototype.clearNextModels = function (base, cronConfig) {
        if (base === Base.Initial) {
            // please select, delete all
            // cron expression: every minute at second 0
            cronConfig.weekday = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.hour = '*';
            cronConfig.minute = '*';
        }
        else if (base === Base.Hour) {
            // hour, don't delete minutes
            // cron expression: every hour, at whatever minute, at second 0
            cronConfig.weekday = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.hour = '*';
        }
        else if (base === Base.Day) {
            // day, don't delete minutes and hours
            // cron expression: every day of every month, at whatever hour and minute, at second 0
            cronConfig.weekday = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
        }
        else if (base === Base.Week) {
            // week, delete month and day
            // cron expression: every month, at whatever weekday, hour and minute, at second 0
            cronConfig.day = '*';
            cronConfig.month = '*';
        }
        else if (base === Base.Month) {
            // month, delete month and weekday
            // cron expression: every month, at whatever day of month, hour and minute, at second 0
            cronConfig.weekday = '*';
            cronConfig.month = '*';
        }
        else if (base === Base.Year) {
            // year, delete weekday
            // cron expression: every year, at whatever month, day of month, hour and minute, at second 0
            cronConfig.weekday = '*';
        }
    };
    CronService.prototype.getWeekDayName = function (cronConfig) {
        var date = new Date(0);
        var firstSundayDate = date.getDate() + 3; // because we know date 0 was on Thursday...
        date.setDate(firstSundayDate + parseInt(cronConfig.weekday, 10));
        return formatDate(date, 'EEEE', this.translateService.currentLang);
    };
    CronService.prototype.getMonthDayName = function (cronConfig) {
        var name = '';
        this.daysOfMonth.forEach(function (item) {
            if (item.value === cronConfig.day) {
                name = item.label;
            }
        });
        return name;
    };
    CronService.prototype.getMonthName = function (cronConfig) {
        var date = new Date(0);
        date.setMonth(parseInt(cronConfig.month, 10) - 1);
        return formatDate(date, 'LLLL', this.translateService.currentLang);
    };
    CronService.ctorParameters = function () { return [
        { type: TranslateService }
    ]; };
    CronService = tslib_1.__decorate([
        Injectable()
    ], CronService);
    return CronService;
}());
export { CronService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvcnRzLyIsInNvdXJjZXMiOlsiY3Jvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxJQUFJLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRzlDO0lBNkNFLHFCQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQTVDdEQsb0JBQWUsR0FBVSxFQUFFLENBQUM7UUFDNUIsZ0JBQVcsR0FBRztZQUNaLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzNCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO1lBQzdCLEVBQUUsS0FBSyxF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LElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDakMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7YUFDbkI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELGtDQUFZLEdBQVosVUFBYSxVQUFzQjtRQUNqQyxJQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE9BQU8sVUFBVSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7O2dCQW5OcUMsZ0JBQWdCOztJQTdDM0MsV0FBVztRQUR2QixVQUFVLEVBQUU7T0FDQSxXQUFXLENBaVF2QjtJQUFELGtCQUFDO0NBQUEsQUFqUUQsSUFpUUM7U0FqUVksV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENyb25Db25maWcsIEJhc2UgfSBmcm9tICcuL2V4cG9ydC1zY2hlZHVsZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ3JvblNlcnZpY2Uge1xuICBkYXlzT2ZXZWVrUG9zaXg6IGFueVtdID0gW107XG4gIGRheXNPZk1vbnRoID0gW1xuICAgIHsgdmFsdWU6ICcxJywgbGFiZWw6ICcxLicgfSxcbiAgICB7IHZhbHVlOiAnMicsIGxhYmVsOiAnMi4nIH0sXG4gICAgeyB2YWx1ZTogJzMnLCBsYWJlbDogJzMuJyB9LFxuICAgIHsgdmFsdWU6ICc0JywgbGFiZWw6ICc0LicgfSxcbiAgICB7IHZhbHVlOiAnNScsIGxhYmVsOiAnNS4nIH0sXG4gICAgeyB2YWx1ZTogJzYnLCBsYWJlbDogJzYuJyB9LFxuICAgIHsgdmFsdWU6ICc3JywgbGFiZWw6ICc3LicgfSxcbiAgICB7IHZhbHVlOiAnOCcsIGxhYmVsOiAnOC4nIH0sXG4gICAgeyB2YWx1ZTogJzknLCBsYWJlbDogJzkuJyB9LFxuICAgIHsgdmFsdWU6ICcxMCcsIGxhYmVsOiAnMTAuJyB9LFxuICAgIHsgdmFsdWU6ICcxMScsIGxhYmVsOiAnMTEuJyB9LFxuICAgIHsgdmFsdWU6ICcxMicsIGxhYmVsOiAnMTIuJyB9LFxuICAgIHsgdmFsdWU6ICcxMycsIGxhYmVsOiAnMTMuJyB9LFxuICAgIHsgdmFsdWU6ICcxNCcsIGxhYmVsOiAnMTQuJyB9LFxuICAgIHsgdmFsdWU6ICcxNScsIGxhYmVsOiAnMTUuJyB9LFxuICAgIHsgdmFsdWU6ICcxNicsIGxhYmVsOiAnMTYuJyB9LFxuICAgIHsgdmFsdWU6ICcxNycsIGxhYmVsOiAnMTcuJyB9LFxuICAgIHsgdmFsdWU6ICcxOCcsIGxhYmVsOiAnMTguJyB9LFxuICAgIHsgdmFsdWU6ICcxOScsIGxhYmVsOiAnMTkuJyB9LFxuICAgIHsgdmFsdWU6ICcyMCcsIGxhYmVsOiAnMjAuJyB9LFxuICAgIHsgdmFsdWU6ICcyMScsIGxhYmVsOiAnMjEuJyB9LFxuICAgIHsgdmFsdWU6ICcyMicsIGxhYmVsOiAnMjIuJyB9LFxuICAgIHsgdmFsdWU6ICcyMycsIGxhYmVsOiAnMjMuJyB9LFxuICAgIHsgdmFsdWU6ICcyNCcsIGxhYmVsOiAnMjQuJyB9LFxuICAgIHsgdmFsdWU6ICcyNScsIGxhYmVsOiAnMjUuJyB9LFxuICAgIHsgdmFsdWU6ICcyNicsIGxhYmVsOiAnMjYuJyB9LFxuICAgIHsgdmFsdWU6ICcyNycsIGxhYmVsOiAnMjcuJyB9LFxuICAgIHsgdmFsdWU6ICcyOCcsIGxhYmVsOiAnMjguJyB9LFxuICAgIHsgdmFsdWU6ICcyOScsIGxhYmVsOiAnMjkuJyB9LFxuICAgIHsgdmFsdWU6ICczMCcsIGxhYmVsOiAnMzAuJyB9LFxuICAgIHsgdmFsdWU6ICczMScsIGxhYmVsOiAnMzEuJyB9XG4gIF07XG4gIG1vbnRoczogYW55W10gPSBbXTtcbiAgaG91cnM6IGFueVtdID0gW107XG4gIG1pbnV0ZXM6IGFueVtdID0gW107XG4gIGludGVydmFscyA9IFtcbiAgICB7IHZhbHVlOiAyLCBsYWJlbDogZ2V0dGV4dCgnSG91cicpIH0sXG4gICAgeyB2YWx1ZTogMywgbGFiZWw6IGdldHRleHQoJ0RheScpIH0sXG4gICAgeyB2YWx1ZTogNCwgbGFiZWw6IGdldHRleHQoJ1dlZWsnKSB9LFxuICAgIHsgdmFsdWU6IDUsIGxhYmVsOiBnZXR0ZXh0KCdNb250aCcpIH0sXG4gICAgeyB2YWx1ZTogNiwgbGFiZWw6IGdldHRleHQoJ1llYXInKSB9XG4gIF07XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSkge1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgMjQ7IHgrKykge1xuICAgICAgdGhpcy5ob3Vycy5wdXNoKHsgdmFsdWU6IHgudG9TdHJpbmcoKSwgbGFiZWw6IGAke3h9YCB9KTtcbiAgICB9XG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCA2MDsgeCA9IHggKyA1KSB7XG4gICAgICB0aGlzLm1pbnV0ZXMucHVzaCh7IHZhbHVlOiB4LnRvU3RyaW5nKCksIGxhYmVsOiBgJHt4fWAgfSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCA3OyB4KyspIHtcbiAgICAgIHRoaXMuZGF5c09mV2Vla1Bvc2l4LnB1c2goe1xuICAgICAgICB2YWx1ZTogeC50b1N0cmluZygpLFxuICAgICAgICBsYWJlbDogdGhpcy5nZXRXZWVrRGF5TmFtZSgoeyB3ZWVrZGF5OiB4IH0gYXMgdW5rbm93bikgYXMgQ3JvbkNvbmZpZylcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZvciAobGV0IHggPSAxOyB4IDwgMTM7IHgrKykge1xuICAgICAgdGhpcy5tb250aHMucHVzaCh7XG4gICAgICAgIHZhbHVlOiB4LnRvU3RyaW5nKCksXG4gICAgICAgIGxhYmVsOiB0aGlzLmdldE1vbnRoTmFtZSgoeyBtb250aDogeCB9IGFzIHVua25vd24pIGFzIENyb25Db25maWcpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZW5lcmF0ZUNyb24oY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGxldCBjcm9uOiBzdHJpbmcgPSAnJztcbiAgICBjcm9uID0gY3JvbkNvbmZpZy5taW51dGUgPyBgJHtjcm9uQ29uZmlnLm1pbnV0ZX1gIDogJyonO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy5ob3VyID8gYCAke2Nyb25Db25maWcuaG91cn1gIDogJyAqJztcbiAgICBjcm9uICs9IGNyb25Db25maWcuZGF5ID8gYCAke2Nyb25Db25maWcuZGF5fWAgOiAnIConO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy5tb250aCA/IGAgJHtjcm9uQ29uZmlnLm1vbnRofWAgOiAnIConO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy53ZWVrZGF5ID8gYCAke2Nyb25Db25maWcud2Vla2RheX1gIDogJyAqJztcblxuICAgIHJldHVybiBjcm9uO1xuICB9XG5cbiAgZ2VuZXJhdGVDcm9uQ29uZmlnKGNyb246IHN0cmluZykge1xuICAgIGNvbnN0IHBhcnRzID0gY3Jvbi5zcGxpdCgvXFxzKy8pO1xuICAgIGNvbnN0IGNyb25Db25maWc6IENyb25Db25maWcgPSB7XG4gICAgICBtaW51dGU6IHBhcnRzWzBdLFxuICAgICAgaG91cjogcGFydHNbMV0sXG4gICAgICBkYXk6IHBhcnRzWzJdLFxuICAgICAgbW9udGg6IHBhcnRzWzNdLFxuICAgICAgd2Vla2RheTogcGFydHNbNF1cbiAgICB9O1xuXG4gICAgcmV0dXJuIGNyb25Db25maWc7XG4gIH1cblxuICBnZXRCYXNlKGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBsZXQgYmFzZTogQmFzZSA9IEJhc2UuSW5pdGlhbDtcblxuICAgIGlmIChcbiAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuaG91ciA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmRheSA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9PT0gJyonXG4gICAgKSB7XG4gICAgICBiYXNlID0gQmFzZS5Ib3VyO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuRGF5O1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgIT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuV2VlaztcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuZGF5ICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcubW9udGggPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID09PSAnKidcbiAgICApIHtcbiAgICAgIGJhc2UgPSBCYXNlLk1vbnRoO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuWWVhcjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY3JvbkNvbmZpZyBpbnZhbGlkXG4gICAgfVxuXG4gICAgcmV0dXJuIGJhc2U7XG4gIH1cblxuICB2YWxpZGF0ZU1vZGVscyhiYXNlOiBCYXNlLCBjcm9uQ29uZmlnOiBDcm9uQ29uZmlnKSB7XG4gICAgbGV0IHZhbGlkOiBib29sZWFuO1xuICAgIHN3aXRjaCAoYmFzZSkge1xuICAgICAgY2FzZSBCYXNlLkluaXRpYWw6IC8vIFBsZWFzZSBzZWxlY3RcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEJhc2UuSG91cjpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicpIHtcbiAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5EYXk6XG4gICAgICAgIGlmIChjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmIGNyb25Db25maWcuaG91ciAhPT0gJyonKSB7XG4gICAgICAgICAgdmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEJhc2UuV2VlazpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicgJiYgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiYgY3JvbkNvbmZpZy53ZWVrZGF5ICE9PSAnKicpIHtcbiAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5Nb250aDpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicgJiYgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiYgY3JvbkNvbmZpZy5kYXkgIT09ICcqJykge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBCYXNlLlllYXI6XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICAgICAgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiZcbiAgICAgICAgICBjcm9uQ29uZmlnLmRheSAhPT0gJyonICYmXG4gICAgICAgICAgY3JvbkNvbmZpZy5tb250aCAhPT0gJyonXG4gICAgICAgICkge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH1cblxuICBjbGVhck5leHRNb2RlbHMoYmFzZTogQmFzZSwgY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGlmIChiYXNlID09PSBCYXNlLkluaXRpYWwpIHtcbiAgICAgIC8vIHBsZWFzZSBzZWxlY3QsIGRlbGV0ZSBhbGxcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgbWludXRlIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLmRheSA9ICcqJztcbiAgICAgIGNyb25Db25maWcubW9udGggPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLmhvdXIgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSA9ICcqJztcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuSG91cikge1xuICAgICAgLy8gaG91ciwgZG9uJ3QgZGVsZXRlIG1pbnV0ZXNcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgaG91ciwgYXQgd2hhdGV2ZXIgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5ob3VyID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5EYXkpIHtcbiAgICAgIC8vIGRheSwgZG9uJ3QgZGVsZXRlIG1pbnV0ZXMgYW5kIGhvdXJzXG4gICAgICAvLyBjcm9uIGV4cHJlc3Npb246IGV2ZXJ5IGRheSBvZiBldmVyeSBtb250aCwgYXQgd2hhdGV2ZXIgaG91ciBhbmQgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5XZWVrKSB7XG4gICAgICAvLyB3ZWVrLCBkZWxldGUgbW9udGggYW5kIGRheVxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBtb250aCwgYXQgd2hhdGV2ZXIgd2Vla2RheSwgaG91ciBhbmQgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5Nb250aCkge1xuICAgICAgLy8gbW9udGgsIGRlbGV0ZSBtb250aCBhbmQgd2Vla2RheVxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBtb250aCwgYXQgd2hhdGV2ZXIgZGF5IG9mIG1vbnRoLCBob3VyIGFuZCBtaW51dGUsIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5ZZWFyKSB7XG4gICAgICAvLyB5ZWFyLCBkZWxldGUgd2Vla2RheVxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSB5ZWFyLCBhdCB3aGF0ZXZlciBtb250aCwgZGF5IG9mIG1vbnRoLCBob3VyIGFuZCBtaW51dGUsIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSAnKic7XG4gICAgfVxuICB9XG5cbiAgZ2V0V2Vla0RheU5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgwKTtcbiAgICBjb25zdCBmaXJzdFN1bmRheURhdGUgPSBkYXRlLmdldERhdGUoKSArIDM7IC8vIGJlY2F1c2Ugd2Uga25vdyBkYXRlIDAgd2FzIG9uIFRodXJzZGF5Li4uXG4gICAgZGF0ZS5zZXREYXRlKGZpcnN0U3VuZGF5RGF0ZSArIHBhcnNlSW50KGNyb25Db25maWcud2Vla2RheSwgMTApKTtcbiAgICByZXR1cm4gZm9ybWF0RGF0ZShkYXRlLCAnRUVFRScsIHRoaXMudHJhbnNsYXRlU2VydmljZS5jdXJyZW50TGFuZyk7XG4gIH1cblxuICBnZXRNb250aERheU5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGxldCBuYW1lID0gJyc7XG4gICAgdGhpcy5kYXlzT2ZNb250aC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IGNyb25Db25maWcuZGF5KSB7XG4gICAgICAgIG5hbWUgPSBpdGVtLmxhYmVsO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICBnZXRNb250aE5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgwKTtcbiAgICBkYXRlLnNldE1vbnRoKHBhcnNlSW50KGNyb25Db25maWcubW9udGgsIDEwKSAtIDEpO1xuICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGUsICdMTExMJywgdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmN1cnJlbnRMYW5nKTtcbiAgfVxufVxuIl19