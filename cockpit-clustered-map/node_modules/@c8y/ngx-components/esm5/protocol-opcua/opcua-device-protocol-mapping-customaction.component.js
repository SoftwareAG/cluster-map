import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { NgModelGroup, ControlContainer } from '@angular/forms';
import { get } from 'lodash-es';
var OpcuaDeviceProtocolMappingCustomAction = /** @class */ (function () {
    function OpcuaDeviceProtocolMappingCustomAction() {
        this.hasCustomAction = false;
    }
    OpcuaDeviceProtocolMappingCustomAction.prototype.getHeaderPair = function () {
        return { key: '', value: '' };
    };
    Object.defineProperty(OpcuaDeviceProtocolMappingCustomAction.prototype, "headers", {
        get: function () {
            return this.customAction.headers;
        },
        enumerable: true,
        configurable: true
    });
    OpcuaDeviceProtocolMappingCustomAction.prototype.addHeader = function () {
        var headers = this.customAction.headers;
        headers.push(this.getHeaderPair());
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.updateCustomAction = function () {
        this.hasCustomAction = !this.hasCustomAction;
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.removeCustomAction = function (index) {
        var headers = this.customAction.headers;
        headers.splice(index, 1);
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.trackByIndex = function (index) {
        return index;
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.ngOnInit = function () {
        if (get(this.customAction, 'endpoint')) {
            this.hasCustomAction = true;
        }
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.placeholder = function () {
        var exampleBody = {
            value: '${value}',
            serverId: '${serverId}',
            nodeId: '${nodeId}',
            deviceId: '${deviceId}'
        };
        var pretty = JSON.stringify(exampleBody, undefined, 2);
        return pretty.replace(/"\$\{value\}\"/, '${value}');
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.bodyTemplateMessage = function (text) {
        this.bodyTemplateInvalidMessage = text;
    };
    tslib_1.__decorate([
        Input()
    ], OpcuaDeviceProtocolMappingCustomAction.prototype, "customAction", void 0);
    OpcuaDeviceProtocolMappingCustomAction = tslib_1.__decorate([
        Component({
            selector: 'opcua-device-protocol-mapping-customaction',
            template: "<div class=\"list-group\" style=\"box-shadow:none;\">\n  <div class=\"list-group-item\">\n    <div class=\"flex-row\">\n      <div class=\"list-item-switch\">\n        <label class=\"c8y-switch\">\n          <input\n            type=\"checkbox\"\n            name=\"hasCustomAction\"\n            [(ngModel)]=\"hasCustomAction\"\n            (click)=\"updateCustomAction()\"\n          />\n          <span></span>\n        </label>\n      </div>\n      <div class=\"list-item-icon\">\n        <i c8yIcon=\"wrench\"></i>\n      </div>\n      <div class=\"list-item-title\" translate>\n        Custom action\n      </div>\n    </div>\n    <div [collapse]=\"!hasCustomAction\" [isAnimated]=\"true\">\n      <div class=\"top-p-sm\" *ngIf=\"hasCustomAction\">\n        <fieldset ngModelGroup=\"headers\">\n          <div class=\"legend form-block\" translate>Headers</div>\n          <div class=\"tight-grid flex-row hidden-xs\">\n            <div class=\"col-sm-4\">\n              <label translate>Key</label>\n            </div>\n            <div class=\"col-sm-4\">\n              <label translate>Value</label>\n            </div>\n          </div>\n          <div\n            *ngFor=\"let header of headers; trackBy: trackByIndex; let i = index; last as isLast\"\n            class=\"flex-row tight-grid row\"\n            [ngModelGroup]=\"i\"\n          >\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Key</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"key\"\n                    placeholder=\"{{ 'e.g.' | translate }} Content-Type\"\n                    required\n                    [(ngModel)]=\"header.key\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Value</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"value\"\n                    placeholder=\"{{ 'e.g.' | translate }} application/json\"\n                    required\n                    [(ngModel)]=\"header.value\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-2\">\n              <div class=\"form-group\">\n                <label class=\"visible-xs\">&nbsp;</label>\n                <button class=\"btn btn-clean\" *ngIf=\"customAction.headers.length !== 1\">\n                  <i c8yIcon=\"minus-circle\" class=\"text-danger\" (click)=\"removeCustomAction(i)\"></i>\n                </button>\n                <button class=\"btn btn-clean\" *ngIf=\"isLast\">\n                  <i c8yIcon=\"plus-circle\" class=\"text-primary\" (click)=\"addHeader()\"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </fieldset>\n        <div class=\"legend form-block\" translate>Action</div>\n        <div class=\"row\">\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label>\n                <span translate>Endpoint</span>\n              </label>\n              <div class=\"input-group\">\n                <input\n                  class=\"form-control\"\n                  type=\"text\"\n                  name=\"endpoint\"\n                  placeholder=\"{{ 'e.g.' | translate }} http://localhost:1080/cucumber\"\n                  required\n                  [(ngModel)]=\"customAction.endpoint\"\n                />\n              </div>\n            </c8y-form-group>\n          </div>\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label translate>Body template</label>\n              <textarea\n                [heightPerRow]=\"40\"\n                prettyValidJson\n                class=\"form-control\"\n                rows=\"3\"\n                name=\"bodyTemplate\"\n                [placeholder]=\"placeholder()\"\n                [(ngModel)]=\"customAction.bodyTemplate\"\n                (invalidJSON)=\"bodyTemplateMessage($event)\"\n              ></textarea>\n              <c8y-messages>\n                <c8y-message *ngIf=\"bodyTemplateInvalidMessage\">{{\n                  bodyTemplateInvalidMessage | translate\n                }}</c8y-message>\n              </c8y-messages>\n            </c8y-form-group>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
            viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
        })
    ], OpcuaDeviceProtocolMappingCustomAction);
    return OpcuaDeviceProtocolMappingCustomAction;
}());
export { OpcuaDeviceProtocolMappingCustomAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmctY3VzdG9tYWN0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvcHJvdG9jb2wtb3BjdWEvIiwic291cmNlcyI6WyJvcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQU9oQztJQUxBO1FBU0Usb0JBQWUsR0FBRyxLQUFLLENBQUM7SUFrRDFCLENBQUM7SUEvQ0MsOERBQWEsR0FBYjtRQUNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBRUQsc0JBQUksMkRBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7UUFDbkMsQ0FBQzs7O09BQUE7SUFFRCwwREFBUyxHQUFUO1FBQ1UsSUFBQSxtQ0FBTyxDQUF1QjtRQUN0QyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxtRUFBa0IsR0FBbEI7UUFDRSxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUMvQyxDQUFDO0lBRUQsbUVBQWtCLEdBQWxCLFVBQW1CLEtBQUs7UUFDZCxJQUFBLG1DQUFPLENBQXVCO1FBRXRDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFRCw2REFBWSxHQUFaLFVBQWEsS0FBYTtRQUN4QixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCx5REFBUSxHQUFSO1FBQ0UsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUMsRUFBRTtZQUN0QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztTQUM3QjtJQUNILENBQUM7SUFFRCw0REFBVyxHQUFYO1FBQ0UsSUFBTSxXQUFXLEdBQUc7WUFDbEIsS0FBSyxFQUFFLFVBQVU7WUFDakIsUUFBUSxFQUFFLGFBQWE7WUFDdkIsTUFBTSxFQUFFLFdBQVc7WUFDbkIsUUFBUSxFQUFFLGFBQWE7U0FDeEIsQ0FBQztRQUNGLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RCxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVELG9FQUFtQixHQUFuQixVQUFvQixJQUFJO1FBQ3RCLElBQUksQ0FBQywwQkFBMEIsR0FBRyxJQUFJLENBQUM7SUFDekMsQ0FBQztJQW5EUTtRQUFSLEtBQUssRUFBRTtnRkFBYztJQUZYLHNDQUFzQztRQUxsRCxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsNENBQTRDO1lBQ3RELHl1SkFBZ0U7WUFDaEUsYUFBYSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxDQUFDO1NBQzFFLENBQUM7T0FDVyxzQ0FBc0MsQ0FzRGxEO0lBQUQsNkNBQUM7Q0FBQSxBQXRERCxJQXNEQztTQXREWSxzQ0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nTW9kZWxHcm91cCwgQ29udHJvbENvbnRhaW5lciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ29wY3VhLWRldmljZS1wcm90b2NvbC1tYXBwaW5nLWN1c3RvbWFjdGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24uaHRtbCcsXG4gIHZpZXdQcm92aWRlcnM6IFt7IHByb3ZpZGU6IENvbnRyb2xDb250YWluZXIsIHVzZUV4aXN0aW5nOiBOZ01vZGVsR3JvdXAgfV1cbn0pXG5leHBvcnQgY2xhc3MgT3BjdWFEZXZpY2VQcm90b2NvbE1hcHBpbmdDdXN0b21BY3Rpb24gaW1wbGVtZW50cyBPbkluaXQge1xuICBfbW9kZWw6IGFueTtcbiAgQElucHV0KCkgY3VzdG9tQWN0aW9uO1xuXG4gIGhhc0N1c3RvbUFjdGlvbiA9IGZhbHNlO1xuICBib2R5VGVtcGxhdGVJbnZhbGlkTWVzc2FnZTogc3RyaW5nO1xuXG4gIGdldEhlYWRlclBhaXIoKSB7XG4gICAgcmV0dXJuIHsga2V5OiAnJywgdmFsdWU6ICcnIH07XG4gIH1cblxuICBnZXQgaGVhZGVycygpIHtcbiAgICByZXR1cm4gdGhpcy5jdXN0b21BY3Rpb24uaGVhZGVycztcbiAgfVxuXG4gIGFkZEhlYWRlcigpIHtcbiAgICBjb25zdCB7IGhlYWRlcnMgfSA9IHRoaXMuY3VzdG9tQWN0aW9uO1xuICAgIGhlYWRlcnMucHVzaCh0aGlzLmdldEhlYWRlclBhaXIoKSk7XG4gIH1cblxuICB1cGRhdGVDdXN0b21BY3Rpb24oKSB7XG4gICAgdGhpcy5oYXNDdXN0b21BY3Rpb24gPSAhdGhpcy5oYXNDdXN0b21BY3Rpb247XG4gIH1cblxuICByZW1vdmVDdXN0b21BY3Rpb24oaW5kZXgpIHtcbiAgICBjb25zdCB7IGhlYWRlcnMgfSA9IHRoaXMuY3VzdG9tQWN0aW9uO1xuXG4gICAgaGVhZGVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG5cbiAgdHJhY2tCeUluZGV4KGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmIChnZXQodGhpcy5jdXN0b21BY3Rpb24sICdlbmRwb2ludCcpKSB7XG4gICAgICB0aGlzLmhhc0N1c3RvbUFjdGlvbiA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcGxhY2Vob2xkZXIoKSB7XG4gICAgY29uc3QgZXhhbXBsZUJvZHkgPSB7XG4gICAgICB2YWx1ZTogJyR7dmFsdWV9JyxcbiAgICAgIHNlcnZlcklkOiAnJHtzZXJ2ZXJJZH0nLFxuICAgICAgbm9kZUlkOiAnJHtub2RlSWR9JyxcbiAgICAgIGRldmljZUlkOiAnJHtkZXZpY2VJZH0nXG4gICAgfTtcbiAgICBjb25zdCBwcmV0dHkgPSBKU09OLnN0cmluZ2lmeShleGFtcGxlQm9keSwgdW5kZWZpbmVkLCAyKTtcbiAgICByZXR1cm4gcHJldHR5LnJlcGxhY2UoL1wiXFwkXFx7dmFsdWVcXH1cXFwiLywgJyR7dmFsdWV9Jyk7XG4gIH1cblxuICBib2R5VGVtcGxhdGVNZXNzYWdlKHRleHQpIHtcbiAgICB0aGlzLmJvZHlUZW1wbGF0ZUludmFsaWRNZXNzYWdlID0gdGV4dDtcbiAgfVxufVxuIl19