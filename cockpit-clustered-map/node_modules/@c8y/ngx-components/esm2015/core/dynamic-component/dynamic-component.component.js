import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, ComponentFactoryResolver, ViewContainerRef } from '@angular/core';
import { DynamicComponentService } from './dynamic-component.service';
/**
 * C8y dynamic component.
 * ## Example:
 *
 * register component in HOOK in module:
 * ```typescript
 *  import { HOOK_COMPONENT } from '@c8y/ngx-components';
 *
 * @NgModule({
 *  ...,
 *  providers: [{
 *      provide: HOOK_COMPONENT,
 *      multi: true,
 *      useValue: [{
 *          id: 'test-component',
 *          label: 'My test component',
 *          description: 'this is test component',
 *          component: TestComponent
 *      }],
 *  ...
 *  }]
 *
 * ```
 * Showing dynamic component:
 * ```html
 * <c8y-dynamic-component [componentId]="'test-component'" [config]="config"></c8y-dynamic-component>
 * ```
 */
let DynamicComponentComponent = class DynamicComponentComponent {
    constructor(componentFactoryResolver, dynamicComponentService) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.dynamicComponentService = dynamicComponentService;
        this.mode = 'component';
        this.notFoundError = true;
        this.expandErrorDetails = false;
    }
    ngOnChanges() {
        this.dynamicComponentService
            .getById$(this.componentId)
            .subscribe(cmp => this.loadComponent(cmp));
    }
    loadComponent(dynamicComponent) {
        try {
            this.error = undefined;
            const componentFactory = this.componentFactoryResolver.resolveComponentFactory(this.mode === 'component' ? dynamicComponent.component : dynamicComponent.configComponent);
            this.host.clear();
            const componentRef = this.host.createComponent(componentFactory);
            componentRef.instance.config = this.config;
        }
        catch (ex) {
            this.error = ex;
        }
    }
};
DynamicComponentComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: DynamicComponentService }
];
tslib_1.__decorate([
    Input()
], DynamicComponentComponent.prototype, "componentId", void 0);
tslib_1.__decorate([
    Input()
], DynamicComponentComponent.prototype, "config", void 0);
tslib_1.__decorate([
    Input()
], DynamicComponentComponent.prototype, "mode", void 0);
tslib_1.__decorate([
    Input()
], DynamicComponentComponent.prototype, "notFoundError", void 0);
tslib_1.__decorate([
    ViewChild('host', { read: ViewContainerRef, static: true })
], DynamicComponentComponent.prototype, "host", void 0);
DynamicComponentComponent = tslib_1.__decorate([
    Component({
        selector: 'c8y-dynamic-component',
        template: "<ng-template #host></ng-template>\n\n<div class=\"alert alert-warning m-8\" role=\"alert\" *ngIf=\"notFoundError && error\">\n  <strong class=\"message\">\n    {{\n      'This widget cannot be rendered because the current application does not support the following component:'\n        | translate\n    }}\n    {{ componentId }}.\n  </strong>\n  <p class=\"text-muted top-m-sm\">\n    <button class=\"btn btn-clean\" (click)=\"expandErrorDetails = !expandErrorDetails\">\n      <i class=\"fa fa-chevron-down\"></i>\n      <span *ngIf=\"!expandErrorDetails\" translate>Show details</span>\n      <span *ngIf=\"expandErrorDetails\" translate>Hide details</span>\n    </button>\n  </p>\n  <div [collapse]=\"!expandErrorDetails\" [isAnimated]=\"true\">\n    <pre>\n      {{ error }}\n    </pre>\n  </div>\n</div>\n"
    })
], DynamicComponentComponent);
export { DynamicComponentComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1jb21wb25lbnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvcmUvZHluYW1pYy1jb21wb25lbnQvZHluYW1pYy1jb21wb25lbnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxTQUFTLEVBQ1Qsd0JBQXdCLEVBQ3hCLGdCQUFnQixFQUNqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUV0RTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMkJHO0FBS0gsSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7SUFTcEMsWUFDVSx3QkFBa0QsRUFDbEQsdUJBQWdEO1FBRGhELDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF5QjtRQVJqRCxTQUFJLEdBQTJCLFdBQVcsQ0FBQztRQUMzQyxrQkFBYSxHQUFHLElBQUksQ0FBQztRQUc5Qix1QkFBa0IsR0FBRyxLQUFLLENBQUM7SUFLeEIsQ0FBQztJQUVKLFdBQVc7UUFDVCxJQUFJLENBQUMsdUJBQXVCO2FBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQzFCLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsYUFBYSxDQUFDLGdCQUFnQjtRQUM1QixJQUFJO1lBQ0YsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7WUFDdkIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsdUJBQXVCLENBQzVFLElBQUksQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FDMUYsQ0FBQztZQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDbEIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNoRSxZQUFZLENBQUMsUUFBNkIsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUNsRTtRQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ1gsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7U0FDakI7SUFDSCxDQUFDO0NBQ0YsQ0FBQTs7WUF2QnFDLHdCQUF3QjtZQUN6Qix1QkFBdUI7O0FBVmpEO0lBQVIsS0FBSyxFQUFFOzhEQUFxQjtBQUNwQjtJQUFSLEtBQUssRUFBRTt5REFBYTtBQUNaO0lBQVIsS0FBSyxFQUFFO3VEQUE0QztBQUMzQztJQUFSLEtBQUssRUFBRTtnRUFBc0I7QUFDK0I7SUFBNUQsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7dURBQXdCO0FBTHpFLHlCQUF5QjtJQUpyQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsdUJBQXVCO1FBQ2pDLHN6QkFBaUQ7S0FDbEQsQ0FBQztHQUNXLHlCQUF5QixDQWlDckM7U0FqQ1kseUJBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgVmlld0NoaWxkLFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEeW5hbWljQ29tcG9uZW50IH0gZnJvbSAnLi9keW5hbWljLWNvbXBvbmVudC5tb2RlbCc7XG5pbXBvcnQgeyBEeW5hbWljQ29tcG9uZW50U2VydmljZSB9IGZyb20gJy4vZHluYW1pYy1jb21wb25lbnQuc2VydmljZSc7XG5cbi8qKlxuICogQzh5IGR5bmFtaWMgY29tcG9uZW50LlxuICogIyMgRXhhbXBsZTpcbiAqXG4gKiByZWdpc3RlciBjb21wb25lbnQgaW4gSE9PSyBpbiBtb2R1bGU6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiAgaW1wb3J0IHsgSE9PS19DT01QT05FTlQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbiAqXG4gKiBATmdNb2R1bGUoe1xuICogIC4uLixcbiAqICBwcm92aWRlcnM6IFt7XG4gKiAgICAgIHByb3ZpZGU6IEhPT0tfQ09NUE9ORU5ULFxuICogICAgICBtdWx0aTogdHJ1ZSxcbiAqICAgICAgdXNlVmFsdWU6IFt7XG4gKiAgICAgICAgICBpZDogJ3Rlc3QtY29tcG9uZW50JyxcbiAqICAgICAgICAgIGxhYmVsOiAnTXkgdGVzdCBjb21wb25lbnQnLFxuICogICAgICAgICAgZGVzY3JpcHRpb246ICd0aGlzIGlzIHRlc3QgY29tcG9uZW50JyxcbiAqICAgICAgICAgIGNvbXBvbmVudDogVGVzdENvbXBvbmVudFxuICogICAgICB9XSxcbiAqICAuLi5cbiAqICB9XVxuICpcbiAqIGBgYFxuICogU2hvd2luZyBkeW5hbWljIGNvbXBvbmVudDpcbiAqIGBgYGh0bWxcbiAqIDxjOHktZHluYW1pYy1jb21wb25lbnQgW2NvbXBvbmVudElkXT1cIid0ZXN0LWNvbXBvbmVudCdcIiBbY29uZmlnXT1cImNvbmZpZ1wiPjwvYzh5LWR5bmFtaWMtY29tcG9uZW50PlxuICogYGBgXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1keW5hbWljLWNvbXBvbmVudCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9keW5hbWljLWNvbXBvbmVudC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRHluYW1pY0NvbXBvbmVudENvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGNvbXBvbmVudElkOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGNvbmZpZzogYW55O1xuICBASW5wdXQoKSBtb2RlOiAnY29uZmlnJyB8ICdjb21wb25lbnQnID0gJ2NvbXBvbmVudCc7XG4gIEBJbnB1dCgpIG5vdEZvdW5kRXJyb3IgPSB0cnVlO1xuICBAVmlld0NoaWxkKCdob3N0JywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSkgaG9zdDogVmlld0NvbnRhaW5lclJlZjtcbiAgZXJyb3I6IGFueTtcbiAgZXhwYW5kRXJyb3JEZXRhaWxzID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXJ2aWNlOiBEeW5hbWljQ29tcG9uZW50U2VydmljZVxuICApIHt9XG5cbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XG4gICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZVxuICAgICAgLmdldEJ5SWQkKHRoaXMuY29tcG9uZW50SWQpXG4gICAgICAuc3Vic2NyaWJlKGNtcCA9PiB0aGlzLmxvYWRDb21wb25lbnQoY21wKSk7XG4gIH1cblxuICBsb2FkQ29tcG9uZW50KGR5bmFtaWNDb21wb25lbnQpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShcbiAgICAgICAgdGhpcy5tb2RlID09PSAnY29tcG9uZW50JyA/IGR5bmFtaWNDb21wb25lbnQuY29tcG9uZW50IDogZHluYW1pY0NvbXBvbmVudC5jb25maWdDb21wb25lbnRcbiAgICAgICk7XG4gICAgICB0aGlzLmhvc3QuY2xlYXIoKTtcbiAgICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHRoaXMuaG9zdC5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgICAoY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIER5bmFtaWNDb21wb25lbnQpLmNvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB0aGlzLmVycm9yID0gZXg7XG4gICAgfVxuICB9XG59XG4iXX0=