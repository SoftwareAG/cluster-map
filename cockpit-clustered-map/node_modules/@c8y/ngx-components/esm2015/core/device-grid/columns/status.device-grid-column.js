import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { gettext } from '../../i18n/gettext';
export class StatusDeviceGridColumn extends BaseDeviceGridColumn {
    constructor() {
        super();
        const availabilityStatusPath = 'c8y_Availability.status';
        const requiredAvailabilityPath = 'c8y_RequiredAvailability';
        const connectionStatusPath = 'c8y_Connection.status';
        this.name = 'status';
        this.header = gettext('Status');
        this.dataType = "icon" /* Icon */;
        this.cellRendererComponent = StatusCellRendererComponent;
        this.filterable = true;
        this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendOnline: {
                        type: 'boolean'
                    },
                    sendOffline: {
                        type: 'boolean'
                    },
                    sendUnknown: {
                        type: 'boolean'
                    },
                    sendNotMonitored: {
                        type: 'boolean'
                    },
                    pushOnline: {
                        type: 'boolean'
                    },
                    pushOffline: {
                        type: 'boolean'
                    },
                    pushUnknown: {
                        type: 'boolean'
                    },
                    maintenance: {
                        type: 'boolean'
                    }
                }
            },
            form: [
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with send status')}</span>:</label>`
                },
                {
                    key: 'sendOnline',
                    title: gettext('Online')
                },
                {
                    key: 'sendOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'sendUnknown',
                    title: gettext('Unknown')
                },
                {
                    key: 'sendNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with push status')}</span>:</label>`
                },
                {
                    key: 'pushOnline',
                    title: gettext('Online')
                },
                {
                    key: 'pushOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'pushUnknown',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with maintenance status')}</span>:</label>`
                },
                {
                    key: 'maintenance',
                    title: gettext('Under maintenance')
                }
            ],
            getFilter(model) {
                const filter = {};
                const ors = [];
                const sendIns = [];
                const pushIns = [];
                if (model) {
                    if (model.sendOnline) {
                        sendIns.push('AVAILABLE');
                    }
                    if (model.maintenance) {
                        sendIns.push('MAINTENANCE');
                    }
                    if (model.sendOffline) {
                        sendIns.push('UNAVAILABLE');
                    }
                    if (model.sendUnknown) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __has: requiredAvailabilityPath }
                            ]
                        });
                    }
                    if (model.sendNotMonitored) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __not: { __has: requiredAvailabilityPath } }
                            ]
                        });
                    }
                    if (model.pushOnline) {
                        pushIns.push('CONNECTED');
                    }
                    if (model.pushOffline) {
                        pushIns.push('DISCONNECTED');
                    }
                    if (model.pushUnknown) {
                        ors.push({
                            __not: { __has: connectionStatusPath }
                        });
                    }
                    if (sendIns.length) {
                        ors.push({ [availabilityStatusPath]: { __in: sendIns } });
                    }
                    if (pushIns.length) {
                        ors.push({ [connectionStatusPath]: { __in: pushIns } });
                    }
                    if (ors.length) {
                        filter.__or = ors;
                    }
                }
                return filter;
            }
        };
        this.sortable = true;
        this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2RldmljZS1ncmlkL2NvbHVtbnMvc3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUUvRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFN0MsTUFBTSxPQUFPLHNCQUF1QixTQUFRLG9CQUFvQjtJQUM5RDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBRVIsTUFBTSxzQkFBc0IsR0FBRyx5QkFBeUIsQ0FBQztRQUN6RCxNQUFNLHdCQUF3QixHQUFHLDBCQUEwQixDQUFDO1FBQzVELE1BQU0sb0JBQW9CLEdBQUcsdUJBQXVCLENBQUM7UUFFckQsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLFFBQVEsb0JBQXNCLENBQUM7UUFDcEMsSUFBSSxDQUFDLHFCQUFxQixHQUFHLDJCQUEyQixDQUFDO1FBRXpELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxlQUFlLEdBQUc7WUFDckIsTUFBTSxFQUFFO2dCQUNOLElBQUksRUFBRSxRQUFRO2dCQUNkLFVBQVUsRUFBRTtvQkFDVixVQUFVLEVBQUU7d0JBQ1YsSUFBSSxFQUFFLFNBQVM7cUJBQ2hCO29CQUNELFdBQVcsRUFBRTt3QkFDWCxJQUFJLEVBQUUsU0FBUztxQkFDaEI7b0JBQ0QsV0FBVyxFQUFFO3dCQUNYLElBQUksRUFBRSxTQUFTO3FCQUNoQjtvQkFDRCxnQkFBZ0Is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RiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VEZXZpY2VHcmlkQ29sdW1uIH0gZnJvbSAnLi9iYXNlLmRldmljZS1ncmlkLWNvbHVtbic7XG5pbXBvcnQgeyBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQgfSBmcm9tICcuL3N0YXR1cy5jZWxsLXJlbmRlcmVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb2x1bW5EYXRhVHlwZSB9IGZyb20gJy4uLy4uL2RhdGEtZ3JpZC9kYXRhLWdyaWQubW9kZWwnO1xuaW1wb3J0IHsgZ2V0dGV4dCB9IGZyb20gJy4uLy4uL2kxOG4vZ2V0dGV4dCc7XG5cbmV4cG9ydCBjbGFzcyBTdGF0dXNEZXZpY2VHcmlkQ29sdW1uIGV4dGVuZHMgQmFzZURldmljZUdyaWRDb2x1bW4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCA9ICdjOHlfQXZhaWxhYmlsaXR5LnN0YXR1cyc7XG4gICAgY29uc3QgcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoID0gJ2M4eV9SZXF1aXJlZEF2YWlsYWJpbGl0eSc7XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c1BhdGggPSAnYzh5X0Nvbm5lY3Rpb24uc3RhdHVzJztcblxuICAgIHRoaXMubmFtZSA9ICdzdGF0dXMnO1xuICAgIHRoaXMuaGVhZGVyID0gZ2V0dGV4dCgnU3RhdHVzJyk7XG4gICAgdGhpcy5kYXRhVHlwZSA9IENvbHVtbkRhdGFUeXBlLkljb247XG4gICAgdGhpcy5jZWxsUmVuZGVyZXJDb21wb25lbnQgPSBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQ7XG5cbiAgICB0aGlzLmZpbHRlcmFibGUgPSB0cnVlO1xuICAgIHRoaXMuZmlsdGVyaW5nQ29uZmlnID0ge1xuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgc2VuZE9ubGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kT2ZmbGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kVW5rbm93bjoge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHB1c2hPbmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE9mZmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaFVua25vd246IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbWFpbnRlbmFuY2U6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGZvcm06IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICd0ZW1wbGF0ZScsXG4gICAgICAgICAgdGVtcGxhdGU6IGA8bGFiZWw+PHNwYW4gdHJhbnNsYXRlPiR7Z2V0dGV4dChcbiAgICAgICAgICAgICdTaG93IGRldmljZXMgd2l0aCBzZW5kIHN0YXR1cydcbiAgICAgICAgICApfTwvc3Bhbj46PC9sYWJlbD5gXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kT25saW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT25saW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRPZmZsaW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT2ZmbGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kVW5rbm93bicsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ1Vua25vd24nKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZE5vdE1vbml0b3JlZCcsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ3RlbXBsYXRlJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogYDxsYWJlbD48c3BhbiB0cmFuc2xhdGU+JHtnZXR0ZXh0KFxuICAgICAgICAgICAgJ1Nob3cgZGV2aWNlcyB3aXRoIHB1c2ggc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3B1c2hPbmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPbmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaE9mZmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPZmZsaW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3B1c2hVbmtub3duJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiBgPGxhYmVsPjxzcGFuIHRyYW5zbGF0ZT4ke2dldHRleHQoXG4gICAgICAgICAgICAnU2hvdyBkZXZpY2VzIHdpdGggbWFpbnRlbmFuY2Ugc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnVW5kZXIgbWFpbnRlbmFuY2UnKVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgZ2V0RmlsdGVyKG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IGZpbHRlcjogYW55ID0ge307XG4gICAgICAgIGNvbnN0IG9ycyA9IFtdO1xuICAgICAgICBjb25zdCBzZW5kSW5zID0gW107XG4gICAgICAgIGNvbnN0IHB1c2hJbnMgPSBbXTtcbiAgICAgICAgaWYgKG1vZGVsKSB7XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRPbmxpbmUpIHtcbiAgICAgICAgICAgIHNlbmRJbnMucHVzaCgnQVZBSUxBQkxFJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5tYWludGVuYW5jZSkge1xuICAgICAgICAgICAgc2VuZElucy5wdXNoKCdNQUlOVEVOQU5DRScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE9mZmxpbmUpIHtcbiAgICAgICAgICAgIHNlbmRJbnMucHVzaCgnVU5BVkFJTEFCTEUnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRVbmtub3duKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9IH0sXG4gICAgICAgICAgICAgICAgeyBfX2hhczogcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5zZW5kTm90TW9uaXRvcmVkKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9IH0sXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoIH0gfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAobW9kZWwucHVzaE9ubGluZSkge1xuICAgICAgICAgICAgcHVzaElucy5wdXNoKCdDT05ORUNURUQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnB1c2hPZmZsaW5lKSB7XG4gICAgICAgICAgICBwdXNoSW5zLnB1c2goJ0RJU0NPTk5FQ1RFRCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwucHVzaFVua25vd24pIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19ub3Q6IHsgX19oYXM6IGNvbm5lY3Rpb25TdGF0dXNQYXRoIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2VuZElucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiB7IF9faW46IHNlbmRJbnMgfSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHB1c2hJbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IHsgX19pbjogcHVzaElucyB9IH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgZmlsdGVyLl9fb3IgPSBvcnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWx0ZXI7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc29ydGFibGUgPSB0cnVlO1xuICAgIHRoaXMuc29ydGluZ0NvbmZpZyA9IHtcbiAgICAgIHBhdGhTb3J0aW5nQ29uZmlnczogW3sgcGF0aDogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9XVxuICAgIH07XG4gIH1cbn1cbiJdfQ==