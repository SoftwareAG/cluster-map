import * as tslib_1 from "tslib";
import { Host, Component, Input, Output, EventEmitter } from '@angular/core';
import { C8yStepper } from './stepper.component';
import { CdkStep } from '@angular/cdk/stepper';
/**
 * C8yStepperButtons provides a convinient way to have, according to
 * the C8yStepper and each cdk-step, buttons to navigate between steps or to cancel the whole
 * step-process. Buttons rendered with the help of this component will use the branding css.
 *
 * By default all steps with this component in use will render a next button, expect the last step.
 * The other way around, every step using this component will render a back button, expect the first step.
 * To get a cancel button rendered you need to handle the onCancel event.
 * For next and back button you don't need to handle the available events onNext and onBack because default behavior
 * is implemented. The default will just call, according to the button, the stepper.next() or stepper.previous()
 * methods and moves the stepper forth or back. Using the EventEmitter onNext and onBack will emit for you the following
 * object: {stepper: C8yStepper, step: CdkStep}. This is useful if you need to implement custom logic before moving
 * to the next step or sending data to a backend. In this case you need to tell the stepper to move forward or back
 * on your own.
 *
 * With the component input [labels] you can change the label of each button in each step. It takes an object like this:
 * {next?: string, back?: string, cancel?: string}
 *
 * The [pending] input is of type boolean and will enable css animation for the next button when true.
 *
 * If the cdk-step provides a stepControl the component will set the next button disabled when the formGroup
 * behind it is invalid. As long as the [pending] input is true the back and next button is also disabled.
 * This will prevent multiple clicks while running a request or stepping back while a request is ongoing.
 *
 * @example
 * ```
 * <c8y-stepper>
 *  <cdk-step>
 *    <!--
 *      your html code
 *          ...
 *          ...    -->
 *    <c8y-stepper-buttons
 *     (onNext)="save()"
 *     [labels]="{ next: 'Save' }"
 *     [pending]="pendingStatus"
 *     ></c8y-stepper-buttons>
 *  </cdk-step>
 * </c8y-stepper>
 *
 * // in your component:
 * async save() {
 *   this.pendingStatus = true;
 *   // your async request goes here ...
 *   // await something();
 *   this.pendingStatus = false;
 *   this.stepper.next();
 * }
 * ```
 */
let C8yStepperButtons = class C8yStepperButtons {
    constructor(stepper, step) {
        this.stepper = stepper;
        this.step = step;
        /**
         * Optional
         * Indicates if a request is pending and sets the next button
         * to disabled when true
         */
        this.pending = false;
        /**
         * EventEmitter which emits when cancel button is clicked
         */
        this.onCancel = new EventEmitter();
        /**
         * EventEmitter which emits {stepper: C8yStepper; step: CdkStep} when next button is clicked.
         */
        this.onNext = new EventEmitter();
        /**
         * EventEmitter which emits {stepper: C8yStepper; step: CdkStep} when back button is clicked.
         */
        this.onBack = new EventEmitter();
        /**
         * Indicator which button should be shown.
         * Based on the cdk-steps within the c8y-stepper
         * next and back buttons are rendered.
         */
        this.showBtns = {
            cancel: false,
            back: false,
            next: false
        };
        /**
         * Disabled state of a button
         */
        this.disabled = false;
    }
    ngAfterContentInit() {
        this.showBtns.cancel = this.onCancel.observers.length > 0;
        if (this.stepper && this.stepper.steps && this.step) {
            this.showBtns.back = this.stepper.steps.first !== this.step;
            this.showBtns.next = this.stepper.steps.last !== this.step;
        }
        if (this.step && this.step.stepControl) {
            this.disabled = this.step.stepControl.invalid;
            this.statusChangeSubscription = this.step.stepControl.statusChanges.subscribe(status => {
                this.disabled = this.step.stepControl.invalid;
            });
        }
    }
    ngOnChanges(changes) {
        /**
         * Disable save/next button while the status is pending
         * This will prevent multiple clicks and therefore multiple requests
         */
        if (changes && changes.pending) {
            this.disabled = changes.pending.currentValue;
        }
    }
    ngOnDestroy() {
        if (this.statusChangeSubscription && !this.statusChangeSubscription.closed) {
            this.statusChangeSubscription.unsubscribe();
        }
    }
    /**
     * Gets called when cancel button is clicked.
     * It will emit immediate.
     */
    cancel() {
        this.onCancel.emit();
    }
    /**
     * Gets called when next button is clicked. When onNext EventEmitter has an observer registered
     * it will emit the following object {stepper: C8yStepper; step: CdkStep}.
     * Otherwise it will call stepper.next() as default.
     */
    next() {
        if (this.onNext.observers.length > 0) {
            this.onNext.emit({ stepper: this.stepper, step: this.step });
        }
        else {
            this.stepper.next();
        }
    }
    /**
     * Gets called when back button is clicked. When onBack EventEmitter has an observer registered
     * it will emit the following object {stepper: C8yStepper; step: CdkStep}.
     * Otherwise it will call stepper.previous() as default.
     */
    back() {
        if (this.onBack.observers.length > 0) {
            this.onBack.emit({ stepper: this.stepper, step: this.step });
        }
        else {
            this.stepper.previous();
        }
    }
};
C8yStepperButtons.ctorParameters = () => [
    { type: C8yStepper, decorators: [{ type: Host }] },
    { type: CdkStep, decorators: [{ type: Host }] }
];
tslib_1.__decorate([
    Input()
], C8yStepperButtons.prototype, "labels", void 0);
tslib_1.__decorate([
    Input()
], C8yStepperButtons.prototype, "pending", void 0);
tslib_1.__decorate([
    Output()
], C8yStepperButtons.prototype, "onCancel", void 0);
tslib_1.__decorate([
    Output()
], C8yStepperButtons.prototype, "onNext", void 0);
tslib_1.__decorate([
    Output()
], C8yStepperButtons.prototype, "onBack", void 0);
C8yStepperButtons = tslib_1.__decorate([
    Component({
        selector: 'c8y-stepper-buttons',
        template: "<div class=\"text-center\">\n  <button *ngIf=\"showBtns.cancel\" (click)=\"cancel()\" type=\"button\" class=\"btn btn-default\">\n    <span>{{labels?.cancel || 'Cancel' | translate}}</span>\n  </button>\n  <button\n    *ngIf=\"showBtns.back\"\n    type=\"button\"\n    (click)=\"back()\"\n    class=\"btn btn-default\"\n    [disabled]=\"pending\"\n  >\n    <span>{{ labels?.back || 'Back' | translate }}</span>\n  </button>\n  <button\n    (click)=\"next()\"\n    *ngIf=\"showBtns.next\"\n    type=\"button\"\n    class=\"btn btn-primary\"\n    [ngClass]=\"{ 'btn-pending': pending }\"\n    [disabled]=\"disabled\"\n  >\n    <span>{{labels?.next || 'Next' | translate }}</span>\n  </button>\n</div>\n"
    }),
    tslib_1.__param(0, Host()), tslib_1.__param(1, Host())
], C8yStepperButtons);
export { C8yStepperButtons };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlcHBlci1idXR0b25zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL3N0ZXBwZXIvc3RlcHBlci1idXR0b25zLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLElBQUksRUFDSixTQUFTLEVBR1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBR2IsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUcvQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWlERztBQUtILElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBNkM1QixZQUE0QixPQUFtQixFQUFrQixJQUFhO1FBQWxELFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBa0IsU0FBSSxHQUFKLElBQUksQ0FBUztRQXZDOUU7Ozs7V0FJRztRQUNNLFlBQU8sR0FBYSxLQUFLLENBQUM7UUFFbkM7O1dBRUc7UUFDTyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN4Qzs7V0FFRztRQUNPLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBMEMsQ0FBQztRQUU5RTs7V0FFRztRQUNPLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBMEMsQ0FBQztRQUU5RTs7OztXQUlHO1FBQ0gsYUFBUSxHQUFHO1lBQ1QsTUFBTSxFQUFFLEtBQUs7WUFDYixJQUFJLEVBQUUsS0FBSztZQUNYLElBQUksRUFBRSxLQUFLO1NBQ1osQ0FBQztRQUVGOztXQUVHO1FBQ0gsYUFBUSxHQUFZLEtBQUssQ0FBQztJQUl1RCxDQUFDO0lBRWxGLGtCQUFrQjtRQUNoQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENB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SUE4Q2EsbUJBQUEsSUFBSSxFQUFFLENBQUEsRUFBK0IsbUJBQUEsSUFBSSxFQUFFLENBQUE7R0E3QzdDLGlCQUFpQixDQWlIN0I7U0FqSFksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSG9zdCxcbiAgQ29tcG9uZW50LFxuICBPbkRlc3Ryb3ksXG4gIE9uQ2hhbmdlcyxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQzh5U3RlcHBlciB9IGZyb20gJy4vc3RlcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ2RrU3RlcCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zdGVwcGVyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG4vKipcbiAqIEM4eVN0ZXBwZXJCdXR0b25zIHByb3ZpZGVzIGEgY29udmluaWVudCB3YXkgdG8gaGF2ZSwgYWNjb3JkaW5nIHRvXG4gKiB0aGUgQzh5U3RlcHBlciBhbmQgZWFjaCBjZGstc3RlcCwgYnV0dG9ucyB0byBuYXZpZ2F0ZSBiZXR3ZWVuIHN0ZXBzIG9yIHRvIGNhbmNlbCB0aGUgd2hvbGVcbiAqIHN0ZXAtcHJvY2Vzcy4gQnV0dG9ucyByZW5kZXJlZCB3aXRoIHRoZSBoZWxwIG9mIHRoaXMgY29tcG9uZW50IHdpbGwgdXNlIHRoZSBicmFuZGluZyBjc3MuXG4gKlxuICogQnkgZGVmYXVsdCBhbGwgc3RlcHMgd2l0aCB0aGlzIGNvbXBvbmVudCBpbiB1c2Ugd2lsbCByZW5kZXIgYSBuZXh0IGJ1dHRvbiwgZXhwZWN0IHRoZSBsYXN0IHN0ZXAuXG4gKiBUaGUgb3RoZXIgd2F5IGFyb3VuZCwgZXZlcnkgc3RlcCB1c2luZyB0aGlzIGNvbXBvbmVudCB3aWxsIHJlbmRlciBhIGJhY2sgYnV0dG9uLCBleHBlY3QgdGhlIGZpcnN0IHN0ZXAuXG4gKiBUbyBnZXQgYSBjYW5jZWwgYnV0dG9uIHJlbmRlcmVkIHlvdSBuZWVkIHRvIGhhbmRsZSB0aGUgb25DYW5jZWwgZXZlbnQuXG4gKiBGb3IgbmV4dCBhbmQgYmFjayBidXR0b24geW91IGRvbid0IG5lZWQgdG8gaGFuZGxlIHRoZSBhdmFpbGFibGUgZXZlbnRzIG9uTmV4dCBhbmQgb25CYWNrIGJlY2F1c2UgZGVmYXVsdCBiZWhhdmlvclxuICogaXMgaW1wbGVtZW50ZWQuIFRoZSBkZWZhdWx0IHdpbGwganVzdCBjYWxsLCBhY2NvcmRpbmcgdG8gdGhlIGJ1dHRvbiwgdGhlIHN0ZXBwZXIubmV4dCgpIG9yIHN0ZXBwZXIucHJldmlvdXMoKVxuICogbWV0aG9kcyBhbmQgbW92ZXMgdGhlIHN0ZXBwZXIgZm9ydGggb3IgYmFjay4gVXNpbmcgdGhlIEV2ZW50RW1pdHRlciBvbk5leHQgYW5kIG9uQmFjayB3aWxsIGVtaXQgZm9yIHlvdSB0aGUgZm9sbG93aW5nXG4gKiBvYmplY3Q6IHtzdGVwcGVyOiBDOHlTdGVwcGVyLCBzdGVwOiBDZGtTdGVwfS4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IG5lZWQgdG8gaW1wbGVtZW50IGN1c3RvbSBsb2dpYyBiZWZvcmUgbW92aW5nXG4gKiB0byB0aGUgbmV4dCBzdGVwIG9yIHNlbmRpbmcgZGF0YSB0byBhIGJhY2tlbmQuIEluIHRoaXMgY2FzZSB5b3UgbmVlZCB0byB0ZWxsIHRoZSBzdGVwcGVyIHRvIG1vdmUgZm9yd2FyZCBvciBiYWNrXG4gKiBvbiB5b3VyIG93bi5cbiAqXG4gKiBXaXRoIHRoZSBjb21wb25lbnQgaW5wdXQgW2xhYmVsc10geW91IGNhbiBjaGFuZ2UgdGhlIGxhYmVsIG9mIGVhY2ggYnV0dG9uIGluIGVhY2ggc3RlcC4gSXQgdGFrZXMgYW4gb2JqZWN0IGxpa2UgdGhpczpcbiAqIHtuZXh0Pzogc3RyaW5nLCBiYWNrPzogc3RyaW5nLCBjYW5jZWw/OiBzdHJpbmd9XG4gKlxuICogVGhlIFtwZW5kaW5nXSBpbnB1dCBpcyBvZiB0eXBlIGJvb2xlYW4gYW5kIHdpbGwgZW5hYmxlIGNzcyBhbmltYXRpb24gZm9yIHRoZSBuZXh0IGJ1dHRvbiB3aGVuIHRydWUuXG4gKlxuICogSWYgdGhlIGNkay1zdGVwIHByb3ZpZGVzIGEgc3RlcENvbnRyb2wgdGhlIGNvbXBvbmVudCB3aWxsIHNldCB0aGUgbmV4dCBidXR0b24gZGlzYWJsZWQgd2hlbiB0aGUgZm9ybUdyb3VwXG4gKiBiZWhpbmQgaXQgaXMgaW52YWxpZC4gQXMgbG9uZyBhcyB0aGUgW3BlbmRpbmddIGlucHV0IGlzIHRydWUgdGhlIGJhY2sgYW5kIG5leHQgYnV0dG9uIGlzIGFsc28gZGlzYWJsZWQuXG4gKiBUaGlzIHdpbGwgcHJldmVudCBtdWx0aXBsZSBjbGlja3Mgd2hpbGUgcnVubmluZyBhIHJlcXVlc3Qgb3Igc3RlcHBpbmcgYmFjayB3aGlsZSBhIHJlcXVlc3QgaXMgb25nb2luZy5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiA8Yzh5LXN0ZXBwZXI+XG4gKiAgPGNkay1zdGVwPlxuICogICAgPCEtLVxuICogICAgICB5b3VyIGh0bWwgY29kZVxuICogICAgICAgICAgLi4uXG4gKiAgICAgICAgICAuLi4gICAgLS0+XG4gKiAgICA8Yzh5LXN0ZXBwZXItYnV0dG9uc1xuICogICAgIChvbk5leHQpPVwic2F2ZSgpXCJcbiAqICAgICBbbGFiZWxzXT1cInsgbmV4dDogJ1NhdmUnIH1cIlxuICogICAgIFtwZW5kaW5nXT1cInBlbmRpbmdTdGF0dXNcIlxuICogICAgID48L2M4eS1zdGVwcGVyLWJ1dHRvbnM+XG4gKiAgPC9jZGstc3RlcD5cbiAqIDwvYzh5LXN0ZXBwZXI+XG4gKlxuICogLy8gaW4geW91ciBjb21wb25lbnQ6XG4gKiBhc3luYyBzYXZlKCkge1xuICogICB0aGlzLnBlbmRpbmdTdGF0dXMgPSB0cnVlO1xuICogICAvLyB5b3VyIGFzeW5jIHJlcXVlc3QgZ29lcyBoZXJlIC4uLlxuICogICAvLyBhd2FpdCBzb21ldGhpbmcoKTtcbiAqICAgdGhpcy5wZW5kaW5nU3RhdHVzID0gZmFsc2U7XG4gKiAgIHRoaXMuc3RlcHBlci5uZXh0KCk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXN0ZXBwZXItYnV0dG9ucycsXG4gIHRlbXBsYXRlVXJsOiAnLi9zdGVwcGVyLWJ1dHRvbnMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEM4eVN0ZXBwZXJCdXR0b25zIGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuICAvKipcbiAgICogT3B0aW9uYWxcbiAgICogU3BlY2lmeSBjdXN0b20gbGFiZWxzIGZvciBlYWNoIGJ1dHRvbiAoY2FuY2VsLCBiYWNrIG9yIG5leHQpXG4gICAqL1xuICBASW5wdXQoKSBsYWJlbHM/OiB7IGNhbmNlbD86IHN0cmluZzsgYmFjaz86IHN0cmluZzsgbmV4dD86IHN0cmluZyB9O1xuICAvKipcbiAgICogT3B0aW9uYWxcbiAgICogSW5kaWNhdGVzIGlmIGEgcmVxdWVzdCBpcyBwZW5kaW5nIGFuZCBzZXRzIHRoZSBuZXh0IGJ1dHRvblxuICAgKiB0byBkaXNhYmxlZCB3aGVuIHRydWVcbiAgICovXG4gIEBJbnB1dCgpIHBlbmRpbmc/OiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEV2ZW50RW1pdHRlciB3aGljaCBlbWl0cyB3aGVuIGNhbmNlbCBidXR0b24gaXMgY2xpY2tlZFxuICAgKi9cbiAgQE91dHB1dCgpIG9uQ2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogRXZlbnRFbWl0dGVyIHdoaWNoIGVtaXRzIHtzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwfSB3aGVuIG5leHQgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25OZXh0ID0gbmV3IEV2ZW50RW1pdHRlcjx7IHN0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXAgfT4oKTtcblxuICAvKipcbiAgICogRXZlbnRFbWl0dGVyIHdoaWNoIGVtaXRzIHtzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwfSB3aGVuIGJhY2sgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25CYWNrID0gbmV3IEV2ZW50RW1pdHRlcjx7IHN0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXAgfT4oKTtcblxuICAvKipcbiAgICogSW5kaWNhdG9yIHdoaWNoIGJ1dHRvbiBzaG91bGQgYmUgc2hvd24uXG4gICAqIEJhc2VkIG9uIHRoZSBjZGstc3RlcHMgd2l0aGluIHRoZSBjOHktc3RlcHBlclxuICAgKiBuZXh0IGFuZCBiYWNrIGJ1dHRvbnMgYXJlIHJlbmRlcmVkLlxuICAgKi9cbiAgc2hvd0J0bnMgPSB7XG4gICAgY2FuY2VsOiBmYWxzZSxcbiAgICBiYWNrOiBmYWxzZSxcbiAgICBuZXh0OiBmYWxzZVxuICB9O1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlZCBzdGF0ZSBvZiBhIGJ1dHRvblxuICAgKi9cbiAgZGlzYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIHN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKEBIb3N0KCkgcHJpdmF0ZSBzdGVwcGVyOiBDOHlTdGVwcGVyLCBASG9zdCgpIHByaXZhdGUgc3RlcDogQ2RrU3RlcCkge31cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5zaG93QnRucy5jYW5jZWwgPSB0aGlzLm9uQ2FuY2VsLm9ic2VydmVycy5sZW5ndGggPiAwO1xuXG4gICAgaWYgKHRoaXMuc3RlcHBlciAmJiB0aGlzLnN0ZXBwZXIuc3RlcHMgJiYgdGhpcy5zdGVwKSB7XG4gICAgICB0aGlzLnNob3dCdG5zLmJhY2sgPSB0aGlzLnN0ZXBwZXIuc3RlcHMuZmlyc3QgIT09IHRoaXMuc3RlcDtcbiAgICAgIHRoaXMuc2hvd0J0bnMubmV4dCA9IHRoaXMuc3RlcHBlci5zdGVwcy5sYXN0ICE9PSB0aGlzLnN0ZXA7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc3RlcCAmJiB0aGlzLnN0ZXAuc3RlcENvbnRyb2wpIHtcbiAgICAgIHRoaXMuZGlzYWJsZWQgPSB0aGlzLnN0ZXAuc3RlcENvbnRyb2wuaW52YWxpZDtcblxuICAgICAgdGhpcy5zdGF0dXNDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLnN0ZXAuc3RlcENvbnRyb2wuc3RhdHVzQ2hhbmdlcy5zdWJzY3JpYmUoc3RhdHVzID0+IHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRoaXMuc3RlcC5zdGVwQ29udHJvbC5pbnZhbGlkO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIC8qKlxuICAgICAqIERpc2FibGUgc2F2ZS9uZXh0IGJ1dHRvbiB3aGlsZSB0aGUgc3RhdHVzIGlzIHBlbmRpbmdcbiAgICAgKiBUaGlzIHdpbGwgcHJldmVudCBtdWx0aXBsZSBjbGlja3MgYW5kIHRoZXJlZm9yZSBtdWx0aXBsZSByZXF1ZXN0c1xuICAgICAqL1xuICAgIGlmIChjaGFuZ2VzICYmIGNoYW5nZXMucGVuZGluZykge1xuICAgICAgdGhpcy5kaXNhYmxlZCA9IGNoYW5nZXMucGVuZGluZy5jdXJyZW50VmFsdWU7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuc3RhdHVzQ2hhbmdlU3Vic2NyaXB0aW9uICYmICF0aGlzLnN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbi5jbG9zZWQpIHtcbiAgICAgIHRoaXMuc3RhdHVzQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY2FsbGVkIHdoZW4gY2FuY2VsIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgKiBJdCB3aWxsIGVtaXQgaW1tZWRpYXRlLlxuICAgKi9cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMub25DYW5jZWwuZW1pdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY2FsbGVkIHdoZW4gbmV4dCBidXR0b24gaXMgY2xpY2tlZC4gV2hlbiBvbk5leHQgRXZlbnRFbWl0dGVyIGhhcyBhbiBvYnNlcnZlciByZWdpc3RlcmVkXG4gICAqIGl0IHdpbGwgZW1pdCB0aGUgZm9sbG93aW5nIG9iamVjdCB7c3RlcHBlcjogQzh5U3RlcHBlcjsgc3RlcDogQ2RrU3RlcH0uXG4gICAqIE90aGVyd2lzZSBpdCB3aWxsIGNhbGwgc3RlcHBlci5uZXh0KCkgYXMgZGVmYXVsdC5cbiAgICovXG4gIG5leHQoKSB7XG4gICAgaWYgKHRoaXMub25OZXh0Lm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLm9uTmV4dC5lbWl0KHsgc3RlcHBlcjogdGhpcy5zdGVwcGVyLCBzdGVwOiB0aGlzLnN0ZXAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RlcHBlci5uZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY2FsbGVkIHdoZW4gYmFjayBidXR0b24gaXMgY2xpY2tlZC4gV2hlbiBvbkJhY2sgRXZlbnRFbWl0dGVyIGhhcyBhbiBvYnNlcnZlciByZWdpc3RlcmVkXG4gICAqIGl0IHdpbGwgZW1pdCB0aGUgZm9sbG93aW5nIG9iamVjdCB7c3RlcHBlcjogQzh5U3RlcHBlcjsgc3RlcDogQ2RrU3RlcH0uXG4gICAqIE90aGVyd2lzZSBpdCB3aWxsIGNhbGwgc3RlcHBlci5wcmV2aW91cygpIGFzIGRlZmF1bHQuXG4gICAqL1xuICBiYWNrKCkge1xuICAgIGlmICh0aGlzLm9uQmFjay5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5vbkJhY2suZW1pdCh7IHN0ZXBwZXI6IHRoaXMuc3RlcHBlciwgc3RlcDogdGhpcy5zdGVwIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0ZXBwZXIucHJldmlvdXMoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==