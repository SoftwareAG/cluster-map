var CommonModule_1;
import * as tslib_1 from "tslib";
import { NgModule, APP_INITIALIZER, InjectionToken } from '@angular/core';
import { CommonModule as NgCommonModule } from '@angular/common';
import { DataModule } from '@c8y/ngx-components/api';
import { I18nModule } from '../i18n/i18n.module';
import { IconDirective, ICONS } from './icon.directive';
import { OutletDirective } from './outlet.directive';
import { HOOK_OPTIONS, OptionsService } from './options.service';
import { UserPreferencesService } from './user-preferences/user-preferences.service';
import { HumanizeAppNamePipe } from './humanize-app-name.pipe';
import { HumanizePipe } from './humanize.pipe';
import { AppStateService } from './ui-state.service';
import { TranslateService } from '../i18n/public-api';
import { filter, switchMap, startWith, map, distinctUntilChanged } from 'rxjs/operators';
import { ShortenUserNamePipe } from './shorten-user-name.pipe';
import { ForOfDirective } from './forOf.directive';
import { LoadMoreComponent } from './load-more.component';
import { MapFunctionPipe } from './map-function.pipe';
import { ProgressBarComponent } from './progress-bar.component';
export function initializeServices(translateService, state, userPreferences) {
    const initialize = () => {
        const queryStringLanguage = translateService.queryStringLang();
        const firstLanguage = translateService.firstSupportedLanguage();
        /*
          The ?lang parameter will prevent the user preference language from being activated
        */
        if (queryStringLanguage && translateService.isSupported(queryStringLanguage)) {
            translateService.switchToLanguage(queryStringLanguage);
        }
        else {
            state.currentUser
                .pipe(map(user => user && user.userName), filter(u => !!u), distinctUntilChanged(), switchMap(() => userPreferences.get('language')), startWith(firstLanguage), filter(lang => !!lang), distinctUntilChanged())
                .subscribe(lang => {
                translateService.switchToLanguage(lang);
            });
        }
    };
    return initialize;
}
export const ICON_LIST = new InjectionToken('iconList');
/**
 * Commonly used directives, data access and translation. This module is the shared
 * module across all core components. It should be imported by default.
 *
 * @exports IconDirective A directive to set a c8y icon with [c8yIcon]="'rocket'".
 * @exports OutletDirective A directive which allows to set DOM or Angular templates (used for upgrade).
 * @exports I18nModule Translation module.
 * @exports NgCommonModule Angular common module.
 * @exports DataModule The data layer to allow DI with @c8y/client
 * @exports HumanizeAppNamePipe Humanize an application name (e.g. in the app switcher)
 * @exports HumanizePipe Humanize a word. E.g. `device management` gets `Device management`
 * @exports ShortenUserNamePipe Allows a short name. E.g. `Foo Bar` gets `F. Bar`
 * @exports ForOfDirective A forOf directive like ngFor but with load-more function
 * @exports LoadMoreComponent A component to load more data from a certain data-source
 * @exports ProgressBarComponent Displays either defined or undefined progress.
 */
let CommonModule = CommonModule_1 = class CommonModule {
    static providers() {
        return [
            ...DataModule.providers(),
            // TODO: maybe we can think of a way to remove this C8Y_APP global
            { provide: HOOK_OPTIONS, useValue: window.C8Y_APP || {}, multi: true },
            {
                provide: APP_INITIALIZER,
                useFactory: initializeServices,
                deps: [TranslateService, AppStateService, UserPreferencesService],
                multi: true
            },
            { provide: ICON_LIST, useValue: ICONS, multi: false },
            ...I18nModule.providers(),
            UserPreferencesService,
            OptionsService,
            AppStateService
        ];
    }
    static forRoot() {
        return {
            ngModule: CommonModule_1,
            providers: CommonModule_1.providers()
        };
    }
};
CommonModule = CommonModule_1 = tslib_1.__decorate([
    NgModule({
        imports: [NgCommonModule, I18nModule],
        exports: [
            IconDirective,
            OutletDirective,
            I18nModule,
            NgCommonModule,
            HumanizeAppNamePipe,
            HumanizePipe,
            ShortenUserNamePipe,
            ForOfDirective,
            LoadMoreComponent,
            MapFunctionPipe,
            ProgressBarComponent
        ],
        declarations: [
            IconDirective,
            OutletDirective,
            HumanizePipe,
            HumanizeAppNamePipe,
            ShortenUserNamePipe,
            ForOfDirective,
            LoadMoreComponent,
            MapFunctionPipe,
            ProgressBarComponent
        ],
        entryComponents: [LoadMoreComponent]
    })
], CommonModule);
export { CommonModule };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLm1vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2NvbW1vbi9jb21tb24ubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFFLE9BQU8sRUFBRSxZQUFZLElBQUksY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZDQUE2QyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFP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LGlCQUFpQjtZQUNqQixlQUFlO1lBQ2Ysb0JBQW9CO1NBQ3JCO1FBQ0QsWUFBWSxFQUFFO1lBQ1osYUFBYTtZQUNiLGVBQWU7WUFDZixZQUFZO1lBQ1osbUJBQW1CO1lBQ25CLG1CQUFtQjtZQUNuQixjQUFjO1lBQ2QsaUJBQWlCO1lBQ2pCLGVBQWU7WUFDZixvQkFBb0I7U0FDckI7UUFDRCxlQUFlLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztLQUNyQyxDQUFDO0dBQ1csWUFBWSxDQTBCeEI7U0ExQlksWUFBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nTW9kdWxlLCBBUFBfSU5JVElBTElaRVIsIEluamVjdGlvblRva2VuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgYXMgTmdDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgRGF0YU1vZHVsZSB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvYXBpJztcbmltcG9ydCB7IEkxOG5Nb2R1bGUgfSBmcm9tICcuLi9pMThuL2kxOG4ubW9kdWxlJztcbmltcG9ydCB7IEljb25EaXJlY3RpdmUsIElDT05TIH0gZnJvbSAnLi9pY29uLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBPdXRsZXREaXJlY3RpdmUgfSBmcm9tICcuL291dGxldC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgSE9PS19PUFRJT05TLCBPcHRpb25zU2VydmljZSB9IGZyb20gJy4vb3B0aW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UgfSBmcm9tICcuL3VzZXItcHJlZmVyZW5jZXMvdXNlci1wcmVmZXJlbmNlcy5zZXJ2aWNlJztcbmltcG9ydCB7IEh1bWFuaXplQXBwTmFtZVBpcGUgfSBmcm9tICcuL2h1bWFuaXplLWFwcC1uYW1lLnBpcGUnO1xuaW1wb3J0IHsgSHVtYW5pemVQaXBlIH0gZnJvbSAnLi9odW1hbml6ZS5waXBlJztcbmltcG9ydCB7IEFwcFN0YXRlU2VydmljZSB9IGZyb20gJy4vdWktc3RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4bi9wdWJsaWMtYXBpJztcbmltcG9ydCB7IGZpbHRlciwgc3dpdGNoTWFwLCBzdGFydFdpdGgsIG1hcCwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTaG9ydGVuVXNlck5hbWVQaXBlIH0gZnJvbSAnLi9zaG9ydGVuLXVzZXItbmFtZS5waXBlJztcbmltcG9ydCB7IEZvck9mRGlyZWN0aXZlIH0gZnJvbSAnLi9mb3JPZi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTG9hZE1vcmVDb21wb25lbnQgfSBmcm9tICcuL2xvYWQtbW9yZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTWFwRnVuY3Rpb25QaXBlIH0gZnJvbSAnLi9tYXAtZnVuY3Rpb24ucGlwZSc7XG5pbXBvcnQgeyBQcm9ncmVzc0JhckNvbXBvbmVudCB9IGZyb20gJy4vcHJvZ3Jlc3MtYmFyLmNvbXBvbmVudCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplU2VydmljZXMoXG4gIHRyYW5zbGF0ZVNlcnZpY2U6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gIHN0YXRlOiBBcHBTdGF0ZVNlcnZpY2UsXG4gIHVzZXJQcmVmZXJlbmNlczogVXNlclByZWZlcmVuY2VzU2VydmljZVxuKSB7XG4gIGNvbnN0IGluaXRpYWxpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgcXVlcnlTdHJpbmdMYW5ndWFnZSA9IHRyYW5zbGF0ZVNlcnZpY2UucXVlcnlTdHJpbmdMYW5nKCk7XG4gICAgY29uc3QgZmlyc3RMYW5ndWFnZSA9IHRyYW5zbGF0ZVNlcnZpY2UuZmlyc3RTdXBwb3J0ZWRMYW5ndWFnZSgpO1xuXG4gICAgLypcbiAgICAgIFRoZSA/bGFuZyBwYXJhbWV0ZXIgd2lsbCBwcmV2ZW50IHRoZSB1c2VyIHByZWZlcmVuY2UgbGFuZ3VhZ2UgZnJvbSBiZWluZyBhY3RpdmF0ZWRcbiAgICAqL1xuICAgIGlmIChxdWVyeVN0cmluZ0xhbmd1YWdlICYmIHRyYW5zbGF0ZVNlcnZpY2UuaXNTdXBwb3J0ZWQocXVlcnlTdHJpbmdMYW5ndWFnZSkpIHtcbiAgICAgIHRyYW5zbGF0ZVNlcnZpY2Uuc3dpdGNoVG9MYW5ndWFnZShxdWVyeVN0cmluZ0xhbmd1YWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdGUuY3VycmVudFVzZXJcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgbWFwKHVzZXIgPT4gdXNlciAmJiB1c2VyLnVzZXJOYW1lKSxcbiAgICAgICAgICBmaWx0ZXIodSA9PiAhIXUpLFxuICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHVzZXJQcmVmZXJlbmNlcy5nZXQoJ2xhbmd1YWdlJykpLFxuICAgICAgICAgIHN0YXJ0V2l0aChmaXJzdExhbmd1YWdlKSxcbiAgICAgICAgICBmaWx0ZXIobGFuZyA9PiAhIWxhbmcpLFxuICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKGxhbmcgPT4ge1xuICAgICAgICAgIHRyYW5zbGF0ZVNlcnZpY2Uuc3dpdGNoVG9MYW5ndWFnZShsYW5nKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5pdGlhbGl6ZTtcbn1cblxuZXhwb3J0IGNvbnN0IElDT05fTElTVCA9IG5ldyBJbmplY3Rpb25Ub2tlbignaWNvbkxpc3QnKTtcblxuLyoqXG4gKiBDb21tb25seSB1c2VkIGRpcmVjdGl2ZXMsIGRhdGEgYWNjZXNzIGFuZCB0cmFuc2xhdGlvbi4gVGhpcyBtb2R1bGUgaXMgdGhlIHNoYXJlZFxuICogbW9kdWxlIGFjcm9zcyBhbGwgY29yZSBjb21wb25lbnRzLiBJdCBzaG91bGQgYmUgaW1wb3J0ZWQgYnkgZGVmYXVsdC5cbiAqXG4gKiBAZXhwb3J0cyBJY29uRGlyZWN0aXZlIEEgZGlyZWN0aXZlIHRvIHNldCBhIGM4eSBpY29uIHdpdGggW2M4eUljb25dPVwiJ3JvY2tldCdcIi5cbiAqIEBleHBvcnRzIE91dGxldERpcmVjdGl2ZSBBIGRpcmVjdGl2ZSB3aGljaCBhbGxvd3MgdG8gc2V0IERPTSBvciBBbmd1bGFyIHRlbXBsYXRlcyAodXNlZCBmb3IgdXBncmFkZSkuXG4gKiBAZXhwb3J0cyBJMThuTW9kdWxlIFRyYW5zbGF0aW9uIG1vZHVsZS5cbiAqIEBleHBvcnRzIE5nQ29tbW9uTW9kdWxlIEFuZ3VsYXIgY29tbW9uIG1vZHVsZS5cbiAqIEBleHBvcnRzIERhdGFNb2R1bGUgVGhlIGRhdGEgbGF5ZXIgdG8gYWxsb3cgREkgd2l0aCBAYzh5L2NsaWVudFxuICogQGV4cG9ydHMgSHVtYW5pemVBcHBOYW1lUGlwZSBIdW1hbml6ZSBhbiBhcHBsaWNhdGlvbiBuYW1lIChlLmcuIGluIHRoZSBhcHAgc3dpdGNoZXIpXG4gKiBAZXhwb3J0cyBIdW1hbml6ZVBpcGUgSHVtYW5pemUgYSB3b3JkLiBFLmcuIGBkZXZpY2UgbWFuYWdlbWVudGAgZ2V0cyBgRGV2aWNlIG1hbmFnZW1lbnRgXG4gKiBAZXhwb3J0cyBTaG9ydGVuVXNlck5hbWVQaXBlIEFsbG93cyBhIHNob3J0IG5hbWUuIEUuZy4gYEZvbyBCYXJgIGdldHMgYEYuIEJhcmBcbiAqIEBleHBvcnRzIEZvck9mRGlyZWN0aXZlIEEgZm9yT2YgZGlyZWN0aXZlIGxpa2UgbmdGb3IgYnV0IHdpdGggbG9hZC1tb3JlIGZ1bmN0aW9uXG4gKiBAZXhwb3J0cyBMb2FkTW9yZUNvbXBvbmVudCBBIGNvbXBvbmVudCB0byBsb2FkIG1vcmUgZGF0YSBmcm9tIGEgY2VydGFpbiBkYXRhLXNvdXJjZVxuICogQGV4cG9ydHMgUHJvZ3Jlc3NCYXJDb21wb25lbnQgRGlzcGxheXMgZWl0aGVyIGRlZmluZWQgb3IgdW5kZWZpbmVkIHByb2dyZXNzLlxuICovXG5ATmdNb2R1bGUoe1xuICBpbXBvcnRzOiBbTmdDb21tb25Nb2R1bGUsIEkxOG5Nb2R1bGVdLFxuICBleHBvcnRzOiBbXG4gICAgSWNvbkRpcmVjdGl2ZSxcbiAgICBPdXRsZXREaXJlY3RpdmUsXG4gICAgSTE4bk1vZHVsZSxcbiAgICBOZ0NvbW1vbk1vZHVsZSxcbiAgICBIdW1hbml6ZUFwcE5hbWVQaXBlLFxuICAgIEh1bWFuaXplUGlwZSxcbiAgICBTaG9ydGVuVXNlck5hbWVQaXBlLFxuICAgIEZvck9mRGlyZWN0aXZlLFxuICAgIExvYWRNb3JlQ29tcG9uZW50LFxuICAgIE1hcEZ1bmN0aW9uUGlwZSxcbiAgICBQcm9ncmVzc0JhckNvbXBvbmVudFxuICBdLFxuICBkZWNsYXJhdGlvbnM6IFtcbiAgICBJY29uRGlyZWN0aXZlLFxuICAgIE91dGxldERpcmVjdGl2ZSxcbiAgICBIdW1hbml6ZVBpcGUsXG4gICAgSHVtYW5pemVBcHBOYW1lUGlwZSxcbiAgICBTaG9ydGVuVXNlck5hbWVQaXBlLFxuICAgIEZvck9mRGlyZWN0aXZlLFxuICAgIExvYWRNb3JlQ29tcG9uZW50LFxuICAgIE1hcEZ1bmN0aW9uUGlwZSxcbiAgICBQcm9ncmVzc0JhckNvbXBvbmVudFxuICBdLFxuICBlbnRyeUNvbXBvbmVudHM6IFtMb2FkTW9yZUNvbXBvbmVudF1cbn0pXG5leHBvcnQgY2xhc3MgQ29tbW9uTW9kdWxlIHtcbiAgc3RhdGljIHByb3ZpZGVycygpIHtcbiAgICByZXR1cm4gW1xuICAgICAgLi4uRGF0YU1vZHVsZS5wcm92aWRlcnMoKSxcbiAgICAgIC8vIFRPRE86IG1heWJlIHdlIGNhbiB0aGluayBvZiBhIHdheSB0byByZW1vdmUgdGhpcyBDOFlfQVBQIGdsb2JhbFxuICAgICAgeyBwcm92aWRlOiBIT09LX09QVElPTlMsIHVzZVZhbHVlOiAod2luZG93IGFzIGFueSkuQzhZX0FQUCB8fCB7fSwgbXVsdGk6IHRydWUgfSxcbiAgICAgIHtcbiAgICAgICAgcHJvdmlkZTogQVBQX0lOSVRJQUxJWkVSLFxuICAgICAgICB1c2VGYWN0b3J5OiBpbml0aWFsaXplU2VydmljZXMsXG4gICAgICAgIGRlcHM6IFtUcmFuc2xhdGVTZXJ2aWNlLCBBcHBTdGF0ZVNlcnZpY2UsIFVzZXJQcmVmZXJlbmNlc1NlcnZpY2VdLFxuICAgICAgICBtdWx0aTogdHJ1ZVxuICAgICAgfSxcbiAgICAgIHsgcHJvdmlkZTogSUNPTl9MSVNULCB1c2VWYWx1ZTogSUNPTlMsIG11bHRpOiBmYWxzZSB9LFxuICAgICAgLi4uSTE4bk1vZHVsZS5wcm92aWRlcnMoKSxcbiAgICAgIFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UsXG4gICAgICBPcHRpb25zU2VydmljZSxcbiAgICAgIEFwcFN0YXRlU2VydmljZVxuICAgIF07XG4gIH1cblxuICBzdGF0aWMgZm9yUm9vdCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmdNb2R1bGU6IENvbW1vbk1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogQ29tbW9uTW9kdWxlLnByb3ZpZGVycygpXG4gICAgfTtcbiAgfVxufVxuIl19