import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { NgModelGroup, ControlContainer } from '@angular/forms';
import { get } from 'lodash-es';
let OpcuaDeviceProtocolMappingCustomAction = class OpcuaDeviceProtocolMappingCustomAction {
    constructor() {
        this.hasCustomAction = false;
    }
    getHeaderPair() {
        return { key: '', value: '' };
    }
    get headers() {
        return this.customAction.headers;
    }
    addHeader() {
        const { headers } = this.customAction;
        headers.push(this.getHeaderPair());
    }
    updateCustomAction() {
        this.hasCustomAction = !this.hasCustomAction;
    }
    removeCustomAction(index) {
        const { headers } = this.customAction;
        headers.splice(index, 1);
    }
    trackByIndex(index) {
        return index;
    }
    ngOnInit() {
        if (get(this.customAction, 'endpoint')) {
            this.hasCustomAction = true;
        }
    }
    placeholder() {
        const exampleBody = {
            value: '${value}',
            serverId: '${serverId}',
            nodeId: '${nodeId}',
            deviceId: '${deviceId}'
        };
        const pretty = JSON.stringify(exampleBody, undefined, 2);
        return pretty.replace(/"\$\{value\}\"/, '${value}');
    }
    bodyTemplateMessage(text) {
        this.bodyTemplateInvalidMessage = text;
    }
};
tslib_1.__decorate([
    Input()
], OpcuaDeviceProtocolMappingCustomAction.prototype, "customAction", void 0);
OpcuaDeviceProtocolMappingCustomAction = tslib_1.__decorate([
    Component({
        selector: 'opcua-device-protocol-mapping-customaction',
        template: "<div class=\"list-group\" style=\"box-shadow:none;\">\n  <div class=\"list-group-item\">\n    <div class=\"flex-row\">\n      <div class=\"list-item-switch\">\n        <label class=\"c8y-switch\">\n          <input\n            type=\"checkbox\"\n            name=\"hasCustomAction\"\n            [(ngModel)]=\"hasCustomAction\"\n            (click)=\"updateCustomAction()\"\n          />\n          <span></span>\n        </label>\n      </div>\n      <div class=\"list-item-icon\">\n        <i c8yIcon=\"wrench\"></i>\n      </div>\n      <div class=\"list-item-title\" translate>\n        Custom action\n      </div>\n    </div>\n    <div [collapse]=\"!hasCustomAction\" [isAnimated]=\"true\">\n      <div class=\"top-p-sm\" *ngIf=\"hasCustomAction\">\n        <fieldset ngModelGroup=\"headers\">\n          <div class=\"legend form-block\" translate>Headers</div>\n          <div class=\"tight-grid flex-row hidden-xs\">\n            <div class=\"col-sm-4\">\n              <label translate>Key</label>\n            </div>\n            <div class=\"col-sm-4\">\n              <label translate>Value</label>\n            </div>\n          </div>\n          <div\n            *ngFor=\"let header of headers; trackBy: trackByIndex; let i = index; last as isLast\"\n            class=\"flex-row tight-grid row\"\n            [ngModelGroup]=\"i\"\n          >\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Key</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"key\"\n                    placeholder=\"{{ 'e.g.' | translate }} Content-Type\"\n                    required\n                    [(ngModel)]=\"header.key\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Value</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"value\"\n                    placeholder=\"{{ 'e.g.' | translate }} application/json\"\n                    required\n                    [(ngModel)]=\"header.value\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-2\">\n              <div class=\"form-group\">\n                <label class=\"visible-xs\">&nbsp;</label>\n                <button class=\"btn btn-clean\" *ngIf=\"customAction.headers.length !== 1\">\n                  <i c8yIcon=\"minus-circle\" class=\"text-danger\" (click)=\"removeCustomAction(i)\"></i>\n                </button>\n                <button class=\"btn btn-clean\" *ngIf=\"isLast\">\n                  <i c8yIcon=\"plus-circle\" class=\"text-primary\" (click)=\"addHeader()\"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </fieldset>\n        <div class=\"legend form-block\" translate>Action</div>\n        <div class=\"row\">\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label>\n                <span translate>Endpoint</span>\n              </label>\n              <div class=\"input-group\">\n                <input\n                  class=\"form-control\"\n                  type=\"text\"\n                  name=\"endpoint\"\n                  placeholder=\"{{ 'e.g.' | translate }} http://localhost:1080/cucumber\"\n                  required\n                  [(ngModel)]=\"customAction.endpoint\"\n                />\n              </div>\n            </c8y-form-group>\n          </div>\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label translate>Body template</label>\n              <textarea\n                [heightPerRow]=\"40\"\n                prettyValidJson\n                class=\"form-control\"\n                rows=\"3\"\n                name=\"bodyTemplate\"\n                [placeholder]=\"placeholder()\"\n                [(ngModel)]=\"customAction.bodyTemplate\"\n                (invalidJSON)=\"bodyTemplateMessage($event)\"\n              ></textarea>\n              <c8y-messages>\n                <c8y-message *ngIf=\"bodyTemplateInvalidMessage\">{{\n                  bodyTemplateInvalidMessage | translate\n                }}</c8y-message>\n              </c8y-messages>\n            </c8y-form-group>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
        viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
    })
], OpcuaDeviceProtocolMappingCustomAction);
export { OpcuaDeviceProtocolMappingCustomAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmctY3VzdG9tYWN0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvcHJvdG9jb2wtb3BjdWEvIiwic291cmNlcyI6WyJvcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQU9oQyxJQUFhLHNDQUFzQyxHQUFuRCxNQUFhLHNDQUFzQztJQUxuRDtRQVNFLG9CQUFlLEdBQUcsS0FBSyxDQUFDO0lBa0QxQixDQUFDO0lBL0NDLGFBQWE7UUFDWCxPQUFPLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQUksT0FBTztRQUNULE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7SUFDbkMsQ0FBQztJQUVELFNBQVM7UUFDUCxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUN0QyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDL0MsQ0FBQztJQUVELGtCQUFrQixDQUFDLEtBQUs7UUFDdEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFFdEMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3hCLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1NBQzdCO0lBQ0gsQ0FBQztJQUVELFdBQVc7UUFDVCxNQUFNLFdBQVcsR0FBRztZQUNsQixLQUFLLEVBQUUsVUFBVTtZQUNqQixRQUFRLEVBQUUsYUFBYTtZQUN2QixNQUFNLEVBQUUsV0FBVztZQUNuQixRQUFRLEVBQUUsYUFBYTtTQUN4QixDQUFDO1FBQ0YsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pELE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsbUJBQW1CLENBQUMsSUFBSTtRQUN0QixJQUFJLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDO0lBQ3pDLENBQUM7Q0FDRixDQUFBO0FBcERVO0lBQVIsS0FBSyxFQUFFOzRFQUFjO0FBRlgsc0NBQXNDO0lBTGxELFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSw0Q0FBNEM7UUFDdEQseXVKQUFnRTtRQUNoRSxhQUFhLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLENBQUM7S0FDMUUsQ0FBQztHQUNXLHNDQUFzQyxDQXNEbEQ7U0F0RFksc0NBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOZ01vZGVsR3JvdXAsIENvbnRyb2xDb250YWluZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdvcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vb3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmctY3VzdG9tYWN0aW9uLmh0bWwnLFxuICB2aWV3UHJvdmlkZXJzOiBbeyBwcm92aWRlOiBDb250cm9sQ29udGFpbmVyLCB1c2VFeGlzdGluZzogTmdNb2RlbEdyb3VwIH1dXG59KVxuZXhwb3J0IGNsYXNzIE9wY3VhRGV2aWNlUHJvdG9jb2xNYXBwaW5nQ3VzdG9tQWN0aW9uIGltcGxlbWVudHMgT25Jbml0IHtcbiAgX21vZGVsOiBhbnk7XG4gIEBJbnB1dCgpIGN1c3RvbUFjdGlvbjtcblxuICBoYXNDdXN0b21BY3Rpb24gPSBmYWxzZTtcbiAgYm9keVRlbXBsYXRlSW52YWxpZE1lc3NhZ2U6IHN0cmluZztcblxuICBnZXRIZWFkZXJQYWlyKCkge1xuICAgIHJldHVybiB7IGtleTogJycsIHZhbHVlOiAnJyB9O1xuICB9XG5cbiAgZ2V0IGhlYWRlcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VzdG9tQWN0aW9uLmhlYWRlcnM7XG4gIH1cblxuICBhZGRIZWFkZXIoKSB7XG4gICAgY29uc3QgeyBoZWFkZXJzIH0gPSB0aGlzLmN1c3RvbUFjdGlvbjtcbiAgICBoZWFkZXJzLnB1c2godGhpcy5nZXRIZWFkZXJQYWlyKCkpO1xuICB9XG5cbiAgdXBkYXRlQ3VzdG9tQWN0aW9uKCkge1xuICAgIHRoaXMuaGFzQ3VzdG9tQWN0aW9uID0gIXRoaXMuaGFzQ3VzdG9tQWN0aW9uO1xuICB9XG5cbiAgcmVtb3ZlQ3VzdG9tQWN0aW9uKGluZGV4KSB7XG4gICAgY29uc3QgeyBoZWFkZXJzIH0gPSB0aGlzLmN1c3RvbUFjdGlvbjtcblxuICAgIGhlYWRlcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gIHRyYWNrQnlJbmRleChpbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAoZ2V0KHRoaXMuY3VzdG9tQWN0aW9uLCAnZW5kcG9pbnQnKSkge1xuICAgICAgdGhpcy5oYXNDdXN0b21BY3Rpb24gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHBsYWNlaG9sZGVyKCkge1xuICAgIGNvbnN0IGV4YW1wbGVCb2R5ID0ge1xuICAgICAgdmFsdWU6ICcke3ZhbHVlfScsXG4gICAgICBzZXJ2ZXJJZDogJyR7c2VydmVySWR9JyxcbiAgICAgIG5vZGVJZDogJyR7bm9kZUlkfScsXG4gICAgICBkZXZpY2VJZDogJyR7ZGV2aWNlSWR9J1xuICAgIH07XG4gICAgY29uc3QgcHJldHR5ID0gSlNPTi5zdHJpbmdpZnkoZXhhbXBsZUJvZHksIHVuZGVmaW5lZCwgMik7XG4gICAgcmV0dXJuIHByZXR0eS5yZXBsYWNlKC9cIlxcJFxce3ZhbHVlXFx9XFxcIi8sICcke3ZhbHVlfScpO1xuICB9XG5cbiAgYm9keVRlbXBsYXRlTWVzc2FnZSh0ZXh0KSB7XG4gICAgdGhpcy5ib2R5VGVtcGxhdGVJbnZhbGlkTWVzc2FnZSA9IHRleHQ7XG4gIH1cbn1cbiJdfQ==