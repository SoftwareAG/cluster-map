!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@c8y/ngx-components"),require("@c8y/client"),require("lodash-es"),require("@angular/router")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/protocol-impact",["exports","@angular/core","@c8y/ngx-components","@c8y/client","lodash-es","@angular/router"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"]["protocol-impact"]={}),e.ng.core,e.c8y["ngx-components"],e.client,e.lodashEs,e.ng.router)}(this,(function(e,t,r,n,o,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function c(e,t,r,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,r,c):o(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c}function a(e,t,r,n){return new(r||(r=Promise))((function(o,i){function c(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(c,a)}s((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var u=function(){function e(e){this.client=e,this.microserviceUrl="/service/impact",this.header={"Content-Type":"application/json"}}return e.prototype.refreshDeviceResources=function(e){var t={method:"PUT",headers:this.header};return this.client.fetch(this.microserviceUrl+"/refresh/"+e,t)},e.ctorParameters=function(){return[{type:n.FetchClient}]},e=c([t.Injectable()],e)}(),l=function(){function e(e,t,r,n){this.vcRef=e,this.router=t,this.impactService=r,this.alert=n}return e.prototype.ngOnInit=function(){this.vcRef.createEmbeddedView(this.templateCopy)},e.prototype.refresh=function(){return a(this,void 0,void 0,(function(){var e,t,n,o,i,c;return s(this,(function(a){switch(a.label){case 0:if(e=this.router&&this.router.routerState&&this.router.routerState.snapshot&&this.router.routerState.snapshot.url,!(t=e&&(/^\/device\/(\d+)\/.*$/gi.exec(e)||[])[1]))return[3,10];this.requestInProgress=!0,a.label=1;case 1:return a.trys.push([1,8,,9]),[4,this.impactService.refreshDeviceResources(t)];case 2:return(n=a.sent())&&200!==n.status?n.json?[4,n.json()]:[3,4]:[3,6];case 3:return i=a.sent(),[3,5];case 4:i=void 0,a.label=5;case 5:return o=i,this.alert.addServerFailure({data:o,res:n}),[3,7];case 6:this.alert.success(r.gettext("Device resource refresh scheduled.")),a.label=7;case 7:return[3,9];case 8:return c=a.sent(),this.alert.addServerFailure(c),[3,9];case 9:return this.requestInProgress=!1,[3,11];case 10:this.alert.danger(r.gettext("Could not find device ID in URL.")),a.label=11;case 11:return[2]}}))}))},e.ctorParameters=function(){return[{type:t.ViewContainerRef},{type:i.Router},{type:u},{type:r.AlertService}]},c([t.ViewChild("templateCopy",{read:t.TemplateRef,static:!0})],e.prototype,"templateCopy",void 0),e=c([t.Component({selector:"c8y-impact-refresh-action",template:'<ng-template #templateCopy>\n  <li>\n    <button\n      class="btn btn-link"\n      title="{{ \'Refresh device resources\' | translate }}"\n      (click)="refresh()"\n    >\n      <i class="fa fa-refresh" [ngClass]="{ \'fa-spin\': requestInProgress }"></i>&nbsp;<span\n        translate\n        >Refresh device resources</span\n      >\n    </button>\n  </li>\n</ng-template>\n'})],e)}(),p=function(){function e(e){this.applicationService=e}var r;return r=e,e.prototype.get=function(e){return a(this,void 0,void 0,(function(){var t,n,i,c,a;return s(this,(function(s){switch(s.label){case 0:return t=[],n=!e.parent||e.snapshot.data.context?e.snapshot.data:e.parent.snapshot.data,i=n.contextData,c="device-info"===o.get(e,"snapshot.url[0].path"),(a=c&&i&&i.c8y_ImpactResourceInfo)?[4,this.applicationService.isAvailable(r.applicationName)]:[3,2];case 1:a=s.sent().data,s.label=2;case 2:return a&&t.push({priority:500,placement:"right",template:l}),[2,t]}}))}))},e.applicationName="impact",e.ctorParameters=function(){return[{type:n.ApplicationService}]},e=r=c([t.Injectable()],e)}(),f=function(){function e(){}return e=c([t.NgModule({declarations:[l],imports:[r.CoreModule],providers:[u,{provide:r.HOOK_ACTION_BAR,useClass:p,multi:!0}],entryComponents:[l]})],e)}();e.ImpactProtocolModule=f,e.ɵa=l,e.ɵb=u,e.ɵc=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-protocol-impact.umd.min.js.map