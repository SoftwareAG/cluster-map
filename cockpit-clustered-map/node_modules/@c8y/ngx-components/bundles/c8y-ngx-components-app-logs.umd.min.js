!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@c8y/ngx-components"),require("ngx-bootstrap/buttons"),require("@c8y/client"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/app-logs",["exports","@angular/core","@c8y/ngx-components","ngx-bootstrap/buttons","@c8y/client","rxjs","rxjs/operators"],e):e(((t=t||self).c8y=t.c8y||{},t.c8y["ngx-components"]=t.c8y["ngx-components"]||{},t.c8y["ngx-components"]["app-logs"]={}),t.ng.core,t.c8y["ngx-components"],t.buttons,t.client,t.rxjs,t.rxjs.operators)}(this,(function(t,e,o,n,r,s,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var u=function(){return(u=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function p(t,e,o,n){var r,s=arguments.length,i=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(i=(s<3?r(i):s>3?r(e,o,i):r(e,o))||i);return s>3&&i&&Object.defineProperty(e,o,i),i}var c=function(){function t(t){this.client=t,this.BASE_PATH_APPLICATION="application/applications",this.header={Accept:"application/vnd.com.nsn.cumulocity.applicationLogs+json;charset=UTF-8;ver=0.9"}}return t.prototype.getLogs$=function(t,e,o){void 0===o&&(o={});var n=this.BASE_PATH_APPLICATION+"/"+t+"/logs/"+e,r={headers:this.header,method:"GET"},p=o.dateFrom?this.formatDate(o.dateFrom):null,c=o.dateTo?this.formatDate(o.dateTo):null,a=u({},o,p&&{dateFrom:p},c&&{dateTo:c}),l=o?u({},r,{params:a}):u({},r);return s.from(this.client.fetch(n,l)).pipe(i.flatMap((function(t){return t.json()})))},t.prototype.formatDate=function(t){return new Date(t).toISOString()},t.ctorParameters=function(){return[{type:r.FetchClient}]},t=p([e.Injectable()],t)}(),a=function(){function t(t){this.appLogsService=t,this.cancel$=new s.Subject,this.isAutoRefreshDisabled=!1,this.logsToOutput=this.getEmptyLogsJson(),this.isAutoRefreshOn=!1,this.onNewLogs=new e.EventEmitter,this.toggleState=function(t){return!t}}return Object.defineProperty(t.prototype,"buttonsDisabled",{set:function(t){this.isAutoRefreshDisabled=t,t&&this.isAutoRefreshOn&&this.cancel$.next(!1)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this,e=s.fromEvent(this.button.nativeElement,"click").pipe(i.merge(this.cancel$),i.debounce((function(){return s.interval(300)})),i.scan(this.toggleState,!1),i.tap((function(e){return t.setButtonState(e)})),i.switchMap((function(e){return e?t.watchForNewLogs():s.NEVER})));this.subscription=e.subscribe()},t.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},t.prototype.setButtonState=function(t){this.isAutoRefreshOn=t},t.prototype.watchForNewLogs=function(){var t=this;return this.startPolling().pipe(i.takeUntil(this.cancel$.pipe(i.filter((function(t){return!1===t})))),i.finalize((function(){t.isAutoRefreshOn=!1})))},t.prototype.startPolling=function(){var t=this;return s.of(1).pipe(i.switchMap((function(){return t.getNewLogs().pipe(i.catchError((function(e){return s.of(t.getEmptyLogsJson())})))})),i.tap((function(e){return t.updateLogsToOutput(e)})),i.delay(1e4),i.repeat())},t.prototype.getNewLogs=function(){return this.appLogsService.getLogs$(this.getAppId(),this.getInstanceName())},t.prototype.getAppId=function(){return this.mo.applicationId},t.prototype.getInstanceName=function(){return this.selectedInstance.name},t.prototype.updateLogsToOutput=function(t){var e=t.dateFrom,o=t.dateTo;e&&o&&(this.logsToOutput=u({},t),this.onNewLogs.emit(this.logsToOutput))},t.prototype.getEmptyLogsJson=function(){return{dateFrom:null,dateTo:null,logs:"",truncated:!1}},t.ctorParameters=function(){return[{type:c}]},p([e.Input()],t.prototype,"selectedInstance",void 0),p([e.Input()],t.prototype,"mo",void 0),p([e.Input()],t.prototype,"buttonsDisabled",null),p([e.Output()],t.prototype,"onNewLogs",void 0),p([e.ViewChild("autoRefresh",{static:!0})],t.prototype,"button",void 0),t=p([e.Component({selector:"c8y-app-logs-auto-refresh",template:'<button #autoRefresh\n  type="button"\n  class="btn btn-link c8y-realtime"\n  [ngStyle]="{\'width\': \'auto\'}"\n  title="{{\'Toggle auto refresh\' | translate}}"\n  [disabled]="isAutoRefreshDisabled"\n>\n  <span class="c8y-pulse" [ngClass]="isAutoRefreshOn ? \'active\' : \'inactive\'"></span>\n  {{\'Auto refresh\' | translate}}\n</button>'})],t)}(),l=function(){function t(){}return t=p([e.NgModule({declarations:[a],exports:[a],imports:[o.CommonModule,n.ButtonsModule],entryComponents:[a],providers:[c]})],t)}();t.AppLogsAutoRefreshComponent=a,t.AppLogsAutoRefreshModule=l,t.Éµa=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-app-logs.umd.min.js.map