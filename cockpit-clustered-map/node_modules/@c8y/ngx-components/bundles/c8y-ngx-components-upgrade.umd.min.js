!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@c8y/ngx-components"),require("rxjs"),require("rxjs/operators"),require("@angular/router"),require("@c8y/client"),require("@angular/core"),require("lodash-es"),require("@c8y/ngx-components/context-dashboard"),require("@angular/common"),require("@ngx-translate/core"),require("@angular/upgrade/static"),require("angular"),require("@c8y/ngx-components/app-logs"),require("@c8y/ngx-components/connectivity"),require("@c8y/ngx-components/api")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/upgrade",["exports","@c8y/ngx-components","rxjs","rxjs/operators","@angular/router","@c8y/client","@angular/core","lodash-es","@c8y/ngx-components/context-dashboard","@angular/common","@ngx-translate/core","@angular/upgrade/static","angular","@c8y/ngx-components/app-logs","@c8y/ngx-components/connectivity","@c8y/ngx-components/api"],e):e(((t=t||self).c8y=t.c8y||{},t.c8y["ngx-components"]=t.c8y["ngx-components"]||{},t.c8y["ngx-components"].upgrade={}),t.c8y["ngx-components"],t.rxjs,t.rxjs.operators,t.ng.router,t.client,t.ng.core,t.lodashEs,t.c8y["ngx-components"]["context-dashboard"],t.ng.common,t.core$1,t.ng.upgrade.static,t.angular,t.c8y["ngx-components"]["app-logs"],t.c8y["ngx-components"].connectivity,t.c8y["ngx-components"].api)}(this,(function(t,e,n,o,r,i,a,c,s,u,p,d,h,l,f,g){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var m,y=function(){return(y=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function b(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function S(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,c)}s((o=o.apply(t,e||[])).next())}))}function w(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function C(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}!function(t){t.Device="deviceId",t.Group="groupId",t.User="userId",t.Application="applicationId",t.SubscribedApplications="applicationId",t.Tenant="tenantId"}(m||(m={}));var x=function(){function t(t,e,o,r,i,a,c){this.injector=t,this.appState=e,this.fetchClient=o,this.router=r,this.ngZone=i,this.routerService=a,this.actionService=c,this.$liveTabs=new n.BehaviorSubject([]),this.fixE2eIssues(),this.$ng1RouteChangeSuccess=this.fromNg1Event(this.injector.get("$rootScope"),"$routeChangeSuccess"),this.$ng1RouteChangeStart=this.fromNg1Event(this.injector.get("$rootScope"),"$routeChangeStart"),this.hookAuth(),this.hookLanguage(),this.hookTabs(),this.hookNavigator(),this.hookUserMenu(),this.hookViewProvider(),this.router.initialNavigation(),this.ng1Routes()}return t.prototype.hookViewProvider=function(){var t=this;this.injector.get("c8yViews").contextViews.subscribe((function(e){return t.addRoute(e)}))},t.prototype.addRoute=function(t){var n=this;this.routerService.addRoute({label:t.label||t.name,path:t.path,icon:t.icon,context:e.ViewContext[t.contextKey],priority:t.priority,component:e.EmptyComponent,data:{showIf:t.showIf?function(e){var o,r=y({},e.params,((o={})[m[t.contextKey]]=e.params.id,o)),i=n.injector.invoke(t.showIf,void 0,{$routeParams:r});return n.injector.get("$q").when(i).then(Boolean)}:void 0}}),t.runPhase&&this.router.navigateByUrl(this.router.url)},t.prototype.ng1Routes=function(){var t=[];for(var n in e.ViewContext){var i=e.ViewContext[n].match(/(\w+)\//)[1],a=new RegExp("^/"+i+"/(?:([^/]+)).*$");t.push({keys:[{name:m[n],optional:!1}],regexp:a,template:""})}var c=this.injector.get("$route");Object.defineProperty(c.routes,"forEach",{value:function(e,n){for(var o in this)e.call(n,this[o],o,this);t.forEach((function(t){return e.call(n,t)}))}});var s=this.injector.get("c8yUiUtil"),u=s.getContext;this.router.events.pipe(o.filter((function(t){return t instanceof r.ActivationEnd}))).subscribe((function(t){"**"===t.snapshot.routeConfig.path?s.getContext=u:t.snapshot.data&&t.snapshot.data.context?s.getContext=function(){return{context:t.snapshot.data.context.replace("/:id",""),id:t.snapshot.data.contextData.id}}:s.getContext=function(){return{context:null,id:null}}}))},t.prototype.fixE2eIssues=function(){try{var t=this.ngZone,e=window.org.cometd.Utils,n=e.setTimeout;e.setTimeout=function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];return t.runOutsideAngular((function(){return n.apply(e,o)}))}}catch(t){}try{var o=window.ace,r=o.edit,i=this.ngZone;o.edit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i.runOutsideAngular((function(){return r.apply(o,t)}))}}catch(t){}},t.prototype.setToken=function(t,e,n){void 0===n&&(n="Basic");var o=this.injector.get("c8yAuth");"Basic"===n?(o.onSetToken({token:t,type:n}),e&&o.setTFAToken(e)):o.authReady()},t.prototype.hookAuth=function(){var t=this;this.appState.currentUser.subscribe((function(e){if(e){var n=t.fetchClient.getFetchOptions({}).headers;if(t.injector.get("c8yAuth").headers=function(){return t.fetchClient.getFetchOptions({}).headers},n.Authorization){var o=n.Authorization.match(/basic\s(.*)$/i)[1];o&&t.setToken(o,n.tfatoken)}else t.setToken(void 0,n.tfatoken,"Oauth");t.injector.get("$rootScope").$emit("authStateChange",{hasAuth:!0})}else t.injector.get("$rootScope").$emit("authStateChange",{hasAuth:!1})}))},t.prototype.hookLanguage=function(){var t=this,e=!0;this.appState.map((function(t){return t.lang})).subscribe((function(n){t.injector.get("c8yLocales").switchToLanguage(n),e||t.injector.get("$rootScope").$apply(),e=!1}))},t.prototype.hookTabs=function(){var t=this;this.injector.get("c8yActions");var e=this.injector.get("$location"),r=this.injector.get("c8yTabs"),i=[];r.addTab=function(e){i.push(y({},e,{label:e.label||e.name,path:decodeURIComponent(e.path)})),t.$liveTabs.next(i)},this.$ng1RouteChangeStart.subscribe((function(e){i=[],t.$liveTabs.next(i)})),this.$ng1RouteChangeSuccess.subscribe((function(n){var o=e.path();t.router.url!==o&&t.router.navigate(o.split("/"),{queryParams:e.search(),skipLocationChange:!0}),t.actionService&&t.actionService.refresh()})),this.$routeChanges=this.$ng1RouteChangeSuccess.pipe(o.merge(this.fromNg1Event(r,r.EVENT_UPDATE),n.of(1)),o.debounceTime(100))},t.prototype.hookNavigator=function(){this.navigationNodes$=this.injector.get("c8yNavigator").rootNodes$},t.prototype.getTabs=function(){var t=this,e=function(t){return t.show},r=function(t){return y({},t,{label:t.label||t.name,path:decodeURIComponent(t.path)})},i=this.$routeChanges.pipe(o.switchMap((function(){var n=t.injector.get("c8yTabs").routeTabs;return Promise.all(n.map((function(t){return t.checkingVisibility}))).then((function(){return n.filter(e).map(r)}))})),o.startWith([]));return n.combineLatest(i,this.$liveTabs).pipe(o.map((function(t){var e=C(t,2),n=e[0],o=e[1];return n.concat(o)})))},t.prototype.getQuickLinks=function(){return this.injector.get("c8yQuickLinks").list()},t.prototype.getActionBarItems=function(){var t=this.injector.get("c8yActionBar"),e=this.injector.get("$rootScope");return this.fromNg1Event(e,"c8yActionBarChanged").pipe(o.startWith(1),o.map((function(){return t.elements.map((function(t){return{priority:t.getAttribute("action-bar-priority")||0,template:t,placement:t.getAttribute("action-bar-position")||"right"}}))})))},t.prototype.getBreadcrumbs=function(){var t=this.injector.get("$location").path(),e=this.injector.get("c8yBreadcrumbs"),r=e.get(t)||{},i=r.data?this.injector.invoke(r.data):n.of([]);return n.from(i).pipe(o.map((function(t){return(t=t.concat(e.getLiveBreadcrumbs())).map((function(t){return{items:t.slice(0,t.length-1)}}))})))},t.prototype.getSearch=function(){var t=this.injector.get("c8ySearch");return t.list().map((function(e){return{icon:"search",name:e.name,term:"",onSearch:function(){this.term&&t.search(this.term)}}}))},t.prototype.getActions=function(){var t=this,e=this.injector.get("c8yActions").registeredActions;return n.of(e.filter((function(t){return!t.hidden})).map((function(e){return{priority:-1*(e.priority||0),label:e.text,icon:e.icon,disabled:e.disabled,action:function(){t.injector.invoke(e.action,e)}}})))},t.prototype.fromNg1Event=function(t,e){var o;return n.fromEventPattern((function(n){o=t.$on(e,n)}),(function(){return o()}))},t.prototype.hookUserMenu=function(){var t=this.injector.get("c8yUserMenuService"),n=this.injector.get("c8yAccessDenied");t.add({icon:"exclamation-triangle",priority:10,label:e.gettext("Access denied requests"),click:n.showAccessDeniedRequestsList})},t}();function j(t,e,n,o,r,i,a){return new x(t,e,n,o,r,i,a)}var T={provide:x,useFactory:j,deps:["$injector",e.AppStateService,i.FetchClient,r.Router,a.NgZone,e.RouterService,e.ActionService]},I=function(){function t(t){this.bridge=t,this.routeChanges$=t.$routeChanges}return t.prototype.get=function(){return this.bridge.getActionBarItems()},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),A=function(){function t(t,e){var n=this;this.bridge=t,this.tabs=e,this.routeChanges$=t.$routeChanges,this.$location=t.injector.get("$location"),this.tabs.items$.subscribe((function(t){return n.handleTabsRedirect(t)}))}return t.prototype.handleTabsRedirect=function(t){var e=t.find((function(t){return t.redirectedTo})),n=C(t,1)[0];e&&!n.redirectedTo&&(this.$location.replace(),this.$location.path(n.path),n.redirectedTo=!0,e.redirectedTo=!1)},t.prototype.get=function(){return this.bridge.getActions()},t.ctorParameters=function(){return[{type:x},{type:e.TabsService}]},t=b([a.Injectable()],t)}(),O=function(){function t(t){var e=this;this.bridge=t,this.trigger=new n.ReplaySubject(1),this.breadcrumbs=this.trigger.pipe(o.debounceTime(100),o.switchMap((function(){return e.bridge.getBreadcrumbs()})))}return t.prototype.get=function(){return this.trigger.next(),this.breadcrumbs},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),$=function(){function t(t){this.bridge=t}return t.prototype.get=function(){return this.bridge.navigationNodes$},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),D=function(){function t(t){this.bridge=t,this.search=this.bridge.getSearch()}return t.prototype.get=function(){return this.search},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),R=function(){function t(t){this.bridge=t,this.tabsObservable=t.getTabs()}return t.prototype.get=function(){return this.tabsObservable},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),N=function(){function t(t){this.bridge=t,this.links=this.bridge.getQuickLinks(),this.links.then((function(t){t.map((function(t){return t.type=t.type||"quicklink",t}))}))}return t.prototype.get=function(){return this.links},t.ctorParameters=function(){return[{type:x}]},t=b([a.Injectable()],t)}(),P=function(){function t(){}return t=b([a.NgModule({imports:[e.RouterModule],exports:[],providers:[T,{provide:e.HOOK_NAVIGATOR_NODES,useClass:$,multi:!0},{provide:e.HOOK_TABS,useClass:R,multi:!0},{provide:e.HOOK_ACTION_BAR,useClass:I,multi:!0},{provide:e.HOOK_ACTION,useClass:A,multi:!0},{provide:e.HOOK_BREADCRUMB,useClass:O,multi:!0},{provide:e.HOOK_SEARCH,useClass:D,multi:!0},{provide:e.HOOK_DOCS,useClass:N,multi:!0}]})],t)}(),k=function(){function t(t,e,n,o){this.ng1Injector=t,this.zone=e,this.router=n,this.contextDashboardService=o,this.dashboardSvc=t.get("dashboardSvc"),this.compile=t.get("$compile")}return Object.defineProperty(t.prototype,"ng1Components",{get:function(){return this.ng1Injector.get("c8yComponents")},enumerable:!0,configurable:!0}),t.prototype.instantiateComponent=function(t,e){return S(this,void 0,void 0,(function(){var n,o,r,i,a=this;return w(this,(function(c){switch(c.label){case 0:return n=t.dashboard,o=t.context,r=t.child,n?[4,this.dashboardSvc.transformChildWithContext(this.dashboardSvc.forcedContext||o,n,r)]:[3,4];case 1:return i=c.sent(),this.dashboardSvc.forcedContext||n.deviceType?[4,this.dashboardSvc.updateConfigTargetsWithContext(this.dashboardSvc.forcedContext||o,i.config)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2,this.zone.runOutsideAngular((function(){return a.loadTemplate(i,r,e,o)}))];case 4:return[2,this.loadConfigTemplate(e,t)]}}))}))},t.prototype.editDashboard=function(t){return S(this,void 0,void 0,(function(){return w(this,(function(e){return[2,this.dashboardSvc.editCurrentDashboard({dashboardId:t.id})]}))}))},t.prototype.copyDashboard=function(){var t=this.getDashboard();if(this.dashboardSvc.copyDashboard(t.c8y_Dashboard))return this.dashboardClipboard=t,t},t.prototype.pasteDashboard=function(){return S(this,void 0,void 0,(function(){var t;return w(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.dashboardSvc.pasteDashboard()];case 1:return t=e.sent(),[4,this.contextDashboardService.addTab(t)];case 2:return e.sent(),this.navigateToDashboard(t),this.dashboardClipboard=void 0,[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},t.prototype.instantiateDeviceSelector=function(t,e){return this.loadConfigTemplate(t,e,!0)},t.prototype.loadTemplate=function(t,e,n,o){var r=this.ng1Injector.get("$rootScope").$new(!0);return r.child=t,r.dashboardContext=o,e.widgetComponent?n.innerHTML="<c8y-ui-component component-name=\"'"+e.widgetComponent+'\'" config="child.config" context="dashboardContext"></c8y-ui-component>':e.templateUrl&&(n.innerHTML="<ng-include src=\"'"+e.templateUrl+"'\"></ng-include>"),this.compile(n)(r),r},t.prototype.navigateToDashboard=function(t){/dashboard/.test(this.router.url)?this.router.navigate(["..",t.id],{relativeTo:e.getActivatedRoute(this.router)}):this.router.navigate(["..","dashboard",t.id],{relativeTo:e.getActivatedRoute(this.router)})},t.prototype.getDashboard=function(){return e.getActivatedRoute(this.router).snapshot.data.dashboard},t.prototype.loadConfigTemplate=function(t,n,o){var r=this;void 0===o&&(o=!1);var i=n.settings,a=this.ng1Injector.get("$rootScope").$new(!0);a.settings=y({},i,i.ng1),a.options=n.options,a.config=n,a.forms={},a.rootId=i.context.id,a.dashboard=c.get(n,"settings.dashboardMo");var s="";return o||(n.settings.configComponent?s="<c8y-ui-component component-name=\"'"+n.settings.configComponent+'\'" config="config"></c8y-ui-component>':n.settings.configTemplateUrl&&(s="<ng-include src=\"'"+n.settings.configTemplateUrl+"'\"></ng-include>")),t.innerHTML='\n    <ng-form name="forms.componentForm">\n      <div class="form-group"\n        ng-if="!settings.noDeviceTarget"\n        ng-style="{height: settings.hideTarget && \'0\', overflow: \'hidden\'}"\n      >\n        <label translate>'+e.gettext("Target assets or devices")+'</label>\n        <c8y-device-selector-combo parent="rootId"\n          selected-child-device="config.device"\n          groups-selectable="settings.groupsSelectable"\n        ></c8y-device-selector-combo>\n      </div>\n      '+s+"\n    </ng-form>",a.$watch("forms.componentForm.$invalid",(function(t){r.contextDashboardService.formDisabled=t})),this.compile(t)(a),this.contextDashboardService.formDisabled=a.forms.componentForm.$invalid,a},t.ctorParameters=function(){return[{type:void 0},{type:a.NgZone},{type:r.Router},{type:s.ContextDashboardService}]},t=b([a.Injectable()],t)}(),E=function(){function t(t,e){this.dashboardBridgeService=t,this.el=e}return t.prototype.ngOnInit=function(){return S(this,void 0,void 0,(function(){var t;return w(this,(function(e){switch(e.label){case 0:return t=this,[4,this.dashboardBridgeService.instantiateComponent(this.config,this.el.nativeElement)];case 1:return t.ng1Scope=e.sent(),[2]}}))}))},t.prototype.ngOnDestroy=function(){this.ng1Scope&&this.ng1Scope.$destroy()},t.ctorParameters=function(){return[{type:k},{type:a.ElementRef}]},t=b([a.Component({selector:"c8y-widget-legacy",template:"",changeDetection:a.ChangeDetectionStrategy.OnPush})],t)}(),B=function(){function t(t,e){this.dashboardBridgeService=t,this.el=e}return t.prototype.ngOnInit=function(){return S(this,void 0,void 0,(function(){return w(this,(function(t){return this.ng1Scope=this.dashboardBridgeService.instantiateDeviceSelector(this.el.nativeElement,this.config),[2]}))}))},t.prototype.ngOnDestroy=function(){this.ng1Scope&&this.ng1Scope.$destroy()},t.ctorParameters=function(){return[{type:k},{type:a.ElementRef}]},t=b([a.Component({selector:"c8y-device-selector-legacy",template:"",changeDetection:a.ChangeDetectionStrategy.OnPush})],t)}(),_=function(){function t(t){this.bridge=t}return t.prototype.get=function(){return S(this,void 0,void 0,(function(){var t;return w(this,(function(e){switch(e.label){case 0:return[4,this.bridge.ng1Components.list()];case 1:return(t=e.sent().map((function(t){var e={settings:y({},t.options,{configTemplateUrl:t.configTemplateUrl,widgetComponent:t.widgetComponent,configComponent:t.configComponent,transformConfigWithContext:t.transformConfigWithContext||t.componentTransformConfigWithContext,upgrade:!0})};return e.settings.templateUrl=t.templateUrl,{id:t.name,label:t.nameDisplay||t.name,description:t.description,component:E,configComponent:E,previewImage:t.previewImage,data:e}}))).push({id:"device.selector.legacy",label:"Device selector",description:"",data:{settings:{noNewWidgets:!0,upgrade:!0}},component:B}),[2,t]}}))}))},t.ctorParameters=function(){return[{type:k}]},t=b([a.Injectable()],t)}(),U=function(){function t(t,e){this.vcRef=t,this.dashboardBridgeService=e}return t.prototype.ngOnInit=function(){this.vcRef.createEmbeddedView(this.templateCopy)},t.prototype.copyDashboard=function(){this.dashboardBridgeService.copyDashboard()},t.ctorParameters=function(){return[{type:a.ViewContainerRef},{type:k}]},b([a.ViewChild("templateCopy",{read:a.TemplateRef,static:!0})],t.prototype,"templateCopy",void 0),t=b([a.Component({selector:"c8y-copy-action-legacy",template:'\n    <ng-template #templateCopy>\n      <li>\n        <button title="{{\'Copy dashboard\' | translate}}" (click)="copyDashboard()">\n          <i class="fa fw fa-clone"></i>&nbsp;<span translate>Copy dashboard</span>\n        </button>\n      </li>\n    </ng-template>\n  '})],t)}(),V=function(){function t(t,e){this.vcRef=t,this.dashboardBridgeService=e,this.dashboardName=""}return t.prototype.ngOnInit=function(){this.vcRef.createEmbeddedView(this.templatePaste),this.dashboardName=this.dashboardBridgeService.dashboardClipboard.c8y_Dashboard.name},t.prototype.pasteDashboard=function(){this.dashboardBridgeService.pasteDashboard()},t.ctorParameters=function(){return[{type:a.ViewContainerRef},{type:k}]},b([a.ViewChild("templatePaste",{read:a.TemplateRef,static:!0})],t.prototype,"templatePaste",void 0),t=b([a.Component({selector:"c8y-copy-action-legacy",template:'\n    <ng-template #templatePaste>\n      <li>\n        <button title="{{\'Paste dashboard\' | translate}}" (click)="pasteDashboard()">\n          <i class="fa fw fa-clipboard"></i>&nbsp;<span translate>Paste dashboard</span>&nbsp;<span\n            >"{{ dashboardName }}"</span\n          >\n        </button>\n      </li>\n    </ng-template>\n  '})],t)}(),M=function(){function t(t){this.dashboardBridgeService=t}return t.prototype.get=function(t){var n=[],o=!t.parent||t.snapshot.data.context?t.snapshot.data:t.parent.snapshot.data,r=o.contextData,i=r&&t.snapshot.data.dashboard,a=r&&[e.ViewContext.Device,e.ViewContext.Group].includes(o.context)&&this.dashboardBridgeService.dashboardClipboard;return i&&n.push({priority:-20,placement:"more",template:U}),a&&n.push({priority:-10,placement:"more",template:V}),n},t.ctorParameters=function(){return[{type:k}]},t=b([a.Injectable()],t)}(),q=function(){function t(){}return t=b([a.NgModule({declarations:[B,E,U,V],entryComponents:[B,E,U,V],imports:[u.CommonModule,p.TranslateModule],providers:[{provide:k,useFactory:H,deps:["$injector",a.NgZone,r.Router,[new a.Optional,s.ContextDashboardService]]},{provide:e.HOOK_COMPONENTS,useClass:_,multi:!0},{provide:e.HOOK_ACTION_BAR,useClass:M,multi:!0}]})],t)}();function H(t,e,n,o){return new k(t,e,n,o)}var L=d.downgradeComponent({component:e.BootstrapComponent}),K=d.downgradeComponent({component:e.UserTotpRevokeComponent}),G=d.downgradeComponent({component:l.AppLogsAutoRefreshComponent}),W=d.downgradeComponent({component:e.DataGridComponent}),F=d.downgradeComponent({component:f.ImpactProviderSettingsComponent}),Z=function(){function t(t,e){this.translateService=t,this.MESSAGE_PATTERNS=e}var n,o;return t.prototype.translate=function(t){return this.translateService.instant(t)},t.ctorParameters=function(){return[{type:p.TranslateService},{type:void 0,decorators:[{type:a.Inject,args:[e.HOOK_PATTERN_MESSAGES]}]}]},t=b([a.Injectable(),(n=1,o=a.Inject(e.HOOK_PATTERN_MESSAGES),function(t,e){o(t,e,n)})],t)}(),z=d.downgradeInjectable(x),Q=d.downgradeInjectable(e.AppStateService),J=d.downgradeInjectable(e.HeaderService),X=d.downgradeInjectable(e.AlertService),Y=d.downgradeInjectable(e.UserMenuService),tt=d.downgradeInjectable(g.ApiService),et=d.downgradeInjectable(e.DocsService),nt=d.downgradeInjectable(e.PasswordService),ot=d.downgradeInjectable(p.TranslateService),rt=d.downgradeInjectable(Z);function it(t,e,n){function o(t){var e=t.config,o=e.url,r=e.method;n.onFinish({url:o,method:r,response:t,options:t.config})}return{request:function(t){var e=t.url,o=t.method;return n.onStart({url:e,method:o,options:t}),t},requestError:function(e){return o(e),t.reject(e)},response:function(t){return o(t),t},responseError:function(n){return o(n),e.responseError(n),t.reject(n)}}}var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.addRoot=function(e){var n;return""===e.path&&(e.path="/"),e.label=e.name,"object"==typeof e.parent&&(e.parent.label=e.parent.name),e.preventDuplicates&&(n=this.find((function(t){var n=t.path,o=t.parents,r=t.label;return n===e.path&&r===e.label&&o.some((function(t){return t.label===e.parent}))})))&&(n.routerLinkExact=!1),n||t.prototype.addRoot.call(this,e)},e.prototype.createNode=function(e){var n=t.prototype.createNode.call(this,e),o=n.update.bind(n),r=this;return Object.defineProperties(c.assign(n,{realName:n.name||n.label,_parent:!0,update:function(t){void 0===this._parent&&(r.addRoot(this),this._parent=!0),o(t)},addChild:function(t){this.add(r.createNode(t))}}),{label:{get:function(){return this.realName||""},set:function(t){this.realName=t}},name:{get:function(){return this.realName||""},set:function(t){this.realName=t}},show:{get:function(){return!this.hidden},set:function(t){this.hidden=!t}}})},e}(e.NavigatorNodeRoot);var ct={template:'\n  <c8y-bootstrap>\n    <div id="c8y-legacy-view">\n      <div ng-view ng-if="vm.widthSet && vm.authState.hasAuth"></div>\n    </div>\n  </c8y-bootstrap>',controller:function(t,e,n,o,r,i){var a=this;function c(t,e){a.authState=e}function s(){a.tabsHorizontal=n.appOption("tabsHorizontal")}function u(){var t=document.querySelector("#c8y-legacy-view");t&&t.clientWidth?a.widthSet=!0:e(u)}Object.assign(a,{$onInit:function(){i.map((function(t){return t.nav.open})).subscribe((function(t){a.navOpen=t})),i.configNavigator({canToggle:!0}),t.$on("authStateChange",c),a.rootNodes=o.rootNodes,r.currentAppCached().then(s),a.navHiddenOnStartup=n.appOption("hide_navigator"),u()},navOpen:!1})},controllerAs:"vm"};window.preventNg1Bootstrap=!0,h.module("c8y.upgrade",[]).config((function(t){var e=t.interceptors.indexOf("c8yLoadingIndicator");e>-1&&t.interceptors.splice(e,1),t.interceptors.push(it)})).component("c8yUiRoot",ct).directive("c8yBootstrap",L).factory("c8yBridgeService",z).factory("c8yAppStateService",Q).factory("c8yHeaderService",J).factory("c8yUserMenuService",Y).decorator("c8yTitle",(function(t,e,n,o,r,i,a,c){function s(e){t.when(e).then((function(t){return u(function(t){var e=t.title,n=t.subtitle,r=o.$new(!0);return r.title=e,r.subtitle=n,a(h.element('\n      <h1 class="text-truncate">{{title | translate}}\n      <small>{{ subtitle | translate }}</small></h1>\n    '))(r)[0]}(t))}))}function u(t){c.changeTitle(t)}function p(t){t.show(),u(t[0])}return e.changeTitle=s,e.setTitleElement=p,o.$on("$routeChangeStart",(function(){s({})})),o.$on("$routeChangeSuccess",(function(o){var c=e.get(r.path());c&&t.when(c.data?n.invoke(c.data):{}).then((function(t){var e=t.templateUrl;if(e){var n=i.get(e);p(a(n)(o.targetScope))}else s(t)}))})),e})).factory("c8yAlert",X).decorator("c8yAlert",(function(t,e,n){for(var o in t.add=function(e){t.addAlert(r(e))},e.$on("alert",(function(e,n){t.addAlert(r(n))})),e.$on("message",(function(e,n){t.addAlert(r(n))})),t)"function"==typeof t[o]&&(t[o]=t[o].bind(t));function r(t){var e=y({},t);return t.onClose&&(e.onClose=function(){n.invoke(t.onClose)}),t.onDetail&&(e.onDetail=function(){n.invoke(t.onDetail)}),e}return t})).decorator("groupTypesHierarchyNavigator",(function(t,e){return t.loadAll=function(){return e.when()},t.addGroupNavigation=function(){return e.when()},t})).factory("c8yApiService",tt).factory("c8yDocs",et).service("c8yPasswordConfirm",nt),h.module("c8y.ui").provider("c8yNavigator",(function(){var t=new at,e=new n.Subject,r=[],i=e.pipe(o.merge(n.defer((function(){return n.of(t.children)}))));function a(n){(Array.isArray(n)?n:[n]).forEach((function(e){(function(t){return t.showIf||t.showIfPermissions||t.showIfContainsVisibleViews})(e)&&(e.hidden=void 0,r.push(e)),e.navNode=t.addRoot(e)})),e.next(t.children)}function s(n){var o=t.find((function(t){return t===n}));o&&(o.parents.forEach((function(t){return t.remove(o)})),e.next(t.children))}function u(e){return t.find(e)}return{$get:function(e,n){function o(t){var o=n.get("c8yUiUtil"),r=[],i=t.showIf,a=t.showIfPermissions,s=t.showIfContainsVisibleViews;i&&r.push(n.invoke(i)),s&&r.push(function(t){var o=n.get("c8yUiUtil"),r=n.get("c8yViews").getByPath(t.path);return e.all(c.map(r,(function(t){return o.configureVisibility(c.pick(t,["showIf","showIfPermissions"]),"show",!1).then(c.property("show"))}))).then(c.some)}(t)),o.configureVisibility({showIf:function(){return e.all(r).then(c.every)},showIfPermissions:a},"visible").then((function(e){e.visible?t.navNode.update({hidden:!1,showIf:null,showIfPermission:null,showIfContainsVisibleViews:null}):t.navNode.update({hidden:!0})}))}return(setTimeout((function(){return r.forEach(o)})),{rootNodes:function(){return t.children},findNode:u,addNavigation:a,removeNavigation:s,rootNodes$:i})},addNavigation:a,removeNavigation:s}})).provider("c8yViews",(function(t,o,r){var i={},a=new n.ReplaySubject;return{when:s,$get:function(){return{contextViews:a,when:function(t,e){return s(t,e,!0)},getByPath:u,prefixWithSlash:d}}};function s(n,s,u){var h=d(n);s.resolve=s.resolve||{},s.resolve.__c8y_locales=["c8yLocales",function(t){return t.initDone}];var l=i[h],f=h;s.name,l||(i[h]=[],l=i[h]);var g=Object.keys(e.ViewContext).map((function(t){return{key:t,isUpgrade:d(e.ViewContext[t].replace("id",m[t]))===n}})).find((function(t){return t.isUpgrade}));if(g){l.push(s),s.path=h;var v=r.appendSegment(f.replace(n,""),s.name);a.next(y({},s,{path:s.name?v.substring(1):"",contextKey:g.key,runPhase:u})),s.showIf=void 0,s.name&&(s.path=r.appendSegment(f,s.name))}else{if(1===l.length){var b=C(l,1)[0];b.path=r.appendSegment(f,b.name),b.tab=p(f,b),t.when(b.path,b)}l.push(s),s.path=h,l.length>1&&(s.path=r.appendSegment(f,s.name),p(f,s),t.when(d(f),{resolveRedirectTo:function(t,e,n,r,i){var a=o.sortTabsViews(l,i),s=t.current.pathParams;return e.all(c.map(a,c.unary(n.configureVisibility))).then((function(t){var e=c.find(t,"show").path;return c.forEach(s,(function(t,n){e=e.replace(":"+n,t)})),r.redirectedViewPath=e,e}))}}))}return t.when(d(s.path),s)}function u(t){return i[d(t)]}function p(t,e){o.addTab(t,e)}function d(t){return(c.startsWith(t,"/")?"":"/")+t}})).directive("c8yUserTotpRevoke",K).directive("c8yAppLogsAutoRefresh",G).directive("c8yImpactProviderSettings",F).directive("c8yDataGrid",W).factory("c8yTranslate",ot).decorator("gettextCatalog",(function(t,e,n){var o=t,r=h.bind(o,o.getString);return o.getString=function(t,o,i){if("string"==typeof t){var a=r(t,o,i),c=o?e(t)(o):t,s=a;if(a&&a===c)s=n.instant(c);return s}return t},o})).factory("c8yServerMessages",rt).factory("ngZone",d.downgradeInjectable(a.NgZone));var st=["app","c8y.upgrade"],ut=function(){function t(){this.ng1Modules=st}return t.prototype.ngDoBootstrap=function(){window.bootstrap(),this.upgrade.bootstrap(document.getElementById("app"),this.ng1Modules,{strictDi:!1})},t}(),pt=[{path:"**",component:e.EmptyComponent}];t.BridgeService=x,t.DashboardBridgeService=k,t.DashboardUpgradeModule=q,t.HybridAppModule=ut,t.UPGRADE_ROUTES=pt,t.UpgradeModule=P,t.ng1Modules=st,t.ɵa=j,t.ɵb=T,t.ɵc=H,t.ɵd=$,t.ɵe=R,t.ɵf=I,t.ɵg=A,t.ɵh=O,t.ɵi=D,t.ɵj=N,t.ɵk=B,t.ɵl=E,t.ɵm=U,t.ɵn=V,t.ɵo=_,t.ɵp=M,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-upgrade.umd.min.js.map