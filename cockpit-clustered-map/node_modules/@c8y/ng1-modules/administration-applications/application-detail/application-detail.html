<c8y-breadcrumbs-set>
  <c8y-breadcrumbs-item path="#{{vm.basePath}}"
    label="{{vm.breadcrumbsLabel() | translate}}"
    icon="c8y-modules"></c8y-breadcrumbs-item>
</c8y-breadcrumbs-set>

<div class="row">
  <form name="vm.applicationForm"
    novalidate
    class="col-md-8 col-sm-12 col-lg-6">
    <div class="card">
      <div class="card-block">
        <div class="row">
          <div class="col-sm-5">
            <div class="form-group">
              <label>{{'ID' | translate}}</label>
              <input type="text"
                ng-model="vm.application.id"
                class="disabled form-control"
                disabled>
            </div>
          </div>
          <div class="col-sm-7">
            <div class="form-group"
              ng-class="{'has-error': vm.invalid('name')}">
              <label>{{'Name' | translate}}</label>
              <input
                ng-disabled="vm.application.type === 'MICROSERVICE'"
                type="text"
                ng-model="vm.application.name"
                name="name"
                placeholder="{{'e.g. My application' | translate}}"
                ng-readonly="vm.isPlatformApplicationBasePath()"
                required
                ng-maxlength="120"
                class="form-control"
                uib-tooltip="{{vm.validationHints('name')}}">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-5">
            <div class="form-group"
              ng-class="{'has-error': vm.invalid('key')}">
              <label>{{'Application key' | translate}}</label>
              <input type="text"
                name="key"
                class="form-control"
                ng-model="vm.application.key"
                ng-maxlength="120"
                ng-readonly="vm.application.id || vm.isPlatformApplicationBasePath()"
                placeholder="{{'e.g. my-application-key' | translate}}"
                required
                uib-tooltip="{{vm.validationHints('key')}}">
            </div>
          </div>

          <div class="col-sm-7">
            <div class="form-group">
              <label>{{'Type' | translate}}</label>
              <div>
                <div ng-if="vm.application.id">
                  <p class="form-control-static">
                    <i c8y-icon="{{vm.icon(vm.application)}}"></i>
                    <span ng-bind="vm.typeLabel(vm.application) | translate" />
                  </p>
                </div>

                <div class="btn-group"
                  ng-show="vm.isNew">
                  <button type="button"
                    class="btn btn-default btn-sm"
                    ng-model="vm.application.type"
                    uib-btn-radio="'HOSTED'">
                    <i c8y-icon="cloud"></i>
                    <span ng-bind="vm.typeLabel('HOSTED') | translate" />
                  </button>
                  <button type="button"
                    class="btn btn-default btn-sm"
                    ng-model="vm.application.type"
                    uib-btn-radio="'REPOSITORY'">
                    <i c8y-icon="bitbucket"></i>
                    <span ng-bind="vm.typeLabel('REPOSITORY') | translate" />
                  </button>
                  <button type="button"
                    class="btn btn-default btn-sm"
                    ng-model="vm.application.type"
                    uib-btn-radio="'EXTERNAL'">
                    <i c8y-icon="external-link-square"></i>
                    <span ng-bind="vm.typeLabel('EXTERNAL') | translate" />
                  </button>
                  <button type="button"
                    class="btn btn-default btn-sm"
                    ng-model="vm.application.type"
                    uib-btn-radio="'MICROSERVICE'">
                    <i c8y-icon="microchip"></i>
                    <span ng-bind="vm.typeLabel('MICROSERVICE') | translate" />
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div ng-switch="vm.application.type">
          <div ng-switch-when="HOSTED">
            <div class="form-group"
              ng-class="{'has-error': vm.invalid('contextPath')}">
              <label>{{'Path' | translate}}</label>
              <div class="input-group">
                <span class="input-group-addon">{{host}}/apps/</span>
                <input type="text"
                  name="contextPath"
                  class="form-control"
                  ng-model="vm.application.contextPath"
                  placeholder="{{'e.g. my-application' | translate}}"
                  required
                  ng-readonly="vm.application.id || vm.isPlatformApplicationBasePath()"
                  ng-maxlength="120"
                  uib-tooltip="{{vm.validationHints('contextPath')}}">
              </div>
            </div>

            <div class="form-group"
              ng-class="{'has-error': vm.invalid('contextPath')}">
              <label>{{'Description' | translate}}</label>
              <input type="text"
                name="description"
                class="form-control"
                ng-model="vm.application.description"
                placeholder="{{'e.g. Application to manage devices' | translate}}"
                ng-maxlength="200"
                uib-tooltip="{{vm.validationHints('description')}}">
            </div>

            <div class="form-group"
              ng-class="{'has-error': vm.invalid('resourcesUrl')}"
              ng-if="vm.isNew">
              <label>{{'Archive' | translate}}</label>
              <i c8y-icon="question-circle"
                uib-tooltip="{{'Compressed files must have an index.html at root. URLs in the web application can be relative.' | translate}}"></i>
              <div class="input-group">
                <input type="text"
                  readonly
                  required
                  class="form-control"
                  ng-model="vm.file.name"
                  placeholder="{{'Select file' | translate}}">
                <span class="input-group-btn">
                  <button class="btn btn-primary" ng-file-select="vm.onFileSelect($files)">
                    <span><i c8y-icon="upload"></i></span>
                </button>
                </span>
              </div>
            </div>
          </div>

          <div ng-switch-when="MICROSERVICE">
            <div class="form-group"
                 ng-class="{'has-error': vm.invalid('contextPath')}">
              <label>{{'Path' | translate}}</label>
              <div class="input-group">
                <span class="input-group-addon">{{vm.host}}/service/</span>
                <input type="text"
                       name="contextPath"
                       class="form-control"
                       ng-model="vm.application.contextPath"
                       placeholder="{{'e.g. my-service' | translate}}"
                       required
                       ng-readonly="vm.application.id || vm.isPlatformApplicationBasePath()"
                       ng-maxlength="120"
                       uib-tooltip="{{vm.validationHints('contextPath')}}">
              </div>
            </div>

            <ul class="list-inline">
              <li ng-if="vm.application.manifest.version">
                <div class="form-group">
                  <label translate>Version</label>
                  <p class="form-control-static"> {{vm.application.manifest.version}}</p>
                </div>
              </li>
              <li ng-if="vm.application.manifest.isolation">
                <div class="form-group">
                  <label translate>Isolation</label>
                  <p class="form-control-static">
                    <span ng-show="vm.singleTenant">
                      <i c8y-icon="c8y-enterprise" class="c8y-icon-duocolor h4"></i> {{'Single tenant' | translate}}
                    </span>
                    <span ng-show="!vm.singleTenant">
                      <i c8y-icon="c8y-sub-tenants" class="c8y-icon-duocolor h4"></i> {{'Multi tenant' | translate}}
                    </span>
                  </p>
                </div>
              </li>
              <li ng-if="vm.application.manifest.isolation">
                <div class="form-group">
                  <label translate>Billing mode</label>
                  <p class="form-control-static">
                    <span ng-show="vm.subscription" uib-tooltip="{{'Resources usage assigned to: Owner' | translate}}" tooltip-placement="right">
                      {{'Subscription' | translate}}
                    </span>
                    <span ng-show="!vm.subscription && vm.singleTenant" uib-tooltip="{{'Resources usage assigned to: Subscriber | translate'}}" tooltip-placement="right">
                      {{'Resources' | translate}}
                    </span>
                    <span ng-show="!vm.subscription && !vm.singleTenant" uib-tooltip="{{'Resources usage assigned to: Owner' | translate}}" tooltip-placement="right">
                      {{'Resources' | translate}}
                    </span>
                  </p>
                </div>
              </li>
            </ul>

            <div class="legend form-block top-m-xxl" ng-if="vm.application.manifest.provider">{{'Provider' | translate}}</div>
            <ul class="list-inline">
              <li ng-if="vm.application.manifest.provider.name">
                <div class="form-group">
                  <label translate>Name</label>
                  <p class="form-control-static"> {{vm.application.manifest.provider.name}}</p>
                </div>
              </li>
              <li ng-if="vm.application.manifest.provider.domain">
                <div class="form-group">
                  <label translate>Domain</label>
                  <p class="form-control-static">{{vm.application.manifest.provider.domain}}</p>
                </div>
              </li>
              <li ng-if="vm.application.manifest.provider.support">
                <div class="form-group">
                  <label translate>Support</label>
                  <p class="form-control-static">{{vm.application.manifest.provider.support}}</p>
                </div>
              </li>
            </ul>
          </div>

          <div ng-switch-when="REPOSITORY">
            <div class="form-group"
              ng-class="{'has-error': vm.invalid('contextPath')}">
              <label>{{'Path' | translate}}</label>
              <div class="input-group">
                <span class="input-group-addon">{{vm.host}}/apps/</span>
                <input type="text"
                  name="contextPath"
                  class="form-control"
                  ng-model="vm.application.contextPath"
                  placeholder="{{'e.g. my-application' | translate}}"
                  required
                  ng-readonly="vm.application.id || vm.isPlatformApplicationBasePath()"
                  ng-maxlength="120"
                  uib-tooltip="{{vm.validationHints('contextPath')}}">
              </div>
            </div>

            <div class="form-group"
              ng-class="{'has-error': vm.invalid('resourcesUrl')}">
              <label>{{'Server URL' | translate}}</label>
              <input type="url"
                name="resourcesUrl"
                class="form-control"
                ng-model="vm.application.resourcesUrl"
                uib-tooltip="{{vm.validationHints('resourcesUrl')}}"
                placeholder="{{'e.g.' | translate}} /"
                required>
            </div>

            <div class="form-group">
              <label translate>Username</label>
              <input type="text"
                class="form-control"
                ng-model="vm.application.resourcesUsername"
                c8y-autocomplete="off">
            </div>

            <div class="form-group">
              <label translate>Password</label>
              <input type="text"
                class="form-control"
                ng-model="vm.application.resourcesPassword"
                c8y-autocomplete="off">
            </div>

          </div>

          <div ng-switch-when="EXTERNAL">

            <div class="form-group"
              ng-class="{'has-error': vm.invalid('externalUrl')}">
              <label>{{'External URL' | translate}}</label>
              <input
                name="externalUrl"
                type="url"
                ng-pattern="/^(?!javascript:).+/"
                class="form-control"
                ng-model="vm.application.externalUrl"
                placeholder="{{'e.g.' | translate}} http://www.example.com/"
                uib-tooltip="{{vm.validationHints('externalUrl')}}"
                required>
            </div>

          </div>

        </div>
      </div>
      <div class="card-footer separator">
        <button 
          title="{{ 'Save' | translate }}" 
          class="btn btn-primary btn-form"
          ng-click="vm.save(vm.application)"
          ng-show="vm.application && !vm.isPlatformApplicationBasePath()"
          ng-disabled="!vm.application.type || vm.applicationForm.$invalid || vm.applicationForm.$pristine"
          translate>
          Save
        </button>
      </div>
    </div>
    <!-- /.card -->
  </form>
</div>
