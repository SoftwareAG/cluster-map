"use strict";function asyncGeneratorStep(e,t,r,n,i,a,s){try{var c=e[a](s),o=c.value}catch(e){return void r(e)}c.done?t(o):Promise.resolve(o).then(n,i)}function _asyncToGenerator(c){return function(){var e=this,s=arguments;return new Promise(function(t,r){var n=c.apply(e,s);function i(e){asyncGeneratorStep(n,t,r,i,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,i,a,"throw",e)}i(void 0)})}}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(){e.$inject=["c8yDeviceTypeProtocolBaseProvider","c8yDeviceProtocolUiProvider","c8yViewsProvider","gettext"];var i="c8yProfibusDevice";function e(e,t,r,l){n.$inject=["c8yDeviceDatabase","c8yDeviceControl","c8yModbusDevice","gettextCatalog","c8yDevices","c8yBase","c8yUser","$q"];var v={label:l("Profibus"),fieldbusType:"profibus",serviceName:i};return e.getDeviceTypeProtocolProvider(v,n);function n(e,p,f,t,o,u,a,y){var r=_objectSpread({},v,{discreteOutputs:!1,discreteInputs:!1,holdingRegisters:{sectionTitle:l("Registers"),noRegistersDefinedMessage:l("No registers defined."),elementTypeLabel:l("Register"),newRegisterModalTitle:l("New register"),editRegisterModalTitle:l('Edit register: "{{name}}"'),addRegisterButtonLabel:l("Add register"),validation:{invalidName:l("Name must be unique among registers."),invalidMeasurement:l("Selected measurement type and series are already used by another register.")},number:!0,startBit:{max:63},noBits:{max:64},multiplier:{min:1,step:1},divisor:!0,decimalPlaces:!0,unit:!0,options:{signed:!0,enumType:!0},functionalities:{readWriteMutex:!0,sendMeasurement:!0,raiseAlarm:!0,sendEvent:!0}},inputRegisters:!1,options:{serverTime:!0},deviceFragments:["c8y_ProfibusDevice"],deviceConfiguration:{fragment:"c8y_ProfibusConfiguration",icon:"ravelry"}});return{registerFeaturesManifest:function(){e.registerFeaturesManifest(n().then(function(e){return e&&r}))},updateElement:function(e,t,r){return c.apply(this,arguments)},isAvailable:n,create:function(e,t){return i.apply(this,arguments)}};function n(){return e.isFeatureFieldbus4Available()}function i(){return(i=_asyncToGenerator(regeneratorRuntime.mark(function e(i,a){var s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(a);case 2:return s=e.sent,e.t0=u,e.next=6,o.createConfirm(s);case 6:return e.t1=e.sent,c=e.t0.getResData.call(e.t0,e.t1),e.next=10,o.addChildDevice(i,c);case 10:return c.owner=i.owner,e.next=13,o.save(c);case 13:return e.abrupt("return",p.create((t=i,r=c,n=a.deviceType,{deviceId:t.id,description:'Added new child device to "'.concat(t.name,'" (ID: ').concat(t.id,")."),c8y_ProfibusDevice:{id:r.id,name:r.name,type:"/inventory/managedObjects/".concat(n.id)}})));case 14:case"end":return e.stop()}var t,r,n},e)}))).apply(this,arguments)}function d(e){return s.apply(this,arguments)}function s(){return(s=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.deviceType,e.next=3,a.current();case 3:return i=e.sent,e.abrupt("return",{name:r,type:n.name,c8y_ProfibusDevice:{type:"/inventory/managedObjects/".concat(n.id)},owner:i.id});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function c(){return(c=_asyncToGenerator(regeneratorRuntime.mark(function e(c,o,u){var d,l,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.canUpdateElement(c,o))return void 0,r=(t={device:c,register:o,valueMap:u}).device,n=t.register,i=t.valueMap,a=i.label||i.value,s=!i.label&&n.unit?" ".concat(n.unit):"",d={deviceId:r.id,description:'Change value of "'.concat(n.name,'" to ').concat(a).concat(s,"."),c8y_SetRegister:{address:r.c8y_RegisterStatus.ProfibusSlave_Address,register:n.number,startBit:n.startBit,noBits:n.noBits,value:i.value}},o.changePending=!0,l=f.getAlertMessagesFns(o,u),e.next=6,f.sendOperationAndGetResult(d,l);e.next=9;break;case 6:return(v=e.sent).status===p.status.SUCCESSFUL?(_.set(c,["c8y_RegisterStatus",o.name],u.value),o.changePending=!1):v.status===p.status.FAILED&&(o.changePending=!1),e.abrupt("return",v);case 9:return e.abrupt("return",y.reject());case 10:case"end":return e.stop()}var t,r,n,i,a,s},e)}))).apply(this,arguments)}}}angular.module("c8y.profibus").provider(i,e)}();