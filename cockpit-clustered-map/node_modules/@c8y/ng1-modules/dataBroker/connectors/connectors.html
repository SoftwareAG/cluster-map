<c8y-ui-title-set title="'Data connectors' | translate"> </c8y-ui-title-set>

<c8y-ui-action-bar-set>
  <a
    title="{{ 'Add data connector' | translate }}"
    ng-href="#{{ vm.ROUTE_NEW_CONNECTOR }}"
    class="btn btn-link"
  >
    <i c8y-icon="plus-circle"></i> {{ 'Add data connector' | translate }}
  </a>
  <button
    title="{{ 'Reload' | translate }}"
    type="button"
    class="btn btn-link"
    ng-click="vm.reload()"
  >
    <i c8y-icon="refresh"></i> {{ 'Reload' | translate }}
  </button>
</c8y-ui-action-bar-set>

<div
  class="c8y-empty-state text-center"
  ng-if="vm.connectors.length === 0"
  style="margin-top: 30px;"
>
  <h1 c8y-icon="c8y-connector-out c8y-icon-duocolor"></h1>
  <h3 translate>No data connectors to display.</h3>
  <p translate>Add your first data connector by clicking below.</p>
  <a
    title="{{ 'Add data connector' | translate }}"
    ng-href="#{{ vm.ROUTE_NEW_CONNECTOR }}"
    class="btn btn-primary"
  >
    {{ 'Add data connector' | translate }}
  </a>
  <p class="top-m-xs" c8y-guide-docs>
    <small
      ><span translate
        >Find out more in the
        <a c8y-guide-href="users-guide/getting-started/">User guide`KEEP_ORIGINAL`</a>.</span
      ></small
    >
  </p>
</div>

<div class="card-group interact-grid">
  <div
    ng-if="vm.connectors.length > 0"
    ng-repeat="connector in vm.connectors |orderBy:'name'"
    class="col-xs-12 col-sm-4 col-md-3"
  >
    <div class="card">
      <div class="card-actions">
        <div class="dropdown settings" uib-dropdown>
          <a
            title="{{ 'Actions' | translate }}"
            class="dropdown-toggle c8y-dropdown"
            uib-dropdown-toggle
            ng-click="::$event.stopPropagation()"
          >
            <span><i c8y-icon="ellipsis-v"></i></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
            <li>
              <a
                title="{{ 'Edit' | translate }}"
                href=""
                ng-click="::$event.stopPropagation();vm.editConnector(connector.id)"
              >
                <i c8y-icon="edit"></i> <translate>Edit</translate>
              </a>
            </li>
            <li>
              <a
                title="{{ 'Duplicate' | translate }}"
                href=""
                ng-click="::$event.stopPropagation();vm.duplicateConnector(connector)"
              >
                <i c8y-icon="clone"></i> <translate>Duplicate</translate>
              </a>
            </li>
            <li>
              <a
                title="{{ 'Delete' | translate }}"
                href=""
                ng-click="::$event.stopPropagation();vm.deleteConnector(connector)"
              >
                <i c8y-icon="trash"></i> <translate>Delete</translate>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div
        class="card-header"
        ng-click="vm.editConnector(connector.id)"
        ng-init="waitingStatus = vm.MAPPED_STATUS.WAITING; activatingStatus = vm.MAPPED_STATUS.ACTIVATING;"
      >
        <div class="card-icon" style="align-self: flex-start;">
          <i c8y-icon="c8y-connector-out c8y-icon-duocolor"></i>
        </div>
        <h4 class="text-truncate card-title" title="{{ connector.name }}">
          {{ connector.name }}<br />
          <small class="text-truncate text-muted" title="{{ connector.instanceUrl }}">
            {{ connector.instanceUrl }}
          </small>
        </h4>
      </div>
      <hr />
      <div class="card-block">
        <span class="text-truncate-wrap">{{ connector.description }}</span>

        <div class="row">
          <div class="col-xs-8">
            <div
              class="status-toggle"
              ng-if="connector.visibleStatus.value === waitingStatus.value"
              style="line-height: 34px;"
            >
              <i c8y-icon="circle-o-notch" class="fa-spin text-warning"></i>
              <span class="text-warning">{{ waitingStatus.label | translate }}</span>
              <a
                href=""
                uib-tooltip="{{ 'The target URL did not accept the connection yet.' | translate }}"
                tooltip-append-to-body="true"
              >
                <i c8y-icon="question-circle-o"></i>
              </a>
            </div>

            <div
              class="status-toggle"
              ng-if="connector.visibleStatus.value === activatingStatus.value"
              style="line-height: 34px;"
            >
              <i c8y-icon="circle-o-notch" class="fa-spin text-warning"></i>
              <span class="text-warning">{{ activatingStatus.label | translate }}</span>
              <a
                href=""
                uib-tooltip="{{ vm.getStatusTooltip(connector) | translate }}"
                tooltip-append-to-body="true"
              >
                <i c8y-icon="question-circle-o"></i>
              </a>
            </div>

            <div
              class="status-toggle"
              ng-if="connector.visibleStatus.value !== waitingStatus.value && connector.visibleStatus.value !== activatingStatus.value"
              ng-click="vm.toggleConnectorStatus($event, connector)"
              style="height: 34px;"
            >
              <label class="c8y-switch">
                <input
                  type="checkbox"
                  ng-checked="connector.visibleStatus.value === vm.MAPPED_STATUS.ACTIVE.value || connector.visibleStatus.value === vm.MAPPED_STATUS.PENDING.value"
                />
                <span></span>
                <span>{{ connector.visibleStatus.label | translate }}</span>
              </label>
              <a
                href=""
                uib-tooltip="{{ vm.getStatusTooltip(connector) | translate }}"
                tooltip-append-to-body="true"
              >
                <i c8y-icon="question-circle-o"></i>
              </a>
            </div>
          </div>

          <div class="col-xs-4">
            <div class="text-right" style="line-height: 34px;">
              <span translate>Filters</span>
              <span
                class="badge bg-primary"
                ng-bind="::(connector.filters && connector.filters.length || 0)"
              ></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
