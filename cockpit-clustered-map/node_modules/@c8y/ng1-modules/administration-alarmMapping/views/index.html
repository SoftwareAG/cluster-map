<div data-ng-controller="alarmMappingCtrl as vm">
  <c8y-ui-action-bar-set>
    <li>
      <div class="dropdown" uib-dropdown auto-close="outsideClick" is-open="status.isOpen">
        <button
          title="{{ 'Add alarm mapping' | translate }}"
          class="dropdown-toggle c8y-dropdown"
          uib-dropdown-toggle
          aria-haspopup="true"
          aria-expanded="false"
        >
          <span><i c8y-icon="plus-circle"></i> <translate>Add alarm mapping</translate></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
          <li class="dropdown-form">
            <form role="form" name="newOptionForm" class="panel-body" novalidate>
              <div class="form-group">
                <label
                  class="text-truncate"
                  translate
                  title="{{ 'Alarm type to match' | translate }}"
                  >Alarm type to match</label
                >
                <input
                  type="text"
                  class="form-control"
                  ng-model="vm.newOption.key"
                  placeholder="{{ 'e.g.' | translate }} c8y_Alarm"
                  required
                />
              </div>
              <div class="form-group">
                <label translate class="text-truncate" title="{{ 'New description' | translate }}"
                  >New description</label
                >
                <input type="text" class="form-control" ng-model="vm.newOption.description" />
              </div>
              <div class="form-group">
                <label translate class="test-truncate" title="{{ 'New severity' | translate }}"
                  >New severity</label
                >
                <label ng-repeat="severity in vm.severities.values()" class="c8y-radio input-sm">
                  <input
                    type="radio"
                    name="c8y-group"
                    value="{{ severity.value }}"
                    ng-model="vm.newOption.severity"
                    ng-class="{'active': vm.newOption.severity === severity.value}"
                  />
                  <span></span>
                  <i
                    c8y-icon="{{ severity.icon }}"
                    ng-class="severity.class"
                    style="font-size: 14px;"
                  >
                  </i>
                  <span
                    title="{{ severity.label | translate }}"
                    ng-bind="severity.label | translate"
                  ></span>
                </label>
              </div>
              <button
                title="{{ 'Add alarm mapping' | translate }}"
                class="btn btn-primary"
                ng-click="save(vm.newOption)"
                ng-disabled="newOptionForm.$invalid"
                translate
              >
                Add alarm mapping
              </button>
            </form>
          </li>
        </ul>
      </div>
    </li>

    <c8y-refresh-btn></c8y-refresh-btn>
  </c8y-ui-action-bar-set>

  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <div class="card">
        <div class="card-header hidden-sm hidden-xs">
          <h4 class="card-title" translate>Alarm mapping</h4>
        </div>
        <hr class="hidden-sm hidden-xs" />
        <div class="card-block">
          <p style="white-space: pre-wrap;">{{ helpText | translate }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-9 col-md-pull-3">
      <div class="c8y-empty-state text-center" ng-show="options.length == 0">
        <h1 c8y-icon="bell"></h1>
        <h3 translate>There are no alarm mappings defined</h3>
        <p translate>Add your first alarm mapping using the button on the toolbar.</p>
        <p c8y-guide-docs>
          <small translate
            >Find out more in the
            <a c8y-guide-href="users-guide/administration/#reprio-alarms"
              >User guide`KEEP_ORIGINAL`</a
            >.</small
          >
        </p>
      </div>
      <div class="list-group">
        <div
          ng-repeat="option in options | orderBy:'key'"
          class="list-group-item flex-row collapsible"
          ng-class="{'expanded': isDetailExpanded}"
        >
          <div class="list-item-actions">
            <button
              type="button"
              title="{{ 'Expand' | translate }}"
              class="collapse-btn"
              ng-click="isDetailExpanded = !isDetailExpanded"
            >
              <i c8y-icon="chevron-down"></i>
            </button>
          </div>

          <div class="list-item-icon">
            <i
              c8y-icon="{{ icon(option.severity) }}"
              class="status"
              ng-class="iconClass(option.severity)|lowercase"
              uib-tooltip="{{ option.severity | translate }}"
            ></i>
          </div>

          <div class="list-item-body" ng-click="isDetailExpanded = !isDetailExpanded">
            <div class="row">
              <div class="col-sm-10 col-xs-12">
                <span ng-click="isDetailExpanded = !isDetailExpanded">{{ option.key }}</span>
                <small
                  class="text-muted"
                  ng-if="option.description"
                  ng-bind="option.description"
                ></small>
                <small
                  class="text-muted"
                  ng-if="!option.description"
                  ng-bind="'<kept as is>' | translate"
                ></small>
              </div>
              <div class="col-sm-2 text-right showOnHover hidden-xs">
                <button
                  class="btn btn-danger btn-xs"
                  ng-click="onClickDelete(option)"
                  title="{{ 'Delete' | translate }}"
                >
                  <i c8y-icon="trash"></i>
                </button>
              </div>
            </div>
          </div>

          <div
            class="collapse"
            uib-collapse="!isDetailExpanded"
            data-ng-init="optionToEdit = getOptionCopy(option)"
          >
            <form role="form" name="optionForm" novalidate>
              <div class="row">
                <div class="form-group col-lg-3">
                  <label
                    class="text-truncate"
                    translate
                    title="{{ 'Alarm type to match' | translate }}"
                    >Alarm type to match</label
                  >
                  <input type="text" class="form-control" ng-model="optionToEdit.key" disabled />
                </div>
                <div class="form-group col-lg-3">
                  <label class="text-truncate" translate title="{{ 'New description' | translate }}"
                    >New description</label
                  >
                  <input type="text" class="form-control" ng-model="optionToEdit.description" />
                </div>
                <div class="form-group col-lg-6">
                  <label class="text-truncate" translate title="{{ 'New severity' | translate }}"
                    >New severity</label
                  >
                  <div class="flex-row-sm wrap">
                    <label
                      ng-repeat="severity in severities.values()"
                      class="c8y-radio input-sm"
                      ng-class="{'right-m-sm': !$last}"
                    >
                      <input
                        type="radio"
                        name="c8y-group"
                        value="{{ severity.value }}"
                        ng-model="optionToEdit.severity"
                        ng-class="{'active': optionToEdit.severity === severity.value}"
                      />
                      <span></span>
                      <i
                        c8y-icon="{{ severity.icon }}"
                        ng-class="severity.class"
                        style="font-size: 14px;"
                      >
                      </i>
                      <span
                        title="{{ severity.label | translate }}"
                        ng-bind="severity.label | translate"
                      ></span>
                    </label>
                  </div>
                </div>
              </div>
              <button
                title="{{ 'Delete' | translate }}"
                class="btn btn-danger visible-xs-inline-block"
                ng-click="onClickDelete(option)"
              >
                <i c8y-icon="trash"></i> {{ 'Delete' | translate }}
              </button>
              <button
                title="{{ 'Save' | translate }}"
                class="btn btn-primary"
                ng-click="save(optionToEdit)"
                ng-disabled="optionForm.$invalid || optionForm.$pristine"
                style="margin-left:0;"
                translate
              >
                Save
              </button>
              <br />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
