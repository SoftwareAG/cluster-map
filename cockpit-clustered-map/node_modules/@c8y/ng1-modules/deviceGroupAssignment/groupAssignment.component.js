"use strict";!function(){function e(n,t,r,o,i,u,e,c,a,s,d,l,p,f){var g,h=this,v="c8y_DeviceGroup",m="c8y_IsDeviceGroup",y=[];function G(){return i.directParentAssets(g,v,m).then(A)}function A(e){h.currentGroups=e,i.clearBreadcrumbsCache(g),u.$emit("update")}function D(e){return e.id!==g}function w(e){y.length=0,e.forEach(function(e){y.push(e)})}function C(){return G().then(function(){return e.success(s("Device added to group"))})}_.assign(h,{group:{},$onInit:function(){if(!_.get(h.config,"device.id"))return;g=_.get(h.config,"device.id"),G(),t.all([o.list({type:v}),o.list({fragmentType:m})]).then(_.flattenDeep).then(function(e){return _.uniqBy(e,function(e){return e.id})}).then(function(e){return _.filter(e,D)}).then(w),d.hasAnyRole(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]).then(function(e){h.isCreateNewGroupAllowed=e})},availableGroups:y,searchGroupInHierarchy:function(){var e=n.$new();r({templateUrl:"core/ui/views/deviceDetailBasic/groupSelectModal.html",controller:"c8yGroupSelectModalCtrl",scope:e}).then(function(n){h.group.selected=_.find(y,function(e){return e.id===n.id})})},addToGroup:function(e){return function(e){return function(e){return!_.isUndefined(e.newGroup)}(e)?function(e){return r({title:s("Create new group and assign device"),body:p.getString('You are about to create a new group "{{name}}" and assign the device to it. Do you want to proceed?',{name:e}),labels:{ok:s("Create and assign")},status:"warning",size:"sm"}).then(function(){return function(e){return l.create(e).then(c.getResData)}({name:e})}).then(function(e){return function(e){f.addGroupNavigation(e)}(e),e})}(e.name):t.resolve(e)}(e).then(function(e){return function(t){return i.detailCached(g).then(function(e){var n=e.data;return o.addChildAsset(t,n)})}(e)}).then(C)},removeFromGroup:function(t){return i.detailCached(g).then(function(e){var n=e.data;return a.unassignDevice(t,n)}).then(G).then(function(){return e.success(s("Device removed from group."))})},isCreateNewGroupAllowed:!1})}function n(t,e,n,r,o){var i=[];function u(e){return n.detail(e).then(function(e){var n=e.data;return r.getGroupItems(n).then(function(e){t.items=e,i.push(n)})})}t.title=o("Select group"),t.drillDown=u,t.upToGroup=function(e){for(;i[i.length-1]!==e;)i.pop();i.pop(),u(e.id)},t.select=e.close,t.dismiss=e.dismiss,t.isGroup=r.isGroup,r.getTopLevelGroups().then(function(e){t.items=e}),t.breadcrumbs=i,t.currentManagedObjectId=t.device.id}e.$inject=["$scope","$q","c8yModal","c8yInventory","c8yDevices","c8yBreadcrumbs","c8yAlert","c8yBase","groupsHierarchySvc","gettext","c8yPermissions","c8yDeviceGroup","gettextCatalog","groupTypesHierarchyNavigator"],n.$inject=["$scope","$uibModalInstance","c8yInventory","c8yGroups","gettext"],angular.module("c8y.deviceGroupAssignment").controller("GroupSelectModalCtrl",n).component("groupAssignment",{controller:e,controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/groupAssignment.component.html",bindings:{config:"<"}})}();