<div ng-controller="trackingCtrl as ctrl">
  <c8y-ui-action-bar-set>
    <c8y-realtime-switch
      get-state="ctrl.map.state()"
      on-start="ctrl.map.startRt()"
      on-stop="ctrl.map.stopRt()"
    ></c8y-realtime-switch>

    <li class="navbar-form">
      <form class="form-inline">
        <div class="c8y-select-wrapper" ng-if="ctrl.showTrackingOptions">
          <select
            class="form-control"
            ng-model="ctrl.trackingOption"
            ng-change="ctrl.onTrackingOptionChange()"
          >
            <option value="all" translate>Show all data</option>
            <option value="gps" translate>Show GPS data only</option>
            <option value="gsm" translate>Show GSM data only</option>
          </select>
          <span></span>
        </div>
        <c8y-time-interval date-from="ctrl.dateFrom" date-to="ctrl.dateTo"></c8y-time-interval>
      </form>
    </li>
  </c8y-ui-action-bar-set>

  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div
          c8y-map-internal
          map="ctrl.map"
          marker-template="ctrl.markerTemplate"
          c8y-legend="ctrl.legend"
          device-id="ctrl.deviceId"
          style="margin-bottom:15px;height:500px; "
          realtime="ctrl.realtime"
        ></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title" translate>
            Tracking events
          </h4>
        </div>
        <hr />
        <div class="card-block" ng-show="ctrl.events().length == 0">
          <div class="c8y-empty-state text-left">
            <h1 class="c8y-icon c8y-icon-location c8y-icon-duocolor"></h1>
            <p>{{ 'No tracking events found' | translate }}</p>
          </div>
        </div>

        <div class="card-inner-scroll" style="max-height:400px;">
          <div class="list-group">
            <div
              class="list-group-item flex-row"
              ng-repeat="event in ctrl.events()"
              ng-class="{'text-info': !!ctrl.markers['p'+$index]}"
              ng-click="ctrl.toggle($index, event)"
            >
              <div class="list-item-icon">
                <i c8y-icon="c8y-location"></i>
              </div>
              <div class="list-item-body">
                {{ event.time | date: 'medium' }}
                <span ng-if="ctrl.eventText"><br />{{ event.text }}</span>
              </div>
            </div>
          </div>
          <a
            title="{{ 'Load more' | translate }}"
            href=""
            class="btn btn-link btn-block"
            ng-click="ctrl.loadMore()"
            ng-show="ctrl.hasLoadMore()"
            >{{ 'Load more' | translate }}</a
          >
        </div>
        <div class="card-footer" ng-show="ctrl.events().length">
          <button
            title="{{ 'Deselect all markers' | translate }}"
            type="button"
            class="btn btn-default"
            ng-click="ctrl.hideAll()"
          >
            {{ 'Deselect all markers' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
