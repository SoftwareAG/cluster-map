<c8y-breadcrumbs-set>
  <c8y-breadcrumbs-item
    path="#users"
    label="{{ 'Users' | translate }}"
    icon="c8y-user"
  ></c8y-breadcrumbs-item>
</c8y-breadcrumbs-set>

<div class="tab-content-spacer"></div>
<form name="forms.userForm" role="form" ng-submit="checkPassword(user)" novalidate>
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title" translate>Identification</h4>
        </div>
        <hr />
        <div class="card-block">
          <c8y-ui-edit-user
            user="user"
            forms="forms"
            password="password"
            disabled-edit="!canEditUser(currentUser, user) || hasExternalOrigin"
            hide-active="!canActivateUser(currentUser, user)"
            hide-owner="!vm.FEATURE_USER_HIERARCHY"
            hide-delegate="!vm.FEATURE_USER_HIERARCHY"
            hide-language="true"
          >
          </c8y-ui-edit-user>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title" translate>Global roles</h4>
        </div>
        <hr />
        <ul class="list-group">
          <li class="list-group-item item-list-row " ng-repeat="group in groups | orderBy: 'name'">
            <label
              ng-class="{'disabled': !canEditUserGroups(currentUser) || restrictedByOwner(group)}"
              class="c8y-checkbox text-center"
              style="min-width: 40px;"
            >
              <input
                type="checkbox"
                id="{{ 'groupcheckbox' + $index }}"
                ng-model="_groups[group.id]"
                ng-disabled="!canEditUserGroups(currentUser) || restrictedByOwner(group) || hasExternalOrigin"
              />
              <span></span>
            </label>
            <label
              title="{{ ::group.name | translate }}"
              for="{{ 'groupcheckbox' + $index }}"
              style="padding-right:32px"
            >
              {{::group.name | translate}}
              <a
                href=""
                class="pull-right text-warning"
                ng-show="restrictedByOwner(group)"
                popover-append-to-body="true"
                popover-trigger="'focus mouseenter'"
                popover-placement="auto"
                uib-popover="{{
                  'Only global roles defined on the owner can be defined on the owned user.'
                    | translate
                }}"
              >
                <i c8y-icon="exclamation-circle"></i>
              </a>
              <br /><small class="text-muted">{{::group.description | translate}}</small>
            </label>
          </li>
        </ul>

        <div ng-show="showAcl()">
          <div class="card-header">
            <h4 translate>User permissions</h4>
          </div>
          <div class="card-block">
            <c8y-acl-editor acl="user.devicePermissions"></c8y-acl-editor>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center page-footer">
    <c8y-ui-button-footer changed="forms.userForm.$dirty">
      <button
        title="{{ 'Cancel' | translate }}"
        type="button"
        ng-click="vm.cancel()"
        class="btn btn-default"
        translate
      >
        Cancel
      </button>
      <button
        title="{{ 'Save' | translate }}"
        ng-if="canEditUser(currentUser, user)"
        ng-class="{'btn-save': showPassword}"
        class="btn btn-primary"
        type="submit"
        ng-disabled="forms.userForm.$invalid || saving || !forms.userForm.$dirty"
        translate
      >
        Save
      </button>
    </c8y-ui-button-footer>
  </div>
</form>
