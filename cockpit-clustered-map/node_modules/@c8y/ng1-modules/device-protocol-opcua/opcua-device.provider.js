"use strict";function asyncGeneratorStep(e,t,r,n,a,i,c){try{var o=e[i](c),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,a)}function _asyncToGenerator(o){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=o.apply(e,c);function a(e){asyncGeneratorStep(n,t,r,a,i,"next",e)}function i(e){asyncGeneratorStep(n,t,r,a,i,"throw",e)}a(void 0)})}}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(){e.$inject=["c8yDeviceTypeProtocolBaseProvider","gettext"];var r="c8yOPCUADevice";function e(e,o){t.$inject=["c8yDeviceDatabase","c8yDeviceControl","gettextCatalog","c8yDevices","c8yBase","c8yUser"];var y={label:o("OPC UA legacy"),fieldbusType:"opcua",serviceName:r};return e.getDeviceTypeProtocolProvider(y,t);function t(e,s,t,u,d,a){var r=_objectSpread({},y,{options:!1,discreteOutputs:!1,discreteInputs:!1,holdingRegisters:{sectionTitle:o("Variables"),noRegistersDefinedMessage:o("No variables defined."),elementTypeLabel:o("Variable"),newRegisterModalTitle:o("New variable"),editRegisterModalTitle:o('Edit variable: "{{name}}"'),addRegisterButtonLabel:o("Add variable"),validation:{invalidName:o("Name must be unique among variables."),invalidMeasurement:o("Selected measurement type and series are already used by another variable.")},browsePath:!0,nodeType:!0,attributeType:!0,multiplier:{min:1,step:1},divisor:!0,decimalPlaces:!0,unit:!0,options:{signed:!0,enumType:!0},functionalities:{showStatus:!0,updateStatus:!0,sendMeasurement:!0,raiseAlarm:!0,sendEvent:!0}},inputRegisters:!1,deviceFragments:["c8y_OPCUADevice","c8y_OPCUAGateway"],deviceConfiguration:{fragment:"c8y_OPCUAGateway",icon:"cogs"}});return{registerFeaturesManifest:function(){e.registerFeaturesManifest(n().then(function(e){return e&&r}))},isAvailable:n,create:function(e,t){return i.apply(this,arguments)},isOpcua:function(e){return!!(e||{}).c8y_OPCUADevice}};function n(){return e.isFeatureFieldbus4Available()}function i(){return(i=_asyncToGenerator(regeneratorRuntime.mark(function e(a,i){var c,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(a,i);case 2:return c=e.sent,e.t0=d,e.next=6,u.createConfirm(c);case 6:return e.t1=e.sent,o=e.t0.getResData.call(e.t0,e.t1),e.next=10,u.addChildDevice(a,o);case 10:return o.owner=a.owner,e.next=13,u.save(o);case 13:return e.abrupt("return",s.create((t=a,r=i.deviceType,n=o,{deviceId:t.id,description:'Added new child device to "'.concat(t.name,'" (ID: ').concat(t.id,")."),c8y_OPCUADevice:{id:n.id,name:n.name,browsePath:n.c8y_OPCUADevice.browsePath,type:"/inventory/managedObjects/".concat(r.id)}})));case 14:case"end":return e.stop()}var t,r,n},e)}))).apply(this,arguments)}function l(e,t){return c.apply(this,arguments)}function c(){return(c=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.current();case 2:return n=e.sent,e.abrupt("return",{name:r.name,type:r.deviceType.name,c8y_OPCUADevice:{browsePath:r.directoryPath,type:"/inventory/managedObjects/".concat(r.deviceType.id)},owner:n.id});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}}}angular.module("c8y.opcua").provider(r,e)}();