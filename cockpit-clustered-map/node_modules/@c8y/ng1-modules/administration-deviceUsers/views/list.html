<div ng-controller="deviceUserListCtrl as vm">
  <c8y-ui-action-bar-set>
    <li class="navbar-form" action-bar-position="left">
      <form class="form-inline">
        <div class="form-group">
          <div title="{{ 'Filter' | translate }}…" class="input-group input-group-search">
            <input
              type="search"
              class="form-control"
              placeholder="{{ 'Filter' | translate }}…"
              ng-model="vm.filtering.filters.username"
            />
            <span class="input-group-addon">
              <i c8y-icon="search"></i>
            </span>
          </div>
        </div>

        <button
          type="button"
          class="btn btn-link"
          ng-click="vm.applyFilters()"
          title="{{ 'Apply filters' | translate }}"
        >
          <i c8y-icon="filter"></i>
          <span translate>Apply`filters`</span>
        </button>
        <button
          type="button"
          class="btn btn-link"
          ng-click="vm.clearFilters()"
          ng-show="vm.isAnyFilterSelected()"
          title="{{ 'Clear filters' | translate }}"
        >
          <i c8y-icon="times"></i>
          <span translate>Clear`filters`</span>
        </button>
      </form>
    </li>

    <c8y-refresh-btn></c8y-refresh-btn>
  </c8y-ui-action-bar-set>

  <div class="c8y-empty-state text-center" ng-show="!vm.filtering.applied && users.length === 0">
    <h1 c8y-icon="key"></h1>
    <h3 translate>There are no device credentials</h3>
    <p translate>Start by registering a device</p>
    <a href="/apps/devicemanagement/#/deviceregistration" class="btn btn-primary ng-scope">
      <i c8y-icon="c8y-device-connect"></i>
      <translate>Register device</translate>
    </a>
  </div>

  <div class="user-list-header user-list-row bottom-m-md" ng-show="users.length">
    <label class="col-username left-m-md" translate>Device user</label>
    <label class="col-globalroles" translate>Global roles</label>
    <div class="col-actions"></div>
  </div>

  <div class="user-list-row card" ng-if="vm.filtering.applied && users.length === 0">
    <div class="c8y-empty-state text-left">
      <h1 class="c8y-icon c8y-icon-device c8y-icon-duocolor"></h1>
      <p translate>
        Found no device users with names starting with
        <strong>{{::vm.filtering.filters.username}}</strong
        >.
      </p>
    </div>
  </div>

  <c8y-ui-title-set
    title="'Device credentials' | translate"
    subtitle="getSubtitle()"
  ></c8y-ui-title-set>

  <div class="user-list-row" ng-repeat="user in users" style="margin-top: 1px;">
    <div class="col-username text-truncate left-m-md" ng-click="navigateToDetail(user)">
      <i
        c8y-icon="c8y-device"
        style="font-size: 20px;"
        ng-class="{'text-gray-darker': user.enabled, 'text-muted': !user.enabled }"
        class="right-m-md"
      ></i>
      <span class="username text-truncate">
        <span
          title="{{::user.userName}}"
          class="h4"
          ng-class="{'text-muted': !user.enabled }"
          >{{::user.userName}}</span
        >
        <br ng-hide="user.enabled" /><small class="disabled" ng-hide="user.enabled" translate
          >Disabled</small
        >
      </span>
    </div>

    <div class="col-globalroles">
      <c8y-item-selector
        items="globalRolesAvailable(user)"
        items-selected="mapRolesForUser(user.groups.references)"
        on-apply="onChangeRoles(user, items)"
        text-apply="{{ 'Apply' | translate }}"
      >
      </c8y-item-selector>
    </div>

    <div class="col-actions">
      <div class="dropdown" uib-dropdown dropdown-append-to-body>
        <a
          title="{{ 'Actions' | translate }}"
          class="dropdown-toggle c8y-dropdown"
          uib-dropdown-toggle
          ng-click="::$event.stopPropagation()"
        >
          <span><i c8y-icon="ellipsis-v"></i></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
          <li>
            <a title="{{ 'Edit' | translate }}" href="" ng-click="navigateToDetail(user)">
              <i c8y-icon="edit"></i> <translate>Edit</translate>
            </a>
          </li>
          <li ng-show="user.enabled">
            <a title="{{ 'Disable' | translate }}" href="" ng-click="deactivate(user)">
              <i c8y-icon="ban"></i> <translate>Disable</translate>
            </a>
          </li>
          <li ng-hide="user.enabled">
            <a title="{{ 'Enable' | translate }}" href="" ng-click="activate(user)">
              <i c8y-icon="check-circle-o"></i> <translate>Enable</translate>
            </a>
          </li>
          <li>
            <a title="{{ 'Delete' | translate }}" href="" ng-click="onClickDelete(user)">
              <i c8y-icon="trash"></i> <translate>Delete</translate>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <c8y-load-more change-page-size></c8y-load-more>
</div>
