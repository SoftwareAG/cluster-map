"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function asyncGeneratorStep(e,n,r,t,i,o,a){try{var c=e[o](a),u=c.value}catch(e){return void r(e)}c.done?n(u):Promise.resolve(u).then(t,i)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(n,r){var t=c.apply(e,a);function i(e){asyncGeneratorStep(t,n,r,i,o,"next",e)}function o(e){asyncGeneratorStep(t,n,r,i,o,"throw",e)}i(void 0)})}}!function(){function e(e,a,c,n,r,t,i){var o=this,u={predefined:{info:null,deviceType:null},custom:{file:null,deviceType:null},newName:{value:null,edited:!1}};function d(){return(d=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=_toConsumableArray(o.predefinedDeviceTypeInfos),e.t2=_toConsumableArray,e.next=5,c.getPredefinedDeviceTypeInfos();case 5:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),o.predefinedDeviceTypeInfos=e.t0.concat.call(e.t0,e.t1,e.t4),a.$apply();case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l(){return(l=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var r,t,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,t=n.name,i=n.fieldbusType,p(),e.next=4,c.getPredefinedDeviceType(r);case 4:o=e.sent,f(n,o),s(t,i),a.$apply();case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e,n){u.predefined.info=e,u.predefined.deviceType=n}function p(){u.custom.file=null,u.custom.deviceType=null}function s(e,n){u.newName.edited||(u.newName.value=e),u.fieldbusType=n}function y(e){o.customDeviceTypeFeedback=e}_.assign(o,{$onInit:function(){return d.apply(this,arguments)},selection:u,predefinedDeviceTypeInfos:[],downloadPredefinedDeviceType:function(e){return c.downloadPredefinedDeviceTypeAndSaveAs(e.id)},onPredefinedDeviceTypeInfoSelected:function(e){return l.apply(this,arguments)},isPredefinedDeviceTypeInfoSelected:function(e){return u.predefined.info===e},onCustomDeviceTypeFileSelected:function(e){if(!_.isEmpty(e)){var t=_.head(e);y({type:"progress",summary:i.getString("Processing file...")}),n.parseFile(t).then(function(e){var n=e.deviceType,r=e.feedback;u.predefined.info=null,u.predefined.deviceType=null,function(e,n){u.custom.file=e,u.custom.deviceType=n}(t,n),s(n.name,n.fieldbusType),y(r)}).catch(function(e){var n=e.feedback;p(),y(n)})}},onNewNameEdited:function(){u.newName.edited=!0},import:function(){var e=u.predefined,n=u.custom,r=u.newName,t=u.fieldbusType,i=_.cloneDeep(e.deviceType||n.deviceType);i.name=r.value,i.fieldbusType=t,o.close({$value:i})},downloadFileName:c.predefinedDeviceTypeHrefFilename,downloadFileHref:function e(n){var r=e.cache||{};e.cache=r;var t=r[n.id];t||(t=c.downloadPredefinedDeviceTypeHref(n).then(function(e){r[n.id]=e}),r[n.id]=t);return t.then?"":t}})}e.$inject=["$scope","$rootScope","c8yDeviceDatabase","c8yDeviceTypeParser","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yImportDeviceTypeModal",{templateUrl:":::PLUGIN_PATH:::/modals/import-device-type.html",bindings:{close:"&",dismiss:"&"},controllerAs:"vm",controller:e})}();