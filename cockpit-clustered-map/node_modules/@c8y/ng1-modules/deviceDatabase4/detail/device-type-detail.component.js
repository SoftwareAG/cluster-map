"use strict";function asyncGeneratorStep(e,t,r,n,i,a,c){try{var s=e[a](c),o=s.value}catch(e){return void r(e)}s.done?t(o):Promise.resolve(o).then(n,i)}function _asyncToGenerator(s){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=s.apply(e,c);function i(e){asyncGeneratorStep(n,t,r,i,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,i,a,"throw",e)}i(void 0)})}}!function(){function e(c,e,n,r,i,s,t,a,o,u,p){var y=this,d=y.id,l=!0;function g(){return(g=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.next=4,m(d);case 4:F(),t.changeTitle({title:y.deviceType.name||u("New device type")}),c.$apply();case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(){return v.apply(this,arguments)}function v(){return(v=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getFeaturesManifestsAsync();case 2:y.deviceTypesFeatures=e.sent,c.$apply();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m(e){return T.apply(this,arguments)}function T(){return(T=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t=r,h()?s.getEmptyDeviceType():s.getDeviceType(t);case 2:n=e.sent,i=n.fieldbusType,_.assign(y,{deviceType:n,formValue:{fieldbusType:i},features:_.find(y.deviceTypesFeatures,{fieldbusType:i})}),c.$apply();case 6:case"end":return e.stop()}var t},e)}))).apply(this,arguments)}function h(){return"new"===d}function R(e){return x(e,s.getEmptyDiscreteOutput(),y.deviceType.c8y_Coils)}function b(e){return x(e,s.getEmptyDiscreteInput(),y.deviceType.c8y_Coils)}function w(e){return $(e,s.getEmptyHoldingRegister(y.deviceType),y.deviceType.c8y_Registers)}function D(e){return $(e,s.getEmptyInputRegister(),y.deviceType.c8y_Registers)}function x(e,t,r){return k("DiscreteIO",e,t,r)}function $(e,t,r){return k("Register",e,t,r)}function k(e,t,r,n){return I.apply(this,arguments)}function I(){return(I=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s["edit".concat(t,"WithUI")](r||n,y.deviceType);case 3:a=e.sent,C(r,i,a),F(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0&&"escape key press"!==e.t0&&o.danger(e.t0);case 11:c.$apply();case 12:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function C(e,t,r){(_.get(y.features,"holdingRegisters.number.useHex",!1)&&!r.number.startsWith("0x")&&(r.number="0x".concat(r.number)),e)?t[_.indexOf(t,e)]=r:t.push(r)}function G(e,t,r){return E.apply(this,arguments)}function E(){return(E=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a({title:u("Delete item"),body:p.getString(n,t),labels:{ok:u("Delete")},status:"danger"});case 3:i.removeFromList(r,t),F(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0&&o.danger(e.t0);case 10:c.$apply();case 11:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}function S(){return(S=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.save(t);case 3:o.success(u("Device type saved.")),l=!0,r.path("/deviceprotocols"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),o.danger(e.t0.errorMessage);case 11:c.$apply();case 12:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function z(){return O.apply(this,arguments)}function O(){return(O=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a({title:u("Confirm device type change?"),body:p.getString("By changing device type, all changes will be lost. Do you really want to proceed?")});case 3:return s.removeAllElements(y.deviceType),F(),t=y.formValue.fieldbusType,y.deviceType.fieldbusType=t,e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(0),r=y.deviceType.fieldbusType,y.formValue.fieldbusType=r,e.abrupt("return",r);case 15:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function F(){var e=y.deviceType;_.assign(y,{discreteOutputsCategorized:s.getDiscreteOutputsCategorized(e),discreteInputsCategorized:s.getDiscreteInputsCategorized(e),holdingRegistersCategorized:s.getHoldingRegistersCategorized(e),inputRegistersCategorized:s.getInputRegistersCategorized(e)})}_.assign(y,{$onInit:function(){return g.apply(this,arguments)},isNew:h,isEmpty:_.isEmpty,editDiscreteOutput:R,editDiscreteInput:b,editHoldingRegister:w,editInputRegister:D,addDiscreteOutput:R,addDiscreteInput:b,addHoldingRegister:w,addInputRegister:D,removeDiscreteOutput:function(e){return G(e,y.deviceType.c8y_Coils,u('Do you really want to remove "{{name}}"?'))},removeDiscreteInput:function(e){return G(e,y.deviceType.c8y_Coils,u('Do you really want to remove "{{name}}"?'))},removeHoldingRegister:function(e){return G(e,y.deviceType.c8y_Registers,u('Do you really want to remove "{{name}}"?'))},removeInputRegister:function(e){return G(e,y.deviceType.c8y_Registers,u('Do you really want to remove "{{name}}"?'))},save:function(e){return S.apply(this,arguments)},saveDisabled:function(){var e=y.deviceType;return _.get(y,"deviceTypeForm.$invalid")||!e||_.isEmpty(e.c8y_Coils)&&_.isEmpty(e.c8y_Registers)},changeDeviceType:function(){if(y.deviceType.fieldbusType)_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:t=e.sent,y.features=_.find(y.deviceTypesFeatures,{fieldbusType:t}),c.$apply();case 5:case"end":return e.stop()}},e)}))();else{var e=y.formValue.fieldbusType;y.deviceType.fieldbusType=e,y.features=_.find(y.deviceTypesFeatures,{fieldbusType:e})}},messageIdSources:s.MessageIdSources,toggleMainEdit:function(){y.editingMain=!y.editingMain}}),e.$watch("vm.deviceType",function(e,t){t&&e!==t&&(l=!1)},!0),e.$on("$locationChangeStart",function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=13;break}return t.preventDefault(),e.prev=2,e.next=5,a({title:u("Discard changes"),body:u("You are about to leave this page and discard the changes made. Do you want to proceed?"),status:"warning",labels:{ok:u("Discard")}});case 5:l=!0,n.location.href=r,c.$apply(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0&&o.danger(e.t0);case 13:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t){return r.apply(this,arguments)}}())}e.$inject=["$rootScope","$scope","$window","$location","c8yBase","c8yDeviceDatabase","c8yTitle","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yDeviceTypeDetail",{templateUrl:":::PLUGIN_PATH:::/detail/device-type-detail.html",bindings:{id:"<"},controllerAs:"vm",controller:e})}();