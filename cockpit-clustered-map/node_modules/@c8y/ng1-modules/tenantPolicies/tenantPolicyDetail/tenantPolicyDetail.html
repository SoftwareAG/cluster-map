<c8y-ui-title-set title="::vm.editingPolicy.name"></c8y-ui-title-set>

<c8y-breadcrumbs-set>
  <c8y-breadcrumbs-item
    path="#tenantpolicies"
    label="{{ 'Tenant policies' | translate }}"
    icon="c8y-tenant-policies"
  ></c8y-breadcrumbs-item>
</c8y-breadcrumbs-set>

<form name="vm.policyForm" novalidate>
  <div class="row">
    <div class="col-md-10 col-lg-8">
      <div class="card">
        <div class="card-block">
          <div class="form-group">
            <label for="name" translate>
              Name
            </label>
            <input
              id="name"
              name="name"
              type="text"
              class="form-control"
              placeholder="{{ 'e.g. My tenant policy' | translate }}"
              required
              ng-model="vm.editingPolicy.name"
            />
            <c8y-error-feedback field="vm.policyForm.name"></c8y-error-feedback>
          </div>
          <div class="form-group">
            <label for="description" translate>
              Description
            </label>
            <textarea
              id="description"
              name="description"
              class="form-control"
              style="height:100px;"
              ng-maxlength="1000"
              ng-model="vm.editingPolicy.description"
            >
            </textarea>
            <c8y-error-feedback field="vm.policyForm.description"></c8y-error-feedback>
          </div>

          <fieldset>
            <div class="legend form-block center" translate>
              Retention rules
            </div>
            <div
              class="c8y-empty-state text-left"
              ng-show="vm.editingPolicy.retentions.length === 0"
            >
              <h1 class="c8y-icon c8y-icon-tenant-policies c8y-icon-duocolor"></h1>
              <p>
                <strong translate>No retention rules defined.</strong>
                <span translate>You must add at least one retention rule.</span>
              </p>
            </div>
            <uib-accordion close-others="false">
              <c8y-retention-rule-row
                ng-repeat="rule in vm.editingPolicy.retentions"
                rule="rule"
                on-remove="vm.onRemoveRetentionRule(rule); vm.policyForm.$setDirty()"
              >
              </c8y-retention-rule-row>
            </uib-accordion>
          </fieldset>

          <button
            title="{{ 'Add retention rule' | translate }}"
            class="btn-add-block"
            ng-click="vm.addRetentionRule(); vm.policyForm.$setDirty()"
          >
            <i c8y-icon="plus-circle"></i> {{ 'Add retention rule' | translate }}
          </button>

          <fieldset>
            <div class="legend form-block center" translate>
              Tenant options
            </div>
            <div class="c8y-empty-state text-left" ng-show="vm.editingPolicy.options.length === 0">
              <h1 class="c8y-icon c8y-icon-tenant-policies c8y-icon-duocolor"></h1>
              <p>
                <strong translate>No options defined.</strong>
              </p>
            </div>
            <uib-accordion close-others="false">
              <c8y-tenant-options-row
                ng-repeat="option in vm.editingPolicy.options"
                option="option"
                on-remove="vm.onRemoveTenantOption(option); vm.policyForm.$setDirty()"
              >
              </c8y-tenant-options-row>
            </uib-accordion>
          </fieldset>

          <button
            title="{{ 'Add tenant option definition' | translate }}"
            class="btn-add-block"
            ng-click="vm.addTenantOption(); vm.policyForm.$setDirty()"
          >
            <i c8y-icon="plus-circle"></i> {{ 'Add tenant option definition' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center page-footer">
    <c8y-ui-button-footer>
      <div class="row">
        <div class="col-md-10 col-lg-8">
          <button
            title="{{ 'Cancel' | translate }}"
            class="btn btn-default"
            ng-click="vm.cancel()"
            translate
          >
            Cancel
          </button>
          &nbsp;
          <button
            title="{{ 'Remove' | translate }}"
            class="btn btn-danger"
            ng-if="vm.editingPolicy.id"
            ng-click="vm.remove()"
            translate
          >
            Remove
          </button>
          &nbsp;
          <button
            title="{{ 'Save' | translate }}"
            class="btn btn-primary"
            ng-disabled="!vm.editingPolicy.retentions.length || vm.policyForm.$invalid || vm.policyForm.$pristine"
            ng-click="vm.save()"
            translate
          >
            Save
          </button>
        </div>
      </div>
    </c8y-ui-button-footer>
  </div>
</form>
