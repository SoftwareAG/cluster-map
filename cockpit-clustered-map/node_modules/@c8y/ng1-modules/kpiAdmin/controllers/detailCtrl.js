"use strict";!function(){function e(n,t,e,i,a,l,r,s,u){var d,o,E,c={IS_REQUIRED:"required",PATTERN:"pattern",SHOULD_CONTAIN_NUMBER:"number",SHOULD_BE_DEFINED:"should-be-defined",GREATER_THAN_SCALE_MAX:"greater-than-scale-max",LESS_THAN_SCALE_MIN:"less-than-scale-min",GREATER_THAN_RANGE_MAX:"greater-than-range-max",LESS_THAN_RANGE_MIN:"less-than-range-min"},m={};function A(e){d=e,n.kpiMO=d,function(){var e=d.c8y_Kpi,t=u.getString("New data point");r.changeTitle({title:d.id?e.label:t,subtitle:e.fragment&&e.series?"".concat(e.fragment," / ").concat(e.series):""})}()}function N(){var e=t.history;1<e.length?e.back():i.path("/kpi")}function f(e,t,i,n){var a=e.$modelValue,l=t.$modelValue,r=[i,n];!_.isUndefined(a)&&null!==a&&!_.isUndefined(l)&&null!==l&&_.forEach(r,function(e){var t=e.$modelValue;!_.isUndefined(t)&&null!==t&&(e.$setValidity(c.GREATER_THAN_SCALE_MAX,t<=l),e.$setValidity(c.LESS_THAN_SCALE_MIN,a<=t))})}m[c.IS_REQUIRED]=s("This field is required."),m[c.PATTERN]=s("Dots not allowed."),m[c.SHOULD_CONTAIN_NUMBER]=s("This field must contain a number."),m[c.SHOULD_BE_DEFINED]=s("Value must be defined."),m[c.GREATER_THAN_SCALE_MAX]=s("Value must be less than scale maximum."),m[c.LESS_THAN_SCALE_MIN]=s("Value must be greater than scale minimum."),m[c.GREATER_THAN_RANGE_MAX]=s("Value must be less than respective maximum."),m[c.LESS_THAN_RANGE_MIN]=s("Value must be greater than respective minimum."),_.assign(n,{PATTERN_VALIDATE_FRAGMENT_SERIES:"^[^.]*$",save:function(){l.save(d).then(N)},cancel:N,invalidTxt:function(e){var t=n.editKpi[e];return _.filter(_.map(t&&t.$error,function(e,t){return e&&m[t]}),_.identity).join(" ")},invalid:function(e){var t=n.editKpi[e];return t&&t.$invalid&&t.$dirty},formValid:function(){var i=n.editKpi;return _.forEach([[i.min,i.max],[i.yellowRangeMin,i.yellowRangeMax],[i.redRangeMin,i.redRangeMax]],function(e,t){(function(e,t){var i=e.$modelValue,n=t.$modelValue,a=!_.isUndefined(i)&&null!==i,l=!_.isUndefined(n)&&null!==n;e.$setValidity(c.SHOULD_BE_DEFINED,!(l&&!a)),t.$setValidity(c.SHOULD_BE_DEFINED,!(a&&!l))}).apply(this,e),function(e,t){var i=e.$modelValue,n=t.$modelValue,a=!_.isUndefined(i)&&null!==i,l=!_.isUndefined(n)&&null!==n,r=a&&l;e.$setValidity(c.GREATER_THAN_RANGE_MAX,!r||i<n),t.$setValidity(c.LESS_THAN_RANGE_MIN,!r||i<n)}.apply(this,e),t&&_.partial(f,i.min,i.max).apply(this,e)}),i.$valid}}),(E=e.kpiId)?l.detail(E).then(a.getResData).then(A):(o=u.getString("New data point"),A({c8y_Kpi:{label:e.fragment&&e.series?a.humanizeFragment("".concat(e.fragment," => ").concat(e.series)):o,fragment:e.fragment,series:e.series,color:"#".concat(Math.floor(16777215*Math.random()).toString(16))}}))}e.$inject=["$scope","$window","$routeParams","$location","c8yBase","c8yKpi","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.kpiAdmin").controller("KpiDetailCtrl",e)}();