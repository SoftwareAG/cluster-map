"use strict";!function(){function n(d,g,v,y,n,f,h){var E;return{list:function(){return d.all({nbDevices:g.getCount(),currentApp:n.getCurrent(),buildTarget:d.resolve(v.appOption("target")),userApps:n.listByUser().then(e)}).then(function(n){var e=n.nbDevices,i=n.currentApp.name,r=n.buildTarget;E=n.userApps;var c=[],o=function(e){return y.hasAnyRole(["ROLE_USER_MANAGEMENT_CREATE","ROLE_USER_MANAGEMENT_ADMIN"]).then(function(n){return n&&m("administration")}).then(function(n){return n?_.assign({priority:2,icon:"c8y-icon c8y-icon-add-user",label:f("Add user"),url:"/apps/administration/index.html#/users/new",color:"#FEFEFE",backgroundColorClass:C("a")},e):null})}(),t=function(n){var e;m("devicemanagement")&&(e=_.assign({priority:2,icon:"c8y-icon c8y-icon-device-connect",label:f("Add device"),url:"/apps/devicemanagement/#/deviceregistration",color:"#FEFEFE",backgroundColorClass:C("b")},n));return e}(),a=function(n){var e;if(h){var i={dt:{backgroundColorClass:C("d")}};if(m("devicemanagement")){var r=(i[n]||{}).backgroundColorClass||"e";e={priority:2,icon:"c8y-icon c8y-icon-group-add",label:f("Add group"),click:k,color:"#FEFEFE",backgroundColorClass:C(r)}}}return e}(r),u=function(n){return{priority:({dt:{priority:2}}[n]||{}).priority||3,icon:"c8y-icon c8y-icon-device-management",label:f("Device management"),url:"/apps/devicemanagement",color:"#EFEFEF",backgroundColorClass:C("f")}}(r),l=function(n){return{priority:({dt:{priority:2}}[n]||{}).priority||3,icon:"c8y-icon c8y-icon-cockpit",label:f("Cockpit"),url:"/apps/cockpit",color:"#EFEFEF",backgroundColorClass:C("e")}}(r),s={priority:2,iconSrc:":::PLUGIN_PATH:::/icons/HelpAndService.svg",label:f("Help & Service"),url:"/apps/HelpAndService",color:"#EFEFEF",backgroundColorClass:C("f")};if(0===e)t.priority=1;else if(e<=5){var p=1===e?1:3;c.push(g.list({pageSize:e}).then(function(n){var e=[];return _.forEach(n,function(n){e.push(function(n,e,i,r){var c,o=_.filter(["cockpit","devicemanagement"],function(n){return m(n)});if(o.length){var t=_.includes(o,r)?r:_.head(o);c=_.assign({priority:({dt:{priority:2}}[i]||{}).priority||3,icon:"c8y-icon c8y-icon-device",label:n.name||f("Device ")+n.id,url:"/apps/".concat(t,"/#/device/").concat(n.id),color:"#FEFEFE",backgroundColorClass:C("c")},e)}return c}(n,{priority:p},r,i))}),e}))}else l.priority=1;return c.push(function(){var n,e=v.getPluginService("phoneRegistrationService");e&&(n=e.createAddPhoneLink());return n}()),c.push(d.when(o)),c.push(d.when(t)),c.push(d.when(a)),"devicemanagement"!==i&&m("devicemanagement")&&c.push(d.when(u)),"cockpit"!==i&&m("cockpit")&&c.push(d.when(l)),"HelpAndService"!==i&&"dt"===r&&m("HelpAndService")&&c.push(d.when(s)),d.all(c).then(_.flattenDeep).then(_.partialRight(_.filter,_.identity))})}};function k(){h.addAssetUI()}function m(n){return _.includes(E,n)}function C(n){return["quick-link","quick-link-".concat(n.priority),"quick-link-bgcolor-".concat(n.backgroundColorClass)]}function e(n){return _(n).map("contextPath").uniq().value()}}n.$inject=["$q","c8yDevices","c8yBase","c8yPermissions","c8yApplication","gettext","groupsHierarchySvc"],angular.module("c8y.ui").factory("c8yQuickLinks",n)}();