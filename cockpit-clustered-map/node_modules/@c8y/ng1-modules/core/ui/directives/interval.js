"use strict";!function(t){var u=[{id:"minutes",txt:t("Last minute"),unit:"minutes",qty:1},{id:"hours",txt:t("Last hour"),unit:"hours",qty:1},{id:"days",txt:t("Last day"),unit:"days",qty:1},{id:"weeks",txt:t("Last week"),unit:"weeks",qty:1},{id:"months",txt:t("Last month"),unit:"months",qty:1},{id:"custom",txt:t("Custom"),unit:!1}],c=_.last(u),e=_.reduce(u,function(t,e){return e.qty&&(t[e.id]=moment.duration(e.qty,e.unit)),t},{});function m(e,n){if(Math.abs(moment(n).diff(moment()))>1e4){return c.id}var t=_(u).filter(function(t){return t.unit}).find(function(t){return moment(n).subtract(t.qty,t.unit).isSame(e,"second")});return t&&t.id||c.id}angular.module("c8y.ui").directive("c8yInterval",["$parse",function(d){return{restrict:"E",template:'\n        <div class="c8y-select-wrapper"><select\n          class="form-control"\n          ng-options="interval.id as (interval.txt | translate) for interval in __intervals"\n          ng-model="__selected"\n          ng-change="__onChange()"\n          ng-model-options="{debounce: 150}" >\n        </select><span></span></div>',replace:!0,scope:!0,link:function(i,t,e){var s={},n=d(e.dateFrom),a=d(e.dateTo),o=d(e.interval);i.__selected=c.id,i.__intervals=u,i.__onChange=function(){if(o.assign&&o.assign(i,i.__selected),i.__selected!==c.id){var t=_.find(u,function(t){return t.id===i.__selected}),e=moment();s.dateFrom=moment(e).subtract(t.qty,t.unit).toDate(),s.dateTo=e.toDate(),n.assign(i,s.dateFrom),a.assign(i,s.dateTo)}};var r="[".concat([e.dateFrom,e.dateTo,e.interval].join(","),"]");i.$watch(r,function(t,e){s.dateFrom||s.dateTo||!o.assign||(i.__selected=t[2]||c.id);if(t===e)return;if(n=s,a={dateFrom:t[0],dateTo:t[1]},(n.dateFrom&&new Date(n.dateFrom).getTime())===(a.dateFrom&&new Date(a.dateFrom).getTime())&&(n.dateTo&&new Date(n.dateTo).getTime())===(a.dateTo&&new Date(a.dateTo).getTime()))return;var n,a;i.__selected=m(t[0],t[1]),o.assign&&o.assign(i,i.__selected)},!0)}}}]).constant("INTERVAL_CONSTANTS",{intervals:u,durations:e,custom:_.last(u),_defaultDuration:"hours"})}(_.identity);