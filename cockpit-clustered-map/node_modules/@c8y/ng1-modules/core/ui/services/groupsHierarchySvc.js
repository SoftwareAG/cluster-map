"use strict";!function(){function e(r,t,o,u,c,s,n,i,a,d,l,h,v){return{addAssetUI:function(){return v.open({component:"c8yGroupCreateAndAssignModal"}).result},editGroup:function(e){t.url("/group/".concat(e.id))},deleteGroup:function(e){return s.remove(e)},deleteGroupWithConfirmation:function(t){var e=0<t.childAssets.references.length,n=0<t.childDevices.references.length,r=!e&&!n,o=a.isDynamicGroup(t),i=r||o?h.getString('You are about to delete group "{{name}}". This operation is irreversible. Do you want to proceed?',t):h.getString('You are about to delete group "{{name}}" and its sub-groups recursively. This operation is irreversible. Do you want to proceed?',t);return u({title:l("Delete group"),body:i,checkboxes:{cascade:{text:l("Also delete all devices inside this group and its sub-groups."),checked:!1,showIf:function(){return!(r||o)}}},status:"danger",labels:{ok:l("Delete")}}).then(function(e){return a.isSmartGroupV2(t)?a.remove(t):s.remove(t,e)}).then(function(){return d.removeGroupNavigation(t)}).then(function(){return c.success(l("Group deleted."))})},deleteDeviceWithConfirmation:function(n,e){var t=!_.isUndefined(n.childDevices)&&(!e&&0<n.childDevices.references.length&&!_.isUndefined(n.c8y_IsDevice)),r={title:l("Delete device"),body:h.getString('You are about to delete device "{{name}}". This operation is irreversible. Do you want to proceed?',n),checkboxes:{cascade:{text:l("Also delete child devices of this device."),checked:t,showIf:function(){return t}},withDeviceUser:{text:h.getString('Also delete associated device owner "{{owner}}".',n),checked:!1,showIf:function(){var e=n.c8y_IsDevice,t=n.owner&&i.isDeviceUser({id:n.owner});return Boolean(e&&t)}}},labels:{ok:l("Delete")},status:"danger"};return u(r).then(function(e){return s.remove(n,e)}).then(function(){return d.updateAllGroupsOfAChild(n)}).then(function(){return c.success(l("Device deleted."))})},unassignDevice:function(e,t){var n={title:l("Unassign device"),body:h.getString('You are about to unassign device "{{name}}". Do you want to proceed?',t),status:"warning",size:"sm",labels:{ok:l("Unassign")}};return u(n).then(_.partial(g,e.id,t)).then(function(){return s.removeChildAsset(e,t)}).then(function(){return d.updateGroupChildren(e)})},assignDevices:function(e){return v.open({component:"c8yGroupDeviceAssignmentModal",resolve:{currentGroup:function(){return e}}}).result.then(function(){return d.updateGroupChildren(e)})},getGroup:function(e){return s.detail(e).then(n.getResData)}};function g(e,t){var n=o.when();try{return(n=r.get("smartRulesSvc")).listByContext(e).then(function(e){return o.all(e.map(function(e){return n.deactivate(e,t,!1)}))})}catch(e){return n}}}e.$inject=["$injector","$location","$q","c8yModal","c8yAlert","c8yInventory","c8yBase","c8yUser","c8yDynamicGroups","groupTypesHierarchyNavigator","gettext","gettextCatalog","$uibModal"],angular.module("c8y.ui").factory("groupsHierarchySvc",e)}();