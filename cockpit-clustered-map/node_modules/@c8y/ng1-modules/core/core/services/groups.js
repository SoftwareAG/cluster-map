"use strict";function _objectSpread(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},t=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.forEach(function(e){_defineProperty(r,e,n[e])})}return r}function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}!function(){function e(e,u,n,t,o,c,p){var y={c8y_BrokerSourceInactive:{icon:"c8y-group-remote-inactive",iconOpen:"c8y-group-remote-inactive"},c8y_BrokerSource:{icon:"c8y-group-remote",iconOpen:"c8y-group-remote-open"},c8y_DeviceGroup:{icon:"c8y-group",iconOpen:"c8y-group-open"},c8y_DynamicGroup:{icon:"c8y-group-smart",iconOpen:"c8y-group-smart-open"},other:{icon:"circle",iconClass:"statusUnknown"}};return{getGroupItems:i,getGroupAssetsAndDevices:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.createListFilter(function(e){var r=e.id,n=_.map(_.get(t,"childAdditions.references"),_.property("managedObject.id"));return!_.includes(n,r)});return i(t,e).then(r)},getGroupTypeItems:function(r){return o.getLookup().then(function(e){return[e[r]]}).then(s)},getTopLevelGroups:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e||!1;return c.mustHaveAllRoles(["ROLE_INVENTORY_READ"]).then(function(){return o.get().then(_.property("groups")).then(function(e){return n?function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.push({type:p.getType()}),s(e).then(function(e){return p.addChildCountProperty(e,r)})}(e,r):s(e,r)})},a)},isGroup:f,getGroupInfo:r,getIconSpecs:function(e){return r(e).iconSpecs},getIconSpecsForType:function(e){return _.get(y,e,{})}};function i(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t.listQuery(function(e){return{__bygroupid:n.getId(e)}}(e),_objectSpread({withParents:!0},r),!0)}function s(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n={__filter:{type:{__in:_.map(e,"type")}}};return t.listQuery(n,r,!0)}function a(){return t.list({fragmentType:"c8y_IsDeviceGroup",pageSize:1e3,withParents:!0}).then(function(e){return function(e){var r=_.flatMap(e,"childAssets.references"),n=_.map(r,"managedObject.id");return _.reject(e,function(e){return _.includes(n,e.id)})}(e)})}function f(e){return!!e.c8y_IsDeviceGroup||"c8y_DeviceGroup"===e.type}function r(e){var r,n=f(e),t=u.get("c8yDevices").isDevice(e),o=p.isDynamicGroup(e),c=u.get("c8yDeviceGroup"),i=c.hasBrokerSource(e);return n?r=i?c.isBrokerSourceActive(e)?"c8y_BrokerSource":"c8y_BrokerSourceInactive":p.isDynamicGroup(e)?"c8y_DynamicGroup":"c8y_DeviceGroup":o?r="c8y_DynamicGroup":t||(r="other"),{isGroup:n,isDynamicGroup:o,hasBrokerSource:i,iconSpecs:_.get(y,r,{})}}}e.$inject=["$q","$injector","c8yBase","c8yInventory","c8yGroupTypesConfig","c8yPermissions","c8yDynamicGroups"],angular.module("c8y.core").factory("c8yGroups",e)}();