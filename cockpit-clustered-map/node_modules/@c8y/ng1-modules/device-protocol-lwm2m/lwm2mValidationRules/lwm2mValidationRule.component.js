"use strict";!function(){function e(e,n,r){var t,a=e.Validation.RuleType,l=e.Validation.ResourceDataType,o=e.Validation.ValueType,u=e.Validation.RuleName,i=[{type:a.GT,name:u.GT},{type:a.LT,name:u.LT},{type:a.GTE,name:u.GTE},{type:a.LTE,name:u.LTE},{type:a.EQ,name:u.EQ},{type:a.NEQ,name:u.NEQ}],s=this;function m(){if(s.showDateTime=c()&&T(),s.showDateTime){var e=function(e){var t;if(_.isString(e)){var a=(t=moment(e)).isValid();if(!a){var n=_.toNumber(e);_.isNumber(n)&&(t=moment(new Date(n)))}}else _.isNumber(e)&&(t=moment(new Date(e)));return{asString:_.get(t,"_d"),asMs:t?t.valueOf():void 0}}(s.dateTimeValue||_.get(s.rule,"arg.value"));s.value=e.asMs,s.dateTimeValue=e.asString,s.rule.arg.value=e.asMs}}function T(){return!(!_.isUndefined(s.selectedType)||s.resourceDataType!==l.TIME)||s.selectedType===o.DATE}function c(){return s.resourceDataType===l.TIME}function d(){var e=_.get(s.rule,"arg.valueType"),t="",a="";return e===o.STRING&&s.resourceDataType===l.BOOLEAN&&(a='"true"'.concat(" ",r.getString("or"),' "false"'),t="(true|false)"),e===o.OBJECTLINK&&(a=n("Reference to another object with this format: /Object/Instance/Resource, for e.g. /3303/0/5700"),t="/[\\d*/]*\\d+"),e===o.NUMBER&&s.resourceDataType===l.INTEGER&&(a=n("Only values of type Integer allowed"),t="-?\\d+"),e===o.NUMBER&&s.resourceDataType===l.FLOAT&&(a=n("Only values of type Float allowed"),t="-?\\d*[.]\\d+"),e===o.DATE&&s.resourceDataType===l.TIME&&(a=n("Only numbers allowed, e.g. 1528197925677."),t="\\d+"),{pattern:t,tooltip:a}}function p(e){var t=_.find(i,{type:e});return t?t.name:void 0}_.assign(s,{change:function(){s.rule.type=function(e){var t=_.find(i,{name:e});return t?t.type:void 0}(s.selectedRule),s.rule.arg.valueType=s.selectedType,s.rule.arg.value=s.value,s.showDateTime=T()&&c(),s.formValidation=d(),s.onChange({rule:s.rule})},dateTimeChange:m,reflectInDateTimePicker:function(){s.dateTimeValue=moment(new Date(_.toNumber(s.value)))},selectedRule:p(_.get(s.rule,"type",_.first(s.options))),selectedType:_.get(s.rule,"arg.valueType"),ruleOptions:(t=s.options,_.map(t,function(e){return p(e)})),formValidation:d(),value:_.get(s.rule,"arg.value"),dateTimeValue:m(),$onChange:s.onChange({rule:s.rule})})}e.$inject=["c8yLwm2m","gettext","gettextCatalog"],angular.module("c8y.lwm2m").component("c8yLwm2mValidationRule",{templateUrl:":::PLUGIN_PATH:::/lwm2mValidationRules/lwm2mValidationRule.html",controller:e,controllerAs:"vm",bindings:{rule:"<",options:"<",isLast:"<",valueTypes:"<",onAdd:"&",onRemove:"&",onChange:"&",resourceDataType:"@"}})}();