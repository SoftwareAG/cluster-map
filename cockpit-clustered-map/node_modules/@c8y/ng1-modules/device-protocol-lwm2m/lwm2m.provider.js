"use strict";!function(){t.$inject=["gettext","c8yDeviceProtocolUiProvider","c8yViewsProvider"];var o="c8yLwm2m";function t(f,t,e){i.$inject=["c8yBase","c8yInventory","c8yApplication","c8yObjectMappings","c8yPermissions","$http","$q","$upload","gettextCatalog"],r.$inject=["$routeParams"];var n={service:o,id:"lwm2m",name:f("LWM2M")},v={path:"/deviceprotocols/".concat(n.id,"/:id"),template:'<c8y-lwm2m-detail id="vm.id"></c8y-lwm2m-detail>',controllerAs:"vm",controller:r};return{initUi:function(){t.register(n),e.when(v.path,v)},$get:i};function r(t){_.assign(this,t)}function i(r,n,t,e,i,o,a,s,c){var u,l=r.url("service/lwm2m-agent/"),g="".concat(l,"objectResourceMappings"),m={minPeriod:f("The minimum period attribute indicates the minimum time in seconds the LWM2M client MUST wait between two notifications."),maxPeriod:f("The maximum period attribute indicates the maximum time in seconds the LWM2M client MAY wait between two notifications."),greaterThan:f("This greater than attribute defines a threshold high value."),lessThan:f("This less than attribute defines a threshold low value."),step:f("This step attribute defines a minimum change value between two notifications.")},p={RuleType:{LT:"lt",GT:"gt",EQ:"eq",NEQ:"neq",GTE:"gte",LTE:"lte",AND:"and",OR:"or"},ValueType:{NUMBER:"number",DATE:"date",STRING:"string",REGEX:"regex",OBJECTLINK:"objectLink"},ResourceDataType:{INTEGER:"INTEGER",FLOAT:"FLOAT",STRING:"STRING",BOOLEAN:"BOOLEAN",TIME:"TIME",OBJECTLINK:"OBJECTLINK"},RuleName:{GT:"Greater than",LT:"Lower than",GTE:"Greater or equals than",LTE:"Lower or equals than",EQ:"Equals",NEQ:"Equals not"}};return{flow:function(){return["c8yLwm2mUploadStep","c8yLwm2mFinalStep"]},list:function(){return o.get(g,{silentError:!0}).then(r.getResData)},detail:function(t){var e=r.getId(t);return n.detail(e).then(r.getResData)},detailPath:function(t){var e=y(t);return v.path.replace(/:id$/,e)},upload:function(t){return s.upload({url:"".concat(g,"/ddf"),method:"POST",headers:{Accept:"application/json"},file:t,fileName:t.name.replace(/\s+/g,"_")})},remove:function(t){var e=y(t);return n.remove(e)},getName:e.getName,updateMapping:function(t,e){var n="".concat(g,"/").concat(t,"/add");return o.put(n,e)},getPostRegistrationOptions:function(){var t={url:"".concat(l,"postRegistrationOptions"),method:"GET",silentError:!0};return o(t).then(r.getResData)},setPostRegistrationOptions:function(t){var e={url:"".concat(l,"postRegistrationOptions"),method:"PUT",data:{commands:t}};return o(e)},helpTexts:m,isServiceAvailable:d,showIf:function t(){t._cached||(t._cached=d());return t._cached},listRowInfoComponent:"c8yDeviceProtocolRowCountResources",getCustomActions:function(){u||(u=o.get("".concat(l,"mappingActions/resourceactions")).then(r.getResData).then(h));return u},Validation:p,isDeviceType:function(t){return"c8y_lwm2m"===t.type},bootstrapSchema:function(){return{type:"object",properties:{endpoint:{type:"string",readonly:!0,title:c.getString("Endpoint")},bootstrapId:{type:"string",title:c.getString("Bootstrap ID")},bootstrapKey:{type:"string",title:c.getString("Bootstrap key")},serverUri:{type:"string",title:c.getString("Server URI")},securityMode:{type:"string",enum:["PSK","RPK","X509","NO_SEC"],title:c.getString("Security mode")},publicKeyOrId:{type:"string",title:c.getString("Public key or ID")},serverPublicKey:{type:"string",title:c.getString("Server public key")},secretKey:{type:"string",title:c.getString("Secret key")},securityInstanceOffset:{type:"string",title:c.getString("Security instance offset")},generateBootstrapServerConfig:{type:"boolean",title:c.getString("Generate boostrap server config"),"x-schema-form":{type:"select",titleMap:[{value:!0,name:c.getString("Yes")},{value:!1,name:c.getString("No")}]}},bootstrapShortServerId:{type:"string",title:c.getString("Bootstrap short server ID")},lwm2mShortServerId:{type:"string",title:c.getString("LWM2M short server ID")},registrationLifeTime:{type:"integer",title:c.getString("Registration lifetime")},defaultMinimumPeriod:{type:"integer",title:c.getString("Default minimum period")},defaultMaximumPeriod:{type:"integer",title:c.getString("Default maximum period")},bindingMode:{type:"string",title:c.getString("Binding mode"),"x-schema-form":{type:"select",titleMap:[{value:"U",name:c.getString("UDP")},{value:"UQ",name:c.getString("UDP with queue mode")}]}}}}},bootstrapSchemaChange:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=angular.copy(t),r="PSK"!==e.securityMode;return["bootstrapId","bootstrapKey","publicKeyOrId","serverPublicKey","secretKey"].forEach(function(t){n.properties[t].readonly=r}),n},bootstrapPermissions:function(){return a.all({read:i.hasAnyRole(["ROLE_INVENTORY_READ"]),write:i.hasAnyRole(["ROLE_INVENTORY_ADMIN"])})},bootstrapParams:function(t,e){var n={url:function(t){return"".concat(l,"device/").concat(t,"/bootstrapParams")}(t),method:e?"PUT":"GET"};e&&(n.data=e);return o(n).then(r.getResData)}};function d(){return t.isAvailable({name:"lwm2m-agent",type:"MICROSERVICE"})}function y(t){return _.get(t,"id")}function h(t){return _.reduce(t,function(t,e){var n=e.name,r=e.args,i=_.get(r,"length")?r.map(function(t){return"".concat(n,":").concat(t)}):[n];return t.concat(i)},[])}}}angular.module("c8y.lwm2m").provider(o,t)}();