"use strict";function asyncGeneratorStep(e,n,t,a,u,i,o){try{var r=e[i](o),c=r.value}catch(e){return void t(e)}r.done?n(c):Promise.resolve(c).then(a,u)}function _asyncToGenerator(r){return function(){var e=this,o=arguments;return new Promise(function(n,t){var a=r.apply(e,o);function u(e){asyncGeneratorStep(a,n,t,u,i,"next",e)}function i(e){asyncGeneratorStep(a,n,t,u,i,"throw",e)}u(void 0)})}}!function(){function e(a,n,e,u,t,i,o,r,c,s,l){var m,d,f=this,g=e.PROFIBUS_DEVICE_FRAGMENT,p=e.CANOPEN_DEVICE_FRAGMENT,v=i.isElementChangePending,h=i.canUpdateElement,E=i.getCurrentElementValue,y=s("Value out of range. Allowed values from {{min | number}} to {{max | number}}."),b=[];function S(){return(S=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n)return e.next=3,c.getWidgetModel(n);e.next=6;break;case 3:t=e.sent,_.assign(f,t),a.$apply();case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(e){n(T,e)}function T(){_.forEach(f.categories,function(e){_.forEach(e.elements,function(e){(function(e){return f.isElementChangePending(e)||_.includes(b,e)})(e)||(e.meta.type===t.ElementType.DISCRETE_IO&&(e.valueObj=_.find(e.meta.enumValues,{value:E(f.device,e)})),e.meta.type===t.ElementType.REGISTER&&(e.meta.enumType?e.valueObj=_.find(e.meta.enumValues,{value:E(f.device,e)}):_.set(e,"valueObj.value",E(f.device,e))))})})}_.assign(f,{$onChanges:function(e){e.config&&function(e){S.apply(this,arguments)}(f.config)},$doCheck:function(){var e=!1;_.isEqual(m,f.categories)||(m=_.cloneDeep(f.categories),e=!0);_.isEqual(d,f.device)||(d=_.cloneDeep(f.device),e=!0);e&&C()},isElementChangePending:v,canUpdateElement:h,updateElement:function(e,n,t){var a=i.updateElement;_.has(e,g)?a=o.updateElement:_.has(e,p)&&(a=r.updateElement);return a(e,n,t).then(function(){b=_.without(b,n),C(500)})},shouldShowSwitch:function(e){return e.meta.enumType&&e.meta.enumValues&&2===e.meta.enumValues.length},shouldShowEnumSelect:function(e){return e.meta.enumType&&e.meta.enumValues&&(1===e.meta.enumValues.length||2<e.meta.enumValues.length)},shouldShowNumberInput:function(e){return!e.meta.enumType},validationHints:function(e,n){var t=[];n.meta.valuesRange.possiblePrecisionLoss&&t.push(l.getString("Precision loss may occur, check Cloud Fieldbus specification for details."));if(f.canUpdateElement(f.device,n)){var a=_.get(n,"meta.valuesRange.custom");t.push(u.validationHints(e,{required:s("This field is required."),"value-in-register-range":l.getString(y,a)}))}return t.join(" ")},focus:function(e){b.push(e)},blur:_.debounce(function(e){b=_.without(b,e),C(500)},500)})}e.$inject=["$rootScope","$timeout","fieldbusConstants","c8yBase","c8yDeviceDatabase","c8yModbusDevice","c8yProfibusDevice","c8yCanopenDevice","modbusWidgetSvc","gettext","gettextCatalog"],angular.module("c8y.modbusWidget4").component("c8yModbusWidget",{templateUrl:":::PLUGIN_PATH:::/widget.html",bindings:{config:"<"},controllerAs:"vm",controller:e})}();