<div data-ng-controller="exportListCtrl as vm">
  <c8y-ui-title-set title="'Exports' | translate"></c8y-ui-title-set>
  <c8y-ui-action-bar-set>
    <!-- TODO: change export button into select option and also allow  removing reports as bulk action-->
    <!-- <li class="navbar-form c8y-bulk-actions">
            <div class="form-group" title="Bulk actions">
              <div class="input-group">
                <div class="c8y-select-wrapper">
                  <select class="form-control" ng-disabled="!hasEmail || getSelectedConfigs().length === 0">
                    <option value="">Select bulk action</option>
                    <option value="">Export</option>
                    <option value="">Remove</option>
                  </select>
                  <span></span>
                </div>
                <span class="input-group-btn">
                  <button type="button" class="btn btn-default" title="{{'Apply the selected action to the group of checked rows' | translate}}" translate="">Apply</button>
                </span>
              </div>
            </div>
          </li>
            -->

    <!-- TODO: Remove  after implementing export in select -->
    <button
      title="{{ 'Export' | translate }}"
      action-bar-position="left"
      class="btn btn-link"
      ng-click="runExport()"
      ng-disabled="!vm.hasEmail || vm.getSelectedConfigs().length === 0"
    >
      <i c8y-icon="external-link"></i> {{ 'Export' | translate }}
    </button>

    <li class="hidden-xs" action-bar-position="left">
      <a
        tabindex="0"
        uib-popover-html="'You will receive download links by email.' | translate"
        popover-append-to-body="true"
        popover-placement="right"
        popover-trigger="'focus'"
        style="display:inline-block;"
      >
        <i class="fa fa-question-circle-o text-primary"></i>
      </a>
    </li>

    <button title="{{ 'Add export' | translate }}" class="btn btn-link" data-ng-click="add()">
      <i c8y-icon="plus-circle"></i> {{ 'Add export' | translate }}
    </button>

    <c8y-refresh-btn></c8y-refresh-btn>
  </c8y-ui-action-bar-set>

  <div class="c8y-empty-state text-center" ng-show="rows.length == 0">
    <h1 class="c8y-icon c8y-icon-report c8y-icon-duocolor"></h1>
    <h3 translate>No exports to display.</h3>
    <p translate>Add your first export using the button below.</p>
    <p>
      <button title="{{ 'Add export' | translate }}" class="btn btn-primary" data-ng-click="add()">
        <i c8y-icon="plus"></i> {{ 'Add export' | translate }}
      </button>
    </p>
    <p c8y-guide-docs>
      <small translate
        >Find out more in the
        <a c8y-guide-href="users-guide/cockpit/#export">User guide`KEEP_ORIGINAL`</a>.</small
      >
    </p>
  </div>

  <div class="list-group">
    <div class="list-group-item flex-row" ng-repeat="row in rows | orderBy:'config.name'">
      <div class="list-item-actions">
        <div class="settings pull-right dropdown" uib-dropdown is-open="menuOpen">
          <button
            type="button"
            title="{{ 'Options' | translate }}"
            class="dropdown-toggle c8y-dropdown"
            uib-dropdown-toggle
          >
            <i c8y-icon="ellipsis-v" class="fa fw fa-ellipsis-v"></i>
          </button>
          <ul class="dropdown-menu" uib-dropdown-menu>
            <li>
              <a href="" title="{{ 'Edit' | translate }}" ng-click="detail(row.config)">
                <i c8y-icon="pencil"></i>
                <translate>Edit</translate>
              </a>
            </li>
            <li>
              <a href="" title="{{ 'Duplicate' | translate }}" ng-click="clone(row.config)">
                <i c8y-icon="clone"></i>
                <translate>Duplicate</translate>
              </a>
            </li>

            <li>
              <a href="" title="{{ 'Remove' | translate }}" ng-click="remove(row.config)">
                <i c8y-icon="trash"></i>
                <translate>Remove</translate>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <!-- /.list-item-actions -->

      <div class="list-item-checkbox">
        <label class="c8y-checkbox input-sm">
          <input
            title="{{ 'Select' | translate }}"
            type="checkbox"
            ng-model="row.selected"
            ng-change="updateOutput()"
          />
          <span></span>
        </label>
      </div>

      <div class="list-item-icon" ng-click="detail(row.config)">
        <i
          uib-tooltip="{{
            row.config.exportType === 'csv'
              ? 'CSV file'
              : row.config.exportType === 'vnd.ms-excel'
              ? 'XLS file'
              : ''
          }}"
          class="fa"
          ng-class="{'fa-file-text-o': row.config.exportType === 'csv', 'fa-file-excel-o': row.config.exportType === 'vnd.ms-excel'}"
        ></i>
      </div>

      <div class="list-item-body" ng-click="detail(row.config)">
        <div class="row">
          <span class="col-sm-4 col-xs-12">{{ row.config.name }}</span>
          <div class="col-sm-6 col-xs-12 text-muted">
            <span ng-show="::row.config.queryParameters.dateType == 'LAST_WEEK'"
              ><i c8y-icon="calendar"></i><translate>Last week</translate></span
            >
            <span ng-show="::row.config.queryParameters.dateType == 'LAST_MONTH'"
              ><i c8y-icon="calendar"></i><translate>Last month</translate></span
            >
            <span ng-show="::row.config.queryParameters.dateType == 'LAST_YEAR'"
              ><i c8y-icon="calendar"></i><translate>Last year</translate></span
            >
            <span ng-show="::row.config.queryParameters.dateType == 'CUSTOM'">
              <i c8y-icon="calendar"></i>
              <span ng-show="::row.config.queryParameters.from">
                <label class="small">{{ 'From`date`' | translate }}:</label>
                {{ row.config.queryParameters.from | absoluteDate }} &nbsp;
              </span>
              <span ng-show="::row.config.queryParameters.to">
                <label class="small">{{ 'To`date`' | translate }}</label>
                {{ row.config.queryParameters.to | absoluteDate }}
              </span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
