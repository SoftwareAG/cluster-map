"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(n,a,e,c,r,o,i,s){var u="service/remoteaccess",t="127.0.0.1",l=":::PLUGIN_PATH:::/clients/terminal/index.html",d="top=30,left=30,height=933,width=1350,location=no,menubar=no,toolbar=no,status=no,resizable=no",p=c.url("".concat(u,"/keypair/generate")),f={http:"ws:",https:"wss:"}[e.protocol()]||"ws:",v="wss:"===f,m=c.createEnum([{name:"NONE",value:"NONE",label:i("No password")},{name:"USER_PASS",value:"USER_PASS",label:i("Username and password")},{name:"PASS_ONLY",value:"PASS_ONLY",label:i("Password only")},{name:"KEY_PAIR",value:"KEY_PAIR",label:i("Public / private keys")}]),S=c.createEnum([{name:"VNC",value:"VNC",label:i("VNC"),supportedCredentialsTypes:[m.NONE,m.PASS_ONLY],defaults:{host:t,port:5900},clientWindowPath:":::PLUGIN_PATH:::/clients/vnc/vncClient.html",clientWindowParams:"top=0,left=0,location=no,menubar=no,toolbar=no,status=no,resizable=yes",extraConnectionParams:{encrypt:v,true_color:!0,local_cursor:!1,viewport:!0,shared:!0,view_only:!1,disconnectTimeout:10,repeaterID:"",port:443,password:""}},{name:"TELNET",value:"TELNET",label:i("Telnet"),supportedCredentialsTypes:[m.NONE],defaults:{host:t,port:23},clientWindowPath:l,clientWindowParams:d},{name:"SSH",value:"SSH",label:i("SSH"),supportedCredentialsTypes:[m.USER_PASS,m.KEY_PAIR],defaults:{host:t,port:22},clientWindowPath:l,clientWindowParams:d}]);return{DEFAULT_HOST:t,PROTOCOLS:S,CREDENTIALS_TYPES:m,save:function(t,n){try{return function(e,t){var n=_.includes([m.USER_PASS.value,m.PASS_ONLY.value],t.credentialsType),r=_.includes([m.KEY_PAIR.value],t.credentialsType);_.defaults(t,{password:n?_.get(t,"credentials.password"):void 0,privateKey:r?_.get(t,"credentials.privateKey"):void 0}),_.unset(t,"credentials"),_.unset(t,"attrs");var o=P(e,t);return a.put(o,t).then(c.getResData)}(t,n)}catch(e){return function(e,t){var n=y(e);return a.post(n,t).then(c.getResData)}(t,n)}},list:function(e){var t=y(e);return a.get(t).then(c.getResData)},detail:function(e,t){var n=P(e,t);return a.get(n).then(c.getResData)},remove:function(e,t){var n=P(e,t);return a.delete(n)},getConnectionParams:function(e,t){return n.all({title:s.getString("Connected to: {{name}}",t),protocol:_.find(S.values(),{value:t.protocol}),host:function(){var t=document.createElement("a");return o.current().then(function(e){return t.href=e.self,t.hostname})}(),path:function(t,n){return o.current().then(function(e){return function(e){return"service/remoteaccess/client/".concat(e.deviceId,"/configurations/").concat(e.configurationId,"?token=").concat(e.token)}({deviceId:c.getId(t),configurationId:n.id,token:r.encodeToken(e.userName,r.getPassword(),e.tenant)})})}(e,t),wsProtocol:f}).then(function(e){return _objectSpread({},e,e.protocol.extraConnectionParams)})},isMicroServiceAvailable:_.memoize(function(e){return a.head(y(e),{silentError:!0}).then(_.constant(!0),_.constant(!1))}),parseSshKeyFile:function(r){return n(function(n,e){var t=new FileReader;t.onload=function(e){var t=e.target;return n(t.result)},t.onerror=function(){return e({feedback:{type:"error",summary:i("Could not read file.")}})},t.readAsText(r)})},generateKeys:function(e){return a.post(p,{hostname:e}).then(c.getResData)},exportSshKey:function(e){var t=new Blob([e],{type:"text/plain"});window.saveAs(t,"key.pub")}};function y(e){var t=[u,"devices",c.getId(e),"configurations"].join("/");return c.url(t)}function P(e,t){return[y(e),c.getId(t)].join("/")}}e.$inject=["$q","$http","$location","c8yBase","c8yAuth","c8yUser","gettext","gettextCatalog"],angular.module("c8y.remoteAccess").factory("c8yRemoteAccess",e)}();