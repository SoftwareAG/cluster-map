<div data-ng-controller="locationCtrl">
  <c8y-ui-action-bar-set>
    <c8y-realtime-btn class="btn btn-link" subscriber-id="id" style="margin-left: -12px;">
    </c8y-realtime-btn>

    <button class="btn btn-link" title="{{ 'Center map' | translate }}" ng-click="centerMap()">
      <i c8y-icon="dot-circle-o"></i> {{ 'Center map' | translate }}
    </button>
  </c8y-ui-action-bar-set>

  <div class="row">
    <div class="col-md-8">
      <leaflet
        width="100%"
        height="600px"
        style="margin-bottom:15px;"
        markers="markers"
        center="center"
        defaults="mapDefaults"
        event-broadcast="events"
      ></leaflet>
    </div>

    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <span class="h4 card-title" translate>Current location</span>
          <div class="flex-item-right" ng-show="!noeditable">
            <small>
              <a
                title="{{ 'Edit location' | translate }}"
                href=""
                class="text-gray"
                ng-click="noeditable = !noeditable"
                translate
              >
                Edit location
              </a>
            </small>
            <a
              tabindex="0"
              uib-popover-html="'Device location may be set by the device itself, or manually in the platform' | translate"
              popover-append-to-body="true"
              popover-placement="left"
              popover-trigger="'focus'"
              style="display:inline-block;"
            >
              <i c8y-icon="question-circle-o"></i>
            </a>
          </div>
        </div>
        <hr />
        <div class="card-block" ng-class="{'form-read-only': !noeditable}">
          <form name="locationForm" novalidate class="form-horizontal">
            <div class="form-group" ng-class="{'has-error': invalid('locationForm', 'latitude')}">
              <label class="col-sm-4 control-label"><span translate>Latitude</span> (°)</label>
              <div class="col-sm-8">
                <input
                  type="number"
                  name="latitude"
                  class="form-control"
                  ng-model="location.lat"
                  ng-pattern="pattern.latitude"
                />
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': invalid('locationForm', 'longitude')}">
              <label class="col-sm-4 control-label"><span translate>Longitude</span> (°)</label>
              <div class="col-sm-8">
                <input
                  type="number"
                  name="longitude"
                  class="form-control"
                  ng-model="location.lng"
                  ng-pattern="pattern.longitude"
                />
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': invalid('locationForm', 'altitude')}">
              <label class="col-sm-4 control-label"
                ><span translate>Altitude</span> <span class="text-lowercase">(m)</span></label
              >
              <div class="col-sm-8">
                <input
                  type="number"
                  name="altitude"
                  class="form-control"
                  ng-model="location.alt"
                  ng-pattern="pattern.altitude"
                />
              </div>
            </div>
          </form>
        </div>

        <hr ng-show="noeditable" style="margin-bottom: 20px;" />

        <div class="form-horizontal" style="padding: 0 20px;">
          <div class="form-group">
            <form
              name="addressForm"
              ng-show="noeditable"
              novalidate
              ng-submit="gotoAddress(location.address)"
            >
              <label class="control-label col-md-4" translate>Address</label>
              <div class="col-md-8">
                <div class="input-group input-group-search">
                  <input
                    type="text"
                    ng-model="location.address"
                    placeholder="{{ 'Find lat/long by address' | translate }}"
                    class="form-control"
                  />
                  <span class="input-group-btn">
                    <button title="{{ 'Search' | translate }}" class="btn btn-link" type="submit">
                      <i c8y-icon="search"></i>
                    </button>
                  </span>
                </div>
              </div>
            </form>
          </div>
        </div>

        <hr />

        <div class="card-footer" ng-show="noeditable">
          <button
            title="{{ 'Cancel' | translate }}"
            class="btn btn-default"
            ng-click="cancel()"
            translate
          >
            Cancel
          </button>
          <button
            title="{{ 'Save' | translate }}"
            class="btn btn-primary"
            ng-disabled="locationForm.$invalid"
            ng-click="save()"
            translate
          >
            Save
          </button>

          <!-- <div ng-show="!noeditable">
            <button class="btn btn-default" ng-click="noeditable = !noeditable"><i c8y-icon="pencil"></i> Edit location</button>
            <span class="">
              <a tabindex="0" uib-popover-html="'Device location may be set by the device itself, or manually in the platform' | translate" popover-append-to-body="true" popover-placement="left" popover-trigger="'focus'" style="display:inline-block;">
                <i c8y-icon="question-circle-o"></i>
              </a>
            </span>
          </div> -->
        </div>
      </div>
    </div>
  </div>
</div>
