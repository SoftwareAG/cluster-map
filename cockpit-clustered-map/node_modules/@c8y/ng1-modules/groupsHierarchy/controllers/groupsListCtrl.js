"use strict";!function(){function e(i,n,t,e,r,o,c,u,a,s,p,g,l,d,f,v,h,D,m,y){var G,C,T,S=this,w="c8y_IsDeviceGroup";function k(e){C=e,i.currentGroup=e,S.currentGroup=e}function I(){var e;return C?g.isGroup(C)&&(e=g.getGroupAssetsAndDevices(C,{skipChildrenNames:!0,pageSize:20})):e=g.getTopLevelGroups("devicemanagement"===y.getCurrentContextPath(),{skipChildrenNames:!0,pageSize:20}),e}function L(e,n){T=T||[],n&&(T.length=0),T=T.concat(e),i.items=T,S.items=T,i.paging=e.paging}function N(){delete i.newGroup}function A(e){C?v.updateGroupChildren(C):v.addGroupNavigation(e)}function $(e){n.url("/device/".concat(e.id))}function O(e){return!R(e)&&!u.isDeviceOrChildDevice(e)}function R(e){return g.isGroup(e)||d.isDynamicGroup(e)}function b(){i.refreshLoading=!0,I().then(_.partialRight(L,!0)).finally(function(){i.refreshLoading=!1})}_.assign(S,{c8yConfig:f,getTitle:function(){var e;e=C?C.name:D("Groups");return e},getSubtitle:function(){return T?m.getPlural(T.length,"Showing 1 item","Showing {{$count}} items",{}):void 0},isDeviceListViewEnabled:function(){return d.isDynamicGroup(S.currentGroup)}}),_.assign(i,{addNewGroup:function(){i.newGroup={groupType:t.groupId?p.getDeviceSubgroupType():p.getDeviceGroupType(),name:""},S.newGroup=i.newGroup},cancelNewGroup:N,refresh:b,loadNext:function(){i.paging.loading=!0,i.paging.next().then(L).finally(function(){i.paging.loading=!1})},onClickEditGroup:function(e){h.editGroup(e)},onClickDeleteGroup:function(e){h.deleteGroupWithConfirmation(e).then(_.partial(_.pull,i.items,e))},onClickUnassignDevice:function(e){return h.unassignDevice(C,e).then(function(){return _.remove(T,{id:e.id})})},onClickDeleteDevice:function(e){return h.deleteDeviceWithConfirmation(e,O(e)).then(function(){return _.remove(i.items,{id:e.id})})},saveNewGroup:function(e){var n=function(e){var n=_.cloneDeep(e);return n[w]={},n.type=n.groupType.type,delete n.groupType,n}(e),i=C?o.createChildAsset(n,C):o.createConfirm(n);return i.then(c.getResData).then(A),i.then(function(){a.success(m.getString('Group "{{name}}" created.',e)),I().then(_.partialRight(L,!0)),N()})},drillDown:function(e){n.url("/group/".concat(e.id))},getLinkToDM:function(e){var n={deviceId:e.id};return r(G||"")(n)},goToDeviceDetails:$,goToDeviceAlarms:function(e){if(_.some(l.getTabsByURL("/device/".concat(e.id)),{name:"Alarms"}))return void n.url("/device/".concat(e.id,"/alarms"));$(e)},getIconForGroup:function(e){return g.getIconSpecs(e).iconOpen},isGroupOrDynamicGroup:R,isGroup:g.isGroup,isDeviceOrChildDevice:u.isDeviceOrChildDevice,isOtherItem:O,assignDevices:function(){h.assignDevices(C).then(b)},deviceModel:u.model,deviceSerial:u.serial,c8yConfig:f,getDeviceTitle:function(e){return _.get(e,"name",m.getString("Device {{id}}",e))}}),function(){if(i.inSearchMode)return;var e=t.groupId,n=_.isUndefined(e);c.getStaticLinkTemplate("devicemanagementDeviceDetails").then(function(e){G=e}),n?I().then(_.partialRight(L,!0)):function(e){return o.detail(e,{withParents:!0}).then(c.getResData)}(e).then(k).then(I).then(function(e){return L(e,!0)})}(),S.inSearchMode=i.inSearchMode}e.$inject=["$scope","$location","$routeParams","$q","$interpolate","c8yInventory","c8yBase","c8yDevices","c8yAlert","c8yTitle","c8yGroupTypesConfig","c8yGroups","c8yTabs","c8yDynamicGroups","c8yConfig","groupTypesHierarchyNavigator","groupsHierarchySvc","gettext","gettextCatalog","c8yApplication"],angular.module("c8y.groupsHierarchy").controller("groupsListCtrl",e)}();