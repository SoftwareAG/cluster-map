"use strict";angular.module("c8y.deviceConfiguration").controller("deviceConfigurationDumpCtrl",["$scope","$routeParams","c8yBase","c8yInventory","c8yDevices","c8yDeviceControl","c8yAlert","configurationRepositorySvc","gettext","gettextCatalog",function(o,e,t,n,i,r,a,c,u,s){var f=e.deviceId;function d(e){var t={};return _.isEmpty(e)||(t.name="*".concat(e,"*")),c.listQuery(t).then(l).then(v)}function p(e){var t=o.device.type;return!e.deviceType||e.deviceType===t}function g(e){var t=e.deviceType?"\0":"ï¿¿";return t+=(e.name||"")+(e.description||"")}function l(e){return o.configurations=_(e).filter(p).sortBy(g).value(),o.configurations}function v(){var t,e,n,i=o.device&&o.device.c8y_ConfigurationDump;i&&(t=i.id,e=i.datetime,n=_.find(o.configurations,function(e){return _.toString(e.id)===_.toString(t)})),o.deviceConfigId=t,o.deviceConfigDateUpdate=e,o.configFromRepository=n,o.configInfoAvailable=!0}function y(e,t){return e.deviceId=o.device.id,r.createWithNotifications(e).then(function(e){return e.created.then(function(){a.success(t)}),e})}o.newConfiguration={selected:null},o.retrieveConfiguration=function(){y({description:u("Retrieve configuration snapshot"),c8y_UploadConfigFile:{}},u("Configuration snapshot will be retrieved.")).then(function(e){e.created.then(function(){o.retrievingConfiguration=!0}),e.completed.then(function(e){e.status===r.status.SUCCESSFUL?a.success(u("Configuration snapshot saved to configuration repository.")):e.status===r.status.FAILED&&(e.failureReason?a.danger(s.getString('Failed to retrieve configuration snapshot: "{{failureReason | translate}}".',e)):a.danger(u("Failed to retrieve configuration snapshot."))),o.retrievingConfiguration=!1}).then(d)})},o.applyConfiguration=function(e){y({description:u("Apply configuration snapshot"),c8y_DownloadConfigFile:{url:e.url,c8y_ConfigurationDump:{id:e.id}}},u("Configuration snapshot will be applied.")).then(function(e){e.created.then(function(){o.applyingConfiguration=!0}),e.completed.then(function(e){e.status===r.status.SUCCESSFUL?a.success(u("Configuration snapshot applied.")):e.status===r.status.FAILED&&(e.failureReason?a.danger(s.getString('Failed to apply configuration snapshot: "{{failureReason | translate}}".',e)):a.danger(u("Failed to apply configuration snapshot."))),o.applyingConfiguration=!1}).then(d)})},o.supportsOperation=function(e){return i.supportsOperation(o.device,e)},o.configurationType=function(e){var t;return e.deviceType===o.device.type?t=s.getString("For device type: {{deviceType}}",{deviceType:o.device.type}):void 0===e.deviceType&&(t=s.getString("Type independent")),t},o.loadConfigurationRepositoryItems=d,i.detail(f).then(t.getResData).then(function(e){o.device=e})}]);