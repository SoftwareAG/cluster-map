"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(){function t(n,t,r,e,a,i){var o=this,l="two-factor-authentication",u=i("TOTP requires OAuth Internal login mode."),s=i("Messaging application is not subscribed."),y=[{systemOption:!0,key:"tenant-scope-settings.enabled",default:!1,readOnly:!0},{key:"enabled",default:!1,loader:g},{key:"token.validity",default:43200,readOnlyIfTenantScopeSettingsDisabled:!0},{key:"pin.validity",default:30,readOnlyIfTenantScopeSettingsDisabled:!0},{key:"enforced",default:!1,loader:g},{key:"strategy",default:"SMS"}];function c(e){var t=d(e),n=e.default;return(e.systemOption?r.getSystemOptionValue(t,n):"function"==typeof e.loader?e.loader():r.detailValue(t,n)).then(function(t){return function(t,e){o[f(t.key)]=e}(e,t)})}function d(t){return{category:l,key:t.key}}function f(t){return _.camelCase(t)}function p(t){var e={category:l,key:t.key,value:function(t){return function(t){return _.isNumber(t)||!_.isNaN(_.toNumber(t))&&_.isString(t)?_.toNumber(t):t}(o[f(t.key)])}(t)};return function(t){var e=t.readOnly,n=t.readOnlyIfTenantScopeSettingsDisabled&&!o.tenantScopeSettingsEnabled;return!t.systemOption&&!(e||n)}(t)?r.updateOption(e):n.when()}function g(){var e=this,n=d(this);return r.getSystemOptionValue(n,this.default).then(function(t){return!0===t?e.readOnly=!0:r.detailValue(n,e.default)})}_.assign(o,{$onInit:function(){n.all([].concat(_toConsumableArray(_.map(y,c)),[void t.isAvailable({contextPath:"messaging"}).then(function(t){o.smsAppAvailable=t})])).finally(function(){o.initialized=!0})},saveSettings:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.tfaSettingsForm;o.enabled&&"TOTP"===o.strategy||(o.enforced=!1);var e=_.map(y,p);return n.all(e).then(function(){a.success(i("TFA settings saved.")),t&&t.$setPristine()})},limitValidityRegex:/^[0-9]\d*$/,initialized:!1,totpPopover:u,smsWarningPopover:s,oAuthLoginMode:function(){return o.loginMode===e.loginOptions.OAUTH2_INTERNAL.value.toUpperCase()},isReadOnly:function(r){return y.some(function(t){var e=t.key,n=t.readOnly;return e===r&&n})}})}t.$inject=["$q","c8yApplication","c8ySettings","c8yLoginOptions","c8yAlert","gettext"],angular.module("c8y.parts.tfaSettings").component("c8yTfaSettings",{controller:t,controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/tfa-settings.html",bindings:{loginMode:"<"}})}();