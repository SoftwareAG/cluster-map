<div class="modal-header text-center separator">
  <h3 translate>Select a predefined command</h3>
  <div class="row p-t-16">
    <form ng-hide="vm.newCommandTemplate" class="commandTemplatesSearchForm col-xs-8">
      <div class="input-group input-group-search" style="margin:0;">
        <input
          type="search"
          class="form-control"
          placeholder="{{ 'Search command by name or text' | translate }}"
          ng-model="commandsFilter.text"
        />
        <span class="input-group-addon">
          <i c8y-icon="search" ng-hide="commandsFilter.text.length"></i>
          <i
            c8y-icon="times"
            ng-show="commandsFilter.text.length"
            ng-click="commandsFilter.text=''"
            title="{{ 'Clear`input`' | translate }}"
          ></i>
        </span>
      </div>
    </form>
    <div class="col-xs-4 flex-item-center">
      <button
        class="btn btn-primary btn-block"
        ng-click="vm.addNew()"
        title="{{ 'New template' | translate }}"
        ng-show="vm.canWrite && !vm.newCommandTemplate"
      >
        <i c8y-icon="plus-square"></i> {{ 'New template' | translate }}
      </button>
    </div>
  </div>
</div>
<div class="modal-inner-scroll">
  <div class="modal-body bg-gray-lighter" ng-if="vm.newCommandTemplate">
    <form name="vm.forms.newCommandForm">
      <div class="legend form-block center" ng-if="!vm.newCommandTemplate.name.length" translate>
        New command template
      </div>
      <div class="legend form-block center" ng-if="vm.newCommandTemplate.name.length" translate>
        Edit command template
      </div>
      <div class="form-group">
        <label translate>Name</label>
        <input
          placeholder="{{ 'e.g. My command template' | translate }}"
          required
          class="form-control"
          ng-model="vm.newCommandTemplate.name"
        />
      </div>
      <div class="form-group">
        <label translate>Category</label>
        <input
          placeholder="{{ 'e.g. My templates category' | translate }}"
          required
          class="form-control"
          ng-model="vm.newCommandTemplate.category"
        />
      </div>
      <div class="form-group">
        <label translate>Command template</label>
        <textarea
          placeholder="{{ 'e.g. ls' | translate }}"
          required
          class="form-control"
          rows="1"
          ng-model="vm.newCommandTemplate.command"
        ></textarea>
      </div>
      <div class="form-group">
        <label translate>Delivery type</label>
        <span ng-repeat="deliveryType in vm.standardDeliveryTypes">
          <label class="c8y-checkbox">
            <input title="{{ deliveryType | translate }}" type="checkbox"
            ng-model="vm.commandDeliveryTypesSelected[deliveryType]"
            ng-required="vm.validateSelectedDeliveryTypes()" />
            <span></span>
            {{ deliveryType | translate }}
          </label>
        </span>
      </div>
    </form>
  </div>
  <div class="command-templates-list list-group borderless-top" ng-hide="vm.newCommandTemplate">
    <div
      ng-repeat="commandTemplate in vm.commandTemplates | filter:commandsFilter.text"
      class="list-group-item flex-row"
      ng-class="{'active': vm.result.commandTemplate === commandTemplate}"
      ng-click="vm.onTemplateSelected(commandTemplate)"
    >
      <div
        class="list-item-actions"
        ng-if="commandTemplate.id && vm.canWrite"
        ng-click="$event.stopPropagation()"
      >
        <div
          uib-dropdown
          dropdown-append-to="appendToEl"
          is-open="isOpen"
          class="dropdown settings"
          ng-class="{'open': isOpen}"
        >
          <button
            class="dropdown-toggle c8y-dropdown"
            uib-dropdown-toggle
            title="{{ 'Actions' | translate }}"
          >
            <i c8y-icon="ellipsis-v"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
            <li>
              <a title="{{ 'Edit' | translate }}" href="" ng-click="vm.edit(commandTemplate)">
                <i c8y-icon="edit"></i> {{ 'Edit' | translate }}
              </a>
            </li>
            <li>
              <a title="{{ 'Remove' | translate }}" href="" ng-click="vm.remove(commandTemplate)">
                <i c8y-icon="trash"></i> {{ 'Remove' | translate }}
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="list-item-icon">
        <i c8y-icon="terminal"></i>
      </div>
      <div class="list-item-body">
        <div class="flex-row">
          <span class="flex-grow p-r-8">
            {{ commandTemplate.name | translate }}
          </span>
          <span
            ng-show="commandTemplate.deliveryTypes.length === 1"
            class="label label-info flex-item-v-start m-r-4"
          >
            {{ commandTemplate.deliveryTypes[0] | translate }}
          </span>
          <span ng-show="commandTemplate.category" class="label label-info flex-item-v-start">
            {{ commandTemplate.category | translate }}
          </span>
        </div>
        <span class="list-group-item-text">
          <small ng-class="{'text-muted': vm.result.commandTemplate != commandTemplate}">
            {{ commandTemplate.command }}
          </small>
        </span>
      </div>
    </div>
  </div>
</div>
<div class="modal-footer">
  <button
    type="button"
    title="{{ 'Cancel' | translate }}"
    class="btn btn-default"
    ng-click="vm.cancel()"
    translate
  >
    Cancel
  </button>
  <button
    type="button"
    title="{{ 'Use' | translate }}"
    class="btn btn-primary"
    ng-click="vm.use(vm.commandDeliveryType)"
    ng-disabled="!vm.result.commandTemplate"
    ng-hide="vm.newCommandTemplate"
    translate
  >
    Use
  </button>
  <button
    type="button"
    title="{{ 'Save' | translate }}"
    class="btn btn-primary"
    ng-click="vm.save()"
    ng-disabled="vm.forms.newCommandForm.$invalid"
    ng-show="vm.newCommandTemplate"
    translate
  >
    Save
  </button>
  <button
    type="button"
    class="btn btn-primary"
    ng-show="vm.isDeliveryTypeSupported(deliveryType, vm.result.commandTemplate) && !vm.newCommandTemplate"
    ng-repeat="deliveryType in vm.standardDeliveryTypes"
    ng-click="vm.execute(deliveryType)"
    ng-disabled="!vm.result.commandTemplate"
  >
    <span title="{{ vm.getExecuteButtonLabel(deliveryType) }}">
      {{ vm.getExecuteButtonLabel(deliveryType) }}
    </span>
  </button>
</div>
