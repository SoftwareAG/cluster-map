"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function asyncGeneratorStep(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function _asyncToGenerator(s){return function(){var t=this,i=arguments;return new Promise(function(e,n){var r=s.apply(t,i);function a(t){asyncGeneratorStep(r,e,n,a,o,"next",t)}function o(t){asyncGeneratorStep(r,e,n,a,o,"throw",t)}a(void 0)})}}!function(){function t(e,o,a,n,r,i,s,c,u){var l=this;function t(){return(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.changeTitle({title:u("Cell ID usage statistics")}),t.next=3,f();case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}function f(){return d.apply(this,arguments)}function d(){return(d=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return m(),t.next=3,y();case 3:l.subtenantList.columns=c.getSubtenantListColumns(),l.subtenantList.csvHeaders=_.map(l.subtenantList.columns,function(t){return _.get(t,"header.csv")||_.get(t,"header.text")||_.get(t,"header")}),l.subtenantList.filteredSortedStatisticsItems=S(),e.$apply();case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function m(){var t=a.dateFrom,e=a.dateTo,n=moment().startOf("month").toDate(),r=moment().add(1,"day").toDate();l.dateFrom=s.stringToDate(t)||n,l.dateTo=s.stringToDate(e)||r}function y(){return p.apply(this,arguments)}function p(){return(p=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=g(),t.next=3,o.all({tenantStatistics:c.getTenantStatisticsFor(e),subtenantsStatistics:c.getSubtenantsStatisticsFor(e)});case 3:n=t.sent,r=n.tenantStatistics,a=n.subtenantsStatistics,l.tenantStatistics=r,l.subtenantList.statisticsItems=a;case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function g(){return{dateFrom:s.dateToString(l.dateFrom),dateTo:s.dateToString(l.dateTo)}}function S(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l.subtenantList.columnsConfig;l.subtenantList.columnsConfig=t;var e=l.subtenantList,n=e.statisticsItems,r=e.columns;return i.filterSort(n,r,t)}_.assign(l,{$onInit:function(){return t.apply(this,arguments)},refresh:f,doFilter:function(){var t=g();t.dateFrom&&t.dateTo&&n.search(t)},clearFilter:function(){n.search({})},tenantStatistics:{tenantId:void 0,apiRequests:0,activeDevices:0},subtenantList:{csvHeaders:[],csvData:function(){return _.map([l.tenantStatistics].concat(_toConsumableArray(l.subtenantList.filteredSortedStatisticsItems)),function(t){return _.at(t,["tenantId","apiRequests","activeDevices"])})},columns:[],columnsConfig:{},onColumnsConfigChanged:function(t){l.subtenantList.filteredSortedStatisticsItems=S(t)},statisticsItems:[],filteredSortedStatisticsItems:[],goToSubtenant:function(t){var e=t.tenantId;n.path("/tenants/".concat(e))}}})}t.$inject=["$rootScope","$q","$routeParams","$location","c8yTitle","c8yFilteringSortingCollections","c8yUtil","cellIdUsageStatisticsService","gettext"],angular.module("c8y.cellIdUsageStatistics").component("c8yCellIdUsageStatistics",{templateUrl:":::PLUGIN_PATH:::/cell-id-usage-statistics.html",controllerAs:"vm",controller:t})}();